const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/calcite-button-i_RwumFW.js","assets/index-CorgkmYx.js","assets/index-CxdEf2vt.css","assets/form-C1ukae_a.js","assets/dom-BKPLlNUX.js","assets/interactive-_XlOZIAS.js","assets/label-B5PRbpQ2.js","assets/component-6CIDVndn.js","assets/loadable-CRaOMYtw.js","assets/locale-CV_TIHPK.js","assets/key-D63ExP77.js","assets/observers-Fc0P7oaF.js","assets/t9n-BUCds_WL.js","assets/icon-lYaBtOsi.js","assets/loader-Dpo1r2Oz.js","assets/guid-BxSjQh8J.js","assets/calcite-icon-J4sAtRdE.js","assets/calcite-input-CnZUsYSl.js","assets/input2-O5ULG0bB.js","assets/calcite-dropdown-DMhepRjP.js","assets/floating-ui-B_OGUquo.js","assets/debounce-CXS2v-pU.js","assets/openCloseComponent-C6y-6uyE.js","assets/calcite-dropdown-item-BkiIw8Zj.js","assets/resources3-Qm0M2nV8.js","assets/calcite-dropdown-group-DzaI9WZB.js"])))=>i.map(i=>d[i]);
import{a as Qt,aA as cn,bC as ht,l as Po,c3 as vn,r as a,t as u,x,bg as H,ef as dt,fD as Mo,be as C,R as pn,q as Li,g as pt,q7 as X,gA as L,q8 as Ol,bD as g,ac as Oe,a0 as B,q9 as fn,jN as Di,ne as Il,nd as Ll,ev as Nt,et as Dl,cG as te,a7 as ts,fr as ko,w as Tr,qa as Gl,qb as zl,qc as Ul,cj as Er,s as Gi,ck as Hl,qd as Ft,aW as Dt,aR as fi,jP as Nl,qe as Fl,d as Zl,fy as ql,qf as Bl,qg as Wl,ij as Yl,oi as Sr,qh as Xl,qi as jl,ei as zi,d$ as ft,bz as Z,dY as Te,bF as lt,bB as Ae,gZ as Pr,H as kn,qj as Kl,ay as bn,dQ as zs,bk as ns,M as Zt,kk as Ql,qk as Co,bP as Ro,iq as St,hM as Us,ee as N,ql as Xe,qm as qt,qn as yt,eF as de,ic as is,g_ as G,bw as xn,dW as _t,ll as Jl,dX as oe,lR as gt,lS as Vo,gt as Be,cv as ec,qo as tc,qp as Bt,qq as si,ir as nc,g3 as Hs,dZ as Ao,bx as ic,ie as Oo,bL as sc,jF as rc,qr as Mr,aT as oc,qs as Ns,hO as Io,qt as ac,qu as lc,d_ as he,qv as Fs,ek as Lo,qw as Do,eW as cc,fZ as Go,fu as zo,km as Cn,ko as v,b as uc,qx as hc,bS as Rn,gC as gn,qy as dc,qz as pc,qA as fc,pi as we,p4 as gc,kn as Zs,_ as Ie,gk as kr,af as mc,p9 as yc,f_ as _c,pp as Uo,qB as Cr,kr as ss,a4 as U,dr as kt,gB as vc,hq as Mt,p3 as bc,ab as pe,a5 as rs,qC as xc,eU as qs,qD as Rr,gD as Bs,gO as os,ad as wc,aV as Ws,qE as $c,gQ as Tc,bv as Ec,gI as Sc,qF as Pc,qG as Mc,qH as wt,bo as kc,dK as Cc,qI as Vr,ip as Ui,bI as Rc,qJ as Vc,bM as Ac,bK as Oc,qK as Ho,g4 as Ic,qL as Lc,n0 as Dc,qM as Gc,aZ as No,ik as wn,i6 as zc,eg as Ar,lm as Ys,aX as Uc,f$ as Fo,lT as Hc,qN as ri,qO as Nc,cf as Wt,gp as as,kS as Zo,qP as qo,Z as Bo,fE as ls,fs as Wo,jd as Fc,mz as Zc,dn as Gt,cQ as qc,qQ as Bc,qR as Or,ci as Wc,mW as Yc,e6 as Yo,eC as Xo,qS as Xc,qT as jc,ln as Hi,lo as Ir,qU as Lr,i8 as Dr,gz as jo,e9 as $n,ex as Kc,qV as Gr,qW as Qc,qX as Jc}from"./index-CorgkmYx.js";import{e as Xs,n as eu,a as be}from"./projectVectorToVector-HH_mq-I9.js";import{m as tu,x as nu,j as gi,a as iu,b as su,E as Ko,p as zr,u as ru,l as ou}from"./elevationInfoUtils-D8HWlcTj.js";import{h as js}from"./GraphicsLayer-BhUqc-Wo.js";import{j as Tn,q as mi,b as yi,N as oi,y as Qo,v as au,R as lu}from"./geodesicUtils-DrnU7BqE.js";import{distance as cu,simplify as uu,geodesicArea as hu,geodesicLength as Jo}from"./geometryEngine-Cp-I50z1.js";import{R as du,L as pu}from"./quat-DBd2Nb1m.js";import{e as Ur}from"./quatf64-aQ5IuZRd.js";import{o as De,m as ea,f as _i,a as fe,w as fu,p as gu,b as et,F as mu,M as yu,g as _u,y as vu,B as bu,D as xu,d as wu,x as $u,h as Tu,$ as Eu,j as Su,i as Ke,c as Pu,e as Yt,k as Qe,U as Ks,l as vi,n as Mu,s as ku}from"./ReactiveSet-BsrqoT-d.js";import{l as Vn,M as ae,Q as cs,d as ta,k as Qs,z as na,V as Vt,H as Js,O as zt,p as ia,D as Cu,J as Ru,b as Vu,f as Hr,h as Ni,t as nn}from"./plane-BzYZw24a.js";import{I as Au,O as Ou,_ as Iu,$ as Lu,U as Du}from"./sphere-BBWSjd6r.js";import"./MeshTransform-Dz9M0eog.js";import{a as Gu}from"./meshVertexSpaceUtils-Cu1f-oO7.js";import{e as zu}from"./earcut-D9gy186-.js";import{v as Uu}from"./triangle-joELbrle.js";import{w as Hu,a as Nu}from"./spatialReferenceEllipsoidUtils-r_S_8DDe.js";import"./MeshLocalVertexSpace-DAVvI3Z3.js";import{I as Nr}from"./cimSymbolUtils-BXUjeg3M.js";import{c as Fu}from"./projectPointToVector-BSiCSeaS.js";import{i as Zu}from"./drapedUtils-DfltPsBI.js";import{W as En,K as bi,Z as Jn}from"./boundedPlane-CCkaeyY_.js";import"./geometryEngineBase-C0k-Dc0I.js";import"./_commonjsHelpers-DCkdB7M8.js";import"./hydrated-BW7jEKhG.js";import"./mat3f64-q3fE-ZOt.js";import"./ByteSizeUnit-BsxeN7wM.js";import"./mat4f64-CSKppSlJ.js";import"./lineSegment-DZB-cCmC.js";function mn(n,e){return n===e||n!=null&&e!=null&&Qt(n.spatialReference,e.spatialReference)&&n.x===e.x&&n.y===e.y&&n.z===e.z&&n.m===e.m}function Fi(n,e,t){return n===e||n!=null&&e!=null&&Qt(n.spatialReference,e.spatialReference)&&cn(n.x,e.x,t)&&cn(n.y,e.y,t)&&cn(n.z??0,e.z??0,t)&&cn(n.m??0,e.m??0,t)}function qu(n){return"declaredClass"in n}function sa(n,e){if(!n)return null;let t;return qu(n)?n.clone():(t=Xs(n.x,n.y,n.z,n.spatialReference),n.hasM&&(t.m=n.m,t.hasM=!0),t)}var Fr;function ra(n,e,t){return j(n,e,t)}function j(n=0,e=0,t=0){return ht(n,e,t)}function vt(n,e,t){return ht(n,e,t)}function Xt(n){const[e,t,i]=n;return n.length>3?[e,t,i,n[3]]:[e,t,i]}function er(n,e,t,i=j()){return i[0]=n.x,i[1]=n.y,i[2]=n.z??0,e==null||(e.type==="2d"?i[2]=0:i[2]=tu(e,n,t,gi)??0),i}function Bu(n,e,{z:t,m:i},s,r){const{spatialReference:o,elevationInfo:l}=s;let c;t==null&&i==null?c=void 0:e==null||e.type==="2d"?c=t??void 0:c=nu(e,n,o,gi,l)??0;const[h,d]=n;return r?eu(r,h,d,c,o):r=Xs(h,d,c,o),i!=null&&(r.m=i,r.hasM=!0),r}(function(n){n[n.NONE=0]="NONE",n[n.TARGET=1]="TARGET"})(Fr||(Fr={}));let Ee=class extends Po{constructor(){super(...arguments),this.enabled=!0}};a([u({type:Boolean})],Ee.prototype,"enabled",void 0),Ee=a([x("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],Ee);let V=class extends Po{constructor(e){super(e),this.lineSnapper=new Ee,this.parallelLineSnapper=new Ee,this.rightAngleSnapper=new Ee,this.rightAngleTriangleSnapper=new Ee,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new vn([255,127,0]),this.orangeTransparent=new vn([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};a([u({type:Ee,constructOnly:!0,nonNullable:!0,json:{write:!0}})],V.prototype,"lineSnapper",void 0),a([u({type:Ee,constructOnly:!0,nonNullable:!0,json:{write:!0}})],V.prototype,"parallelLineSnapper",void 0),a([u({type:Ee,constructOnly:!0,nonNullable:!0,json:{write:!0}})],V.prototype,"rightAngleSnapper",void 0),a([u({type:Ee,constructOnly:!0,nonNullable:!0,json:{write:!0}})],V.prototype,"rightAngleTriangleSnapper",void 0),a([u({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],V.prototype,"shortLineThreshold",void 0),a([u({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],V.prototype,"distance",void 0),a([u({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],V.prototype,"pointThreshold",void 0),a([u({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],V.prototype,"intersectionParallelLineThreshold",void 0),a([u({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],V.prototype,"parallelLineThreshold",void 0),a([u({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],V.prototype,"verticalLineThresholdMeters",void 0),a([u({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],V.prototype,"touchSensitivityMultiplier",void 0),a([u({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],V.prototype,"pointOnLineThreshold",void 0),a([u({type:vn,nonNullable:!0})],V.prototype,"orange",void 0),a([u({type:vn,nonNullable:!0})],V.prototype,"orangeTransparent",void 0),a([u({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],V.prototype,"lineHintWidthReference",void 0),a([u({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],V.prototype,"lineHintWidthTarget",void 0),a([u({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],V.prototype,"lineHintFadedExtensions",void 0),a([u({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],V.prototype,"parallelLineHintWidth",void 0),a([u({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],V.prototype,"parallelLineHintLength",void 0),a([u({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],V.prototype,"parallelLineHintOffset",void 0),a([u({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],V.prototype,"rightAngleHintSize",void 0),a([u({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],V.prototype,"rightAngleHintOutlineSize",void 0),a([u({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],V.prototype,"satisfiesConstraintScreenThreshold",void 0),V=a([x("esri.views.interactive.snapping.Settings.Defaults")],V);const Zi=new V;var jt;(function(n){n[n.FEATURE=1]="FEATURE",n[n.SELF=2]="SELF",n[n.ALL=3]="ALL"})(jt||(jt={}));let An=class{constructor(e,t){this.isDraped=e,this.domain=t}},Wu=class oa extends An{constructor(e,t,i=jt.ALL){super(t,i),this.intersectionPoint=e}equals(e){return e instanceof oa&&H(this.intersectionPoint,e.intersectionPoint)}},Yu=class aa extends An{constructor(e,t,i,s,r=jt.ALL,o=!0,l=!0){super(s,r),this.type=e,this.lineStart=t,this.lineEnd=i,this.fadeLeft=o,this.fadeRight=l}equals(e){return e instanceof aa&&this.type===e.type&&H(this.lineStart,e.lineStart)&&H(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return dt(this.lineStart,this.lineEnd)}},Xu=class la extends An{constructor(e,t,i,s=jt.ALL){super(i,s),this.lineStart=e,this.lineEnd=t}equals(e){return e instanceof la&&H(this.lineStart,e.lineStart)&&H(this.lineEnd,e.lineEnd)}},ju=class ca extends An{constructor(e,t,i){super(t,i),this.point=e}equals(e){return e instanceof ca&&H(this.point,e.point)}},Ku=class ua extends An{constructor(e,t,i,s,r=jt.ALL){super(s,r),this.previousVertex=e,this.centerVertex=t,this.nextVertex=i}equals(e){return e instanceof ua&&H(this.previousVertex,e.previousVertex)&&H(this.centerVertex,e.centerVertex)&&H(this.nextVertex,e.nextVertex)}},Qu=class{draw(e,t){const i=Ju(e),s=this.sortUniqueHints(i),r=[];for(const o of s)o instanceof Wu&&r.push(this.visualizeIntersectionPoint(o,t)),o instanceof Yu&&r.push(this.visualizeLine(o,t)),o instanceof Xu&&r.push(this.visualizeParallelSign(o,t)),o instanceof Ku&&r.push(this.visualizeRightAngleQuad(o,t)),o instanceof ju&&r.push(this.visualizePoint(o,t));return Mo(r)}sortUniqueHints(e){return e}};function Ju(n){const e=[];for(const t of n){let i=!0;for(const s of e)if(t.equals(s)){i=!1;break}i&&e.push(t)}return e}let eh=class extends Qu{constructor(e){super(),this._graphicsLayer=e,this._symbolPairingsByType=new Map}visualizeIntersectionPoint(e,t){return this._visualizeSnappingIndicator(new C({x:e.intersectionPoint[0],y:e.intersectionPoint[1],spatialReference:t.spatialReference}),this._getOrCreateSymbol("intersectionPoint",t.view.effectiveTheme.accentColor))}visualizePoint(e,t){return this._visualizeSnappingIndicator(new C({x:e.point[0],y:e.point[1],spatialReference:t.spatialReference}),this._getOrCreateSymbol("point",t.view.effectiveTheme.accentColor))}visualizeLine(e,t){return this._visualizeSnappingIndicator(new pn({paths:[[[...e.lineStart],[...e.lineEnd]]],spatialReference:Li(pt,t.spatialReference)}),this._getOrCreateSymbol("line",t.view.effectiveTheme.accentColor))}visualizeParallelSign(e,t){return this._visualizeSnappingIndicator(new pn({paths:[[[...e.lineStart],[...e.lineEnd]]],spatialReference:Li(pt,t.spatialReference)}),this._getOrCreateSymbol("parallelSign",t.view.effectiveTheme.accentColor))}visualizeRightAngleQuad(e,t){const i=L(),s=L(),r=g();X(i,e.centerVertex,e.previousVertex),X(s,e.nextVertex,e.previousVertex),Ol(r,i,s);const o=`rightAngleQuad${r[2]<0?45:225}`;return this._visualizeSnappingIndicator(new pn({paths:[[[...e.previousVertex],[...e.centerVertex],[...e.nextVertex]]],spatialReference:Li(pt,t.spatialReference)}),this._getOrCreateSymbol(o,t.view.effectiveTheme.accentColor))}_visualizeSnappingIndicator(e,t){const i=new Oe({geometry:e,symbol:t});return this._graphicsLayer.add(i),B(()=>{this._graphicsLayer.remove(i)})}_getOrCreateSymbol(e,t){var s;const i=this._symbolPairingsByType;return((s=i.get(e))==null?void 0:s.color)!==t&&i.set(e,{color:t,symbol:th(e,t)}),i.get(e).symbol}};function th(n,e){const t=[...e.toRgb(),255*e.a];switch(n){case"point":return new Nt({outline:{width:.5,color:[0,0,0,1]},size:10,color:e});case"intersectionPoint":return new Nt({outline:new Dl({width:1.5,color:e}),size:15,color:[0,0,0,0]});case"line":return new fn({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:Ll.Butt,joinStyle:Il.Round,miterLimit:10,width:Di(Zi.lineHintWidthTarget),color:t}]}}});case"parallelSign":return new fn({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,1.5],[7,1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:t}]}}],scaleSymbolsProportionally:!0,respectFrame:!0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,-1.5],[7,-1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:t}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}});case"rightAngleQuad45":case"rightAngleQuad225":{const i=n==="rightAngleQuad45"?45:225;return new fn({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:.5,y:.5,z:0},anchorPointUnits:"Relative",size:Di(Zi.rightAngleHintSize),rotation:i,markerPlacement:{type:"CIMMarkerPlacementOnVertices",placePerPart:!0,angleToLine:!0,placeOnEndPoints:!1},frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[5,-5],[-5,-5],[-5,5],[5,5],[5,-5]]]},symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:Di(Zi.rightAngleHintOutlineSize),color:t},{type:"CIMSolidFill",enable:!0,color:[...e.toRgb(),255*e.a*.4]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}})}}}const nh=new fn({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[3.75,3.75],lineDashEnding:"HalfPattern",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:1.6,color:[255,255,255,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:2,color:[0,0,0,255]}]}}}),ih=new Nt({style:"circle",size:6,color:[127,127,127,1],outline:{color:[50,50,50],width:1}}),sh=new Nt({style:"circle",size:6,color:[255,127,0,1],outline:{color:[50,50,50],width:1}});var ue;(function(n){n[n.NeverApplied=0]="NeverApplied",n[n.Applied=1]="Applied",n[n.Undone=2]="Undone"})(ue||(ue={}));var Le;(function(n){n.UndoRedoUpdating="UndoRedoUpdating",n.UndoInvalidError="UndoInvalidError",n.RedoInvalidError="RedoInvalidError",n.ApplyInvalidError="ApplyInvalidError"})(Le||(Le={}));const xi={[Le.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[Le.UndoInvalidError]:"There are no items to Undo",[Le.RedoInvalidError]:"There are no items to Redo",[Le.ApplyInvalidError]:"Cannot apply an item that is already applied"};let sn=class extends Error{constructor(){super(xi[Le.UndoRedoUpdating]),this.type="undo-redo-updating-error"}},us=class extends Error{constructor(){super(xi[Le.UndoInvalidError]),this.type="undo-redo-undo-error"}},Zr=class extends Error{constructor(){super(xi[Le.RedoInvalidError]),this.type="undo-redo-redo-error"}},rh=class extends Error{constructor(){super(xi[Le.ApplyInvalidError]),this.type="undo-redo-apply-error"}};var Ye;(function(n){n[n.Apply=0]="Apply",n[n.Undo=1]="Undo",n[n.Redo=2]="Redo"})(Ye||(Ye={}));let Gn=class extends te{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=ue.NeverApplied}get canUndo(){return this.status===ue.Applied}get canRedo(){return this.status===ue.Undone}async executeUndoRedoOperation(e){switch(e){case Ye.Apply:if(this.status!==ue.NeverApplied)throw new rh;return await this.apply(),void(this.status=ue.Applied);case Ye.Undo:if(this.status!==ue.Applied)throw new us;return await this.undo(),void(this.status=ue.Undone);case Ye.Redo:if(this.status!==ue.Undone)throw new us;return await this.redo(),void(this.status=ue.Applied)}}};a([u()],Gn.prototype,"name",void 0),a([u()],Gn.prototype,"tag",void 0),Gn=a([x("esri.undoredo.UndoableOperation")],Gn);let ke=class extends te{constructor(){super(...arguments),this._stack=new ts,this._stackPosition=-1,this._updatingHandles=new ko}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach(e=>e.destroy())}_drainStack(){this._stack.drain(e=>e.destroy()),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new us;if(this.updating)throw new sn;const e=this._stack.getItemAt(this._stackPosition);e&&await this._updatingHandles.addPromise((async()=>{await e.executeUndoRedoOperation(Ye.Undo),--this._stackPosition,e.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new Zr;if(this.updating)throw new sn;const e=this._stack.getItemAt(this._stackPosition+1);if(!e)throw new Zr;await this._updatingHandles.addPromise((async()=>{await e.executeUndoRedoOperation(Ye.Redo),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(e){if(this.updating)throw new sn;await this._updatingHandles.addPromise((async()=>{e.status===ue.NeverApplied&&await e.executeUndoRedoOperation(Ye.Apply),e.canUndo?(this._stack.splice(this._stackPosition+1,0,e),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach(t=>t.destroy()),this._stackPosition=-1)})())}async add(e){if(this.updating)throw new sn;await this._updatingHandles.addPromise((async()=>{e.status===ue.NeverApplied&&await e.executeUndoRedoOperation(Ye.Apply),this._stackPosition>=-1&&this._truncateForwardStack(),e.canUndo?(this._stack.push(e),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(e,t=!1){if(this.updating&&!t)return;await Tr(()=>!this.updating);const i=new ts;for(let s=0;s<this._stack.length;s++){const r=this._stack.getItemAt(s);r&&(r.tag===e?(r.destroy(),s===this._stackPosition&&(this._stackPosition=i.length-1)):i.push(r))}this._stack=i,this._stackPosition>i.length-1&&(this._stackPosition=i.length-1)}async clear(e=!1){if(this.updating&&!e)throw new sn;await Tr(()=>!this.updating),this._drainStack()}};a([u()],ke.prototype,"_stack",void 0),a([u()],ke.prototype,"_stackPosition",void 0),a([u()],ke.prototype,"updating",null),a([u({readOnly:!0})],ke.prototype,"canUndo",null),a([u({readOnly:!0})],ke.prototype,"hasUndo",null),a([u({readOnly:!0})],ke.prototype,"canRedo",null),a([u({readOnly:!0})],ke.prototype,"hasRedo",null),ke=a([x("esri.UndoRedo")],ke);function tr(){return zl()}function oh(){return Gl()}function Sn(n,e){const t=[];n=(n=(n=n.replaceAll(/[\u00B0\u00BA]/g,"^")).replaceAll("′","'")).replaceAll("″",'"');const i=ch(e);return Ul.dmsToGeog(i,1,[n],t)?new C(t[0][0],t[0][1],pt.WGS84):null}function ah(n){var e,t;return n&&tr()?Ft(n)??((e=Sn(`0° 0' 0" N | ${n}`))==null?void 0:e.longitude)??((t=Sn(`0 | ${n}`))==null?void 0:t.longitude)??null:null}function lh(n){var e,t;return n&&tr()?Ft(n)??((e=Sn(`${n} | 0° 0' 0" E`))==null?void 0:e.latitude)??((t=Sn(`${n} | 0`))==null?void 0:t.latitude)??null:null}function ch(n){let e=null;if(n||(n=pt.WGS84),n.wkid){if(e=Er.geogcs(n.wkid),!e)throw new Gi("coordinate-formatter:invalid-spatial-reference","wkid is not valid")}else{if(!n.wkt2&&!n.wkt)throw new Gi("coordinate-formatter:invalid-spatial-reference","wkid and wkt are missing");if(e=Er.fromString(Hl.PE_TYPE_GEOGCS,n.wkt2||n.wkt),!e)throw new Gi("coordinate-formatter:invalid-spatial-reference","wkt is not valid")}return e}let uh=class{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}};var hs;let st=hs=class extends Dt{constructor(n){super(n),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}initialize(){const n=this.center,e=this.numberOfPoints;if(this.hasZ=(n==null?void 0:n.hasZ)??!1,this.rings.length!==0||!n)return;const t=fi(this.radius,this.radiusUnit,"meters"),i=n.spatialReference;let s,r="geographic";if(i.isWebMercator?r="webMercator":((i.wkid&&Nl[i.wkid])!=null||(i.wkt2||i.wkt)&&Fl(i.wkt2||i.wkt))&&(r="projected"),this.geodesic){let o;switch(r){case"webMercator":o=Zl(n);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":o=n}s=this._createGeodesicCircle(o,t,e),r==="webMercator"&&(s=ql(s))}else{let o;r==="webMercator"||r==="projected"?o=t/Bl(n.spatialReference):r==="geographic"&&(o=Wl(t,"meters",Yl(n.spatialReference).radius)),s=this._createPlanarCircle(n,o,e)}this.spatialReference=s.spatialReference,this.addRing(s.rings[0])}clone(){const{center:n,numberOfPoints:e,radius:t,radiusUnit:i,geodesic:s}=this;return new hs({center:n==null?void 0:n.clone(),numberOfPoints:e,radius:t,radiusUnit:i,geodesic:s})}_createGeodesicCircle(n,e,t){let i=0;const s=[];for(;i<360;){const r=[0,0],o=[n.x,n.y];Tn(r,o,i,e,pt.WGS84),this.hasZ&&r.push(n.z),s.push(r),i+=360/t}return s.push(s[0]),new Dt({rings:[s]})}_createPlanarCircle(n,e,t){const i=[],s=2*Math.PI/t;for(let r=0;r<t;++r){const o=s*r,l=[n.x+Math.cos(-o)*e,n.y+Math.sin(-o)*e];this.hasZ&&l.push(n.z),i.push(l)}return i.push(i[0]),new Dt({spatialReference:n.spatialReference,rings:[i]})}};a([u({type:C})],st.prototype,"center",void 0),a([u()],st.prototype,"geodesic",void 0),a([u()],st.prototype,"numberOfPoints",void 0),a([u()],st.prototype,"radius",void 0),a([u()],st.prototype,"radiusUnit",void 0),st=hs=a([x("esri.geometry.Circle")],st);const hh=st;function ai(n,e,t=null){return t!=null?[n,e,t]:[n,e]}function k(n,e,t=null){return t!=null?{x:n,y:e,z:t}:{x:n,y:e}}let ha=class{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return e.map(t=>this.mapToLocal(t)).filter(kn)}get doUnnormalization(){return!1}},dh=class extends ha{constructor(e,t,i=null){super(t),this._defaultZ=i,this.transform=Sr(),this.transformInv=Sr(),this.transform=Xl(e),jl(this.transformInv,this.transform)}makeMapPoint(e,t){return ai(e,t,this._defaultZ)}mapToLocal(e){return k(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return ai(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this._defaultZ)}},ph=class extends ha{constructor(e,t){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=g(),this.tangentFrameUpWS=g(),this.tangentFrameRightWS=g(),this.tangentFrameForwardWS=g(),this.localFrameRightWS=g(),this.localFrameUpWS=g(),this.worldToLocalTransform=Ur(),this.localToWorldTransform=Ur(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=t,this.defaultZ=t.hasZ?t.z:null;const i=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,zi.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,zi.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,zi.Z,this.tangentFrameForwardWS);const s=g();ft(s,this.tangentFrameForwardWS,Z(i,this.tangentFrameForwardWS)),Te(this.localFrameRightWS,i,s),lt(this.localFrameRightWS,this.localFrameRightWS),Ae(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),du(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),pu(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return this.view.viewingMode==="global"}makeMapPoint(e,t){return ai(e,t,this.defaultZ)}mapToLocal(e){const t=g();this.view.renderCoordsHelper.toRenderCoords(new C({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),Pr(t,t,this.worldToLocalTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,new C({spatialReference:this.view.spatialReference}));return i!=null?k(i.x/this.scale,i.y/this.scale):null}localToMap(e){const t=g();this.view.renderCoordsHelper.toRenderCoords(new C({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),Pr(t,t,this.localToWorldTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,new C({spatialReference:this.view.spatialReference}));return i!=null?ai(i.x,i.y,this.defaultZ):null}};function fh(n,e){if(n.type==="2d")return new dh(n.state.transform,n.spatialReference,e.length>2?e[2]:null);if(n.type==="3d"){const t=e.length>2?new C({x:e[0],y:e[1],z:e[2],spatialReference:n.spatialReference}):new C({x:e[0],y:e[1],spatialReference:n.spatialReference});return new ph(n,t)}return null}function Pt(n,e){const t=new C({x:n[0],y:n[1],spatialReference:e});return n.length>2&&(t.z=n[2]),t}function gh(n,e){return new Ro({points:n,spatialReference:e})}function qr(n,e,t){const i=new pn({paths:n,spatialReference:e});return t&&Co(i),i}function On(n,e,t,i=!0){const s=ns(n);s.forEach(o=>{const l=o[0],c=o[o.length-1];Zt(l,c)&&o.length!==1||o.push(o[0])});let r=new Dt({rings:s,spatialReference:e});return r.rings.forEach(o=>{Ql(o)||o.reverse()}),t&&Co(r),i&&r.isSelfIntersecting&&zs(e)&&(r=uu(r)),r}function Br(n,e,t){const i=e.mapToLocalMultiple(n),s=[],r={x:i[0].x,y:i[0].y},o={x:i[1].x,y:i[1].y},l=Math.round(o.x-r.x),c=Math.round(o.y-r.y),h=Math.max(Math.abs(l),Math.abs(c));if(t){const d={x:r.x+h,y:r.y+h},p={x:r.x-h,y:r.y-h};s.push(k(d.x,p.y),k(p.x,p.y),k(p.x,d.y),k(d.x,d.y))}else{const d={x:l>0?r.x+h:r.x-h,y:c>0?r.y+h:r.y-h};s.push(k(r.x,r.y),k(d.x,r.y),k(d.x,d.y),k(r.x,d.y))}return da(On([s.map(d=>e.localToMap(d)).filter(kn)],e.spatialReference,e.doUnnormalization,!0),s,e)}function mh(n,e,t){let i=e.mapToLocalMultiple(n);if(i.length===1){const c=i[0];i=[k(c.x-48,c.y+48),k(c.x+48,c.y-48),k(c.x+48,c.y-48),k(c.x-48,c.y+48)]}const s=[],r={x:i[0].x,y:i[0].y},o={x:i[1].x,y:i[1].y};if(t){const l=Math.round(o.x-r.x),c=Math.round(o.y-r.y);s.push(k(r.x-l,r.y-c),k(o.x,r.y-c),k(o.x,o.y),k(r.x-l,o.y))}else s.push(k(r.x,r.y),k(o.x,r.y),k(o.x,o.y),k(r.x,o.y));return da(On([s.map(l=>e.localToMap(l)).filter(kn)],e.spatialReference,e.doUnnormalization,!0),s,e)}function da(n,e,t){const i=zn(e[3],e[2],t),s=zn(e[1],e[2],t),r=zn(e[0],e[1],t),o=zn(e[0],e[3],t);return{geometry:n,midpoints:i!=null&&s!=null&&r!=null&&o!=null?{top:i,right:s,bottom:r,left:o}:null}}function zn(n,e,t){Ct[0]=n.x,Ct[1]=n.y,Ct[2]=0,Rt[0]=e.x,Rt[1]=e.y,Rt[2]=0,St(Ct,Ct,Rt,.5),Un.x=Ct[0],Un.y=Rt[1],Un.z=Rt[2];const i=t.localToMap(Un);return i!=null?Pt(i,t.spatialReference):null}const Un=k(0,0,0),Ct=g(),Rt=g();function Wr(n,e,t,i){const s=e.mapToLocalMultiple(n);let r=null,o=null;if(t)r=s[0],o=s[1];else{const m=s[0],y=s[1],w=Math.round(y.x-m.x),b=Math.round(y.y-m.y),$=Math.max(Math.abs(w),Math.abs(b));r=k(w>0?m.x+$/2:m.x-$/2,b>0?m.y+$/2:m.y-$/2),o=k(Math.abs(w)>Math.abs(b)?r.x-$/2:r.x,Math.abs(w)>Math.abs(b)?r.y:r.y-$/2)}const l=e.localToMap(r),c=e.localToMap(o);if(l==null||c==null)return null;e.doUnnormalization&&Kl([[l,c]],e.spatialReference);const h=Pt(l,e.spatialReference),d=Pt(c,e.spatialReference),p=bn(e.spatialReference);let _=0;if(zs(e.spatialReference))_=p*cu(h,d,null);else{const m=r.x-o.x,y=r.y-o.y;_=p*Math.sqrt(m*m+y*y)*1}const f=new hh({center:h,radius:_,radiusUnit:"meters",spatialReference:e.spatialReference});return{geometry:On(f.rings,f.spatialReference,!1),center:h,edge:d}}function yh(n,e,t){const i=e.mapToLocalMultiple(n),s=i[0],r=i[1],o=Math.round(r.x-s.x),l=Math.round(r.y-s.y),c=k(t?s.x:s.x+o/2,t?s.y:s.y+l/2),h=t?o:o/2,d=t?l:l/2,p=60,_=[],f=2*Math.PI/p;function m(W){const ge=Math.cos(W),le=Math.sin(W);return k(h*ge+c.x,d*le+c.y)}for(let W=0;W<p;W++)_.push(m(W*f));_.push(_[0]);const{spatialReference:y,doUnnormalization:w}=e,b=On([_.map(W=>e.localToMap(W)).filter(kn)],y,w,!1),$=e.localToMap(m(Math.PI/2)),M=e.localToMap(m(0)),K=e.localToMap(m(-Math.PI/2)),Q=e.localToMap(m(Math.PI));return{geometry:b,midpoints:$!=null&&M!=null&&K!=null&&Q!=null?{top:Pt($,y),right:Pt(M,y),bottom:Pt(K,y),left:Pt(Q,y)}:null}}function nr(n,e){switch(n){case"point":case"multipoint":return _h();case"polyline":return vh(e);case"polygon":return bh(e);default:return}}function _h(n){return"point"}function vh(n){return(n!=null&&n.type==="polyline"&&n.paths.length?n.paths[0].length:0)<2?"polylineZeroVertices":"polylineOneVertex"}function bh(n){const e=n!=null&&n.type==="polygon"&&n.rings.length?n.rings[0].length:0;return e<3?"polylineZeroVertices":e<4?"polygonOneVertex":"polygonTwoVertices"}function xh(n,e){const t=n==null?void 0:n.geometry;if(!n||(t==null?void 0:t.type)!=="mesh"||!e)return;const{renderCoordsHelper:i,elevationProvider:s}=e,{camera:r}=e.state,{extent:o}=t,{center:l,spatialReference:c}=o,h=bn(c),d=Us(c),p=bn(i.spatialReference),_=o.width*h,f=o.height*d,m=(o.zmax??0)*d,y=m-(o.zmin??0)*d,w=Math.max(_,f,y)/p,{x:b,y:$}=l,M=l.z??0;N(Hn,b,$,M),i.toRenderCoords(Hn,c,Hn);const K=w/r.computeScreenPixelSizeAt(Hn);if(K>r.width*$h)return"meshTooClose";if(K<wh)return"meshTooFar";const Q=iu(n),{absoluteZ:W}=su(b,$,m,c,e,Q);return W<(s.getElevation(b,$,M,c,"ground")??0)*d+y*Th?"meshUnderground":"mesh"}const wh=20,$h=1,Th=.1,Hn=g();function qi(n,e){return n[0]*e[1]-n[1]*e[0]}function Eh(n,e){const t=n.start,i=n.end,s=e.start,r=e.end,o=X(pa,i,t),l=X(fa,r,s),c=qi(o,l);if(Math.abs(c)<=Ph)return[];const h=X(ga,t,s),d=qi(l,h)/c,p=qi(o,h)/c;if(d>=0){if(p>=0||e.type===O.LINE)return[Xe(li,t,o,d)]}else if(n.type===O.LINE&&(p>=0||e.type===O.LINE))return[Xe(li,t,o,d)];return[]}function Sh(n,e,t){const i=[],s=X(pa,n.end,n.start),r=X(fa,n.start,e),o=qt(s),l=2*yt(s,r),c=l*l-4*o*(qt(r)-t*t);if(c===0){const h=-l/(2*o);(n.type===O.LINE||h>=0)&&i.push(Xe(li,n.start,s,h))}else if(c>0){const h=Math.sqrt(c),d=(-l+h)/(2*o);(n.type===O.LINE||d>=0)&&i.push(Xe(li,n.start,s,d));const p=(-l-h)/(2*o);(n.type===O.LINE||p>=0)&&i.push(Xe(ga,n.start,s,p))}return i}var O;(function(n){n[n.RAY=0]="RAY",n[n.LINE=1]="LINE"})(O||(O={}));const Ph=1e-6,pa=L(),fa=L(),ga=L(),li=L();function ir({start:n,end:e,type:t},i,s){const r=[],o=X(In,e,n),l=X(wi,n,i),c=qt(o),h=2*yt(o,l),d=h*h-4*c*(qt(l)-s*s);if(d===0){const p=-h/(2*c);(t===xe.PLANE||p>=0)&&r.push(Xe(L(),n,o,p))}else if(d>0){const p=Math.sqrt(d),_=(-h+p)/(2*c);(t===xe.PLANE||_>=0)&&r.push(Xe(L(),n,o,_));const f=(-h-p)/(2*c);(t===xe.PLANE||f>=0)&&r.push(Xe(L(),n,o,f))}return r}function ma(n,e){const t=n.start,i=n.end,s=X(In,i,t),r=N(Ti,-s[1],s[0],0),o=e.start,l=e.end,c=de(rr,l,o),h=Z(c,r),d=N(Ta,t[0],t[1],0),p=de(Ea,d,o),_=Z(p,r),f=xn();if(Math.abs(h)<f)return[];const m=G(Sa,o,c,_/h);if(e.type===O.RAY){const y=de(ds,m,o);if(Z(y,c)<-f)return[]}if(n.type===xe.HALF_PLANE){const y=Jl(wi,m,t);if(yt(y,s)<-f)return[]}return[_t(m)]}function Mh(n,e){return Ch(ci(or,e[2],n),e)}function ya(n,e){return wa(ci(or,0,n),ci(Oh,0,e)).map(([i,s])=>gt(i,s))}function _a(n,e,t){return ba(n,ci(or,n[2],e),t)}function va(n,e,t,i=g()){const s=X(In,n,e),r=tc(s);return Xe(i,e,s,r===0?1:t/r),i[2]=n[2],i}function ba(n,{start:e,end:t,type:i},s=g()){const r=de($i,n,e),o=de(Ti,t,e),l=Z(r,o)/Z(o,o);return G(s,e,o,i===O.RAY?Math.max(l,0):l)}const kh=(()=>{const n=g(),e=g(),t=g();return({start:i,end:s},{center:r,radius:o,normal:l,slicePlane:c})=>{const h=Vn(r,l,Ah);if(R(cs(h,i),0)&&R(cs(h,s),0)){ta(l,n,e);const p=(m,y)=>(Te(t,y,r),Be(m,Z(t,n),Z(t,e)),m),_=Sh({start:p(In,i),end:p(wi,s),type:O.LINE},ec,o),f=[];for(const[m,y]of _){const w=oe(g(),r);G(w,w,n,m),G(w,w,e,y),c&&!mt(c,w)||f.push(w)}return f}const d=g();return Qs(h,i,s,d)?!R(dt(d,r),o)||c&&!mt(c,d)?[]:[d]:[]}})();function xa({start:n,end:e,type:t},i,s){const r=[],o=Te($i,e,n),l=X(wi,n,i),c=qt(o),h=2*yt(o,l),d=h*h-4*c*(qt(l)-s*s);if(d===0){const p=-h/(2*c);(t===O.LINE||p>=0)&&r.push(G(g(),n,o,p))}else if(d>0){const p=Math.sqrt(d),_=(-h+p)/(2*c);(t===O.LINE||_>=0)&&r.push(G(g(),n,o,_));const f=(-h-p)/(2*c);(t===O.LINE||f>=0)&&r.push(G(g(),n,o,f))}return r}function wa(n,e){const t=n.start,i=n.end,s=e.start,r=e.end,o=de($i,i,t),l=de(Ti,r,s),c=de(rr,s,t),h=Ae(Ta,o,l);if(!R(Z(c,h),0))return[];const d=is(h);if(R(d,0))return[];const p=Ae(Ea,c,l),_=Z(p,h)/d,f=G(Sa,t,o,_);if(n.type===O.RAY){const m=de(ds,f,t);if(Z(o,m)<-xn())return[]}if(e.type===O.RAY){const m=de(ds,f,s);if(Z(l,m)<-xn())return[]}return[_t(f)]}function Ch({start:n,end:e,type:t},i){const s=de($i,i,n),r=de(Ti,e,n),o=Ae(rr,r,s),l=is(o)/is(r),c=xn();if(l<c)switch(t){case O.LINE:return[_t(i)];case O.RAY:return Z(r,s)<-c?[]:[_t(i)]}return[]}function sr(n,e,t,i){const[s,r]=n,[o,l]=t,c=o-s,h=l-r,d=c*c+h*h,p=Math.sqrt(d);if(p>e+i)return[];if(p<Math.abs(e-i))return[];if(R(p,0)&&R(e,i))return[];const _=(e*e-i*i+d)/(2*p),f=Math.sqrt(e*e-_*_),m=f*h/p,y=f*c/p,[w,b]=Vo(In,n,t,_/p);return R(m,y)?[gt(w,b)]:[gt(w+m,b-y),gt(w-m,b+y)]}function ci(n,e,{start:t,end:i,type:s}){return N(n.start,t[0],t[1],e),N(n.end,i[0],i[1],e),n.type=Vh[s],n}function $a(n,e){return R(n[2],e[2])}function R(n,e){return cn(Math.abs(n-e),0,xn())}function Rh(n,e){return e.filter(t=>mt(n,t))}function mt(n,e){return na(n,e)}var xe;(function(n){n[n.PLANE=0]="PLANE",n[n.HALF_PLANE=1]="HALF_PLANE"})(xe||(xe={}));const Vh={[xe.PLANE]:O.LINE,[xe.HALF_PLANE]:O.RAY},In=L(),wi=L(),$i=g(),Ti=g(),rr=g(),Ta=g(),Ea=g(),Sa=g(),ds=g(),Ah=ae(),or={start:g(),end:g(),type:O.LINE},Oh={start:g(),end:g(),type:O.LINE};class $e{intersect(e){return Ue(this,e)}closestPoints(e){return[this.closestTo(e)]}}class Jt extends $e{constructor(e){super(),this.point=e}equals(e){return this===e||ve(e)&&H(this.point,e.point)}closestTo(){return Xt(this.point)}}class ar extends $e{constructor(e,t,i){super(),this.start=e,this.end=t,this.lineLike={start:e,end:t,type:i}}equals(e){return this===e||Ce(e)&&this.lineLike.type===e.lineLike.type&&H(this.start,e.start)&&H(this.end,e.end)}closestTo(e){const t=j();return ba(e,this.lineLike,t),t}}class Pa extends ar{constructor(e,t){super(e,t,O.LINE)}}class Ih extends ar{constructor(e,t){super(e,t,O.RAY)}}class Ma extends $e{constructor(e){super(),this.constraints=e}equals(e){return this===e||ps(e)&&Zt(this.constraints,e.constraints,(t,i)=>t.equals(i))}closestTo(e){let t,i=1/0;for(const s of this.constraints){const r=s.closestTo(e),o=nc(e,r);o<i&&(i=o,t=r)}return Xt(t??e)}closestPoints(e){return this.constraints.flatMap(t=>t===this?[]:t.closestPoints(e))}}class ka extends $e{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||Ve(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const t=j();return va(e,this.center,this.radius,t),t}}class lr extends $e{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||Ne(e)&&H(this.center,e.center)&&this.radius===e.radius}closestTo(e){const t=j();return va(e,this.center,this.radius,t),t[2]=this.center[2],t}asCircle(){return new cr(Xt(this.center),this.radius,vt(0,0,1))}}class cr extends $e{constructor(e,t,i,s=void 0){super(),this.center=e,this.radius=t,this.normal=i,this.slicePlane=s}equals(e){return this===e||rt(e)&&H(this.center,e.center)&&H(this.normal,e.normal)&&this.radius===e.radius}closestTo(e){const{center:t,radius:i}=this;Js(this.getPlane(Lh),e,Bi);const s=de(Bi,Bi,t),r=Ao(s);if(R(r,0))return Xt(e);const o=i/Math.sqrt(r),l=j();G(l,t,s,o);const{slicePlane:c}=this;if(c&&!mt(c,l)){const h=hr(c,this);return(h==null?void 0:h.closestTo(e))??Xt(e)}return l}getPlane(e=ae()){return Vn(this.center,this.normal,e)}}const Bi=g(),Lh=ae();class Ca extends $e{constructor(e){super(),this.z=e}equals(e){return this===e||He(e)&&this.z===e.z}closestTo(e){return vt(e[0],e[1],this.z)}getPlane(e=ae()){return N(Yr,0,0,this.z),Vn(Yr,Hs,e)}}const Yr=g();class Ra extends $e{constructor(e,t,i){super(),this.start=e,this.end=t,this.planeLike={start:e,end:t,type:i}}equals(e){return this===e||Re(e)&&this.planeLike.type===e.planeLike.type&&H(this.start,e.start)&&H(this.end,e.end)}closestTo(e){const t=j();return _a(e,this.planeLike,t),t}closestEndTo(e){const{start:t,end:i}=this.planeLike;return Math.sign(yt(X(Dh,i,t),X(Gh,e,t)))>0?this.end:this.start}getPlane(e=ae()){const t=oe(Xr,this.end);return t[2]+=1,ia(this.start,this.end,t,e)}getSlicePlane(e=ae()){const{start:t,end:i,type:s}=this.planeLike;if(s===xe.PLANE)return;const r=N(Xr,t[0],t[1],0),o=N(jr,i[0],i[1],0),l=Te(jr,o,r);return Vn(r,l,e),e}}const Dh=L(),Gh=L(),Xr=g(),jr=g();class zh extends Ra{constructor(e,t){super(e,t,xe.HALF_PLANE)}}class Uh extends $e{constructor(e,t){super(),this.sphere=Ou(e,t)}equals(e){return this===e||Fe(e)&&Iu(this.sphere,e.sphere)}closestTo(e){const t=j();return Lu(this.sphere,e,t),t}get center(){return Du(this.sphere)}get radius(){return this.sphere[3]}}class Hh extends $e{constructor(e,t,i){super(),this.start=e,this.end=t,this.getZ=i,this.planeLike={start:e,end:t,type:xe.PLANE}}equals(e){return this===e||ui(e)&&H(this.start,e.start)&&H(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return qh(this,e)}addIfOnTheGround(e,t){for(const i of t){const s=this.getZ(i[0],i[1])??0;R(i[2],s)&&(i[2]=s,e.push(i))}}}class ur extends $e{constructor(e,t,i){super(),this._x=e,this._y=t,this._z=i}equals(e){return this===e||ad(e)&&this._x===e._x&&this._y===e._y&&this._z===e._z}closestTo([e,t,i]){return ra(this._x??e,this._y??t,this._z??i)}}class Va extends $e{constructor(e,t,i,s,r){super(),this._origin=e,this._spatialReference=t,this._distanceMeters=i,this._z=s,this._directionDegrees=r}equals(e){return this===e||od(e)&&Mr(this._origin,e._origin)&&this._spatialReference===e._spatialReference&&this._distanceMeters===e._distanceMeters&&this._z===e._z&&this._directionDegrees===e._directionDegrees}closestTo([e,t,i]){return Be(rn,e,t),Mr(rn,this._origin)||this._applyDirectionAndDistance(rn),ra(rn[0],rn[1],this._z??i)}_applyDirectionAndDistance(e){if(this._directionDegrees!=null&&this._distanceMeters!=null)Tn(e,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(this._directionDegrees!=null)Fh(e,this._origin,this._directionDegrees,e,this._spatialReference);else if(this._distanceMeters!=null){const{azimuth:t}=mi(Nh,this._origin,e,this._spatialReference);Tn(e,this._origin,t??0,this._distanceMeters,this._spatialReference)}}}const rn=[0,0],Nh=new yi;function Fh(n,e,t,i,s){let{azimuth:r,distance:o}=mi(Zh,e,i,s);r??(r=0);let l=o*Math.cos((r-t)*oc);l=Math.max(0,l),Tn(n,e,t,l,s)}const Zh=new yi;function qh(n,e){const t=j();return _a(e,n.planeLike,t),t[2]=n.getZ(t[0],t[1])??Oa,t}function Ue(n,e){if(ps(n)){const t=[];for(const i of n.constraints){const s=i.intersect(e);s&&t.push(s)}return Ln(t)}if(ps(e))return Ue(e,n);if(ui(n))return Kr(n,e);if(ui(e))return Kr(e,n);if(ve(n)){const{point:t}=n;if(ve(e))return H(t,e.point)?n:void 0;const i=e.closestTo(t);return Bt(i,t)?n:void 0}if(Ce(n)){if(ve(e))return Ue(e,n);if(Ce(e))return Se(wa(n.lineLike,e.lineLike));if(He(e))return Bh(n,e);if(Re(e))return Se(ma(e.planeLike,n.lineLike));if(Ve(e))return Se(xa(n.lineLike,e.center,e.radius));if(rt(e))return Se(kh(n.lineLike,e));if(Ne(e))return Wh(n,e);if(Fe(e))return Yh(n,e)}else if(He(n)){if(ve(e)||Ce(e))return Ue(e,n);if(He(e))return Xh(n,e);if(Re(e))return jh(n,e);if(Ve(e))return Kh(n,e);if(rt(e))return Jh(n,e);if(Ne(e))return Qh(n,e);if(Fe(e))return ed(n,e)}else if(Re(n)){if(ve(e)||Ce(e)||He(e))return Ue(e,n);if(Re(e))return Wi(ya(n.planeLike,e.planeLike));if(Ve(e))return Wi(ir(n.planeLike,e.center,e.radius));if(rt(e))return nd(n,e);if(Ne(e))return td(n,e);if(Fe(e))return id(n,e)}else if(Ve(n)){if(ve(e)||Ce(e)||He(e)||Re(e))return Ue(e,n);if(Ve(e))return Wi(sr(n.center,n.radius,e.center,e.radius));if(rt(e))return void 0;if(Ne(e))return sd(n,e);if(Fe(e))return void 0}else if(rt(n)){if(ve(e)||Ce(e)||He(e)||Re(e)||Ve(e))return Ue(e,n);if(rt(e))return void 0;if(Ne(e))return e.asCircle(),void 0;if(Fe(e))return void 0}else if(Ne(n)){if(ve(e)||Ce(e)||He(e)||Re(e)||Ve(e)||rt(e))return Ue(e,n);if(Ne(e))return rd(e,n);if(Fe(e))return void 0}else if(Fe(n)){if(ve(e)||Ce(e)||He(e)||Re(e)||Ve(e)||Ne(e))return Ue(e,n);if(Fe(e))return void 0}}const Bh=(()=>{const n=ae();return(e,t)=>{const{start:i,end:s}=e;if($a(i,s)&&R(i[2],t.z))return e;const r=j();return Qs(t.getPlane(n),i,s,r)?new Jt(r):void 0}})();function Wh({lineLike:n},{center:e,radius:t}){const i=e[2];return Se(xa(n,e,t).filter(s=>R(s[2],i)))}function Yh({lineLike:n},{sphere:e}){return Se(Au(e,n.start,n.end))}const hr=(()=>{const n=Oo(),e=g(),t=g();return(i,s,r)=>{const{normal:o,center:l,radius:c}=s;ta(o,e,t);const h=zt(i),d=c*Z(h,e),p=c*Z(h,t);ic(n,l[0],l[1],l[2],1);const _=sc(i,n),f=Math.hypot(d,p),m=R(f,0);if(R(cs(i,l),0)){if(m)return s;if(R(c,0))return!r||mt(r,l)?new Jt(Xt(l)):void 0;Ae(e,h,o),lt(e,e);const W=new Array,ge=_t(l);G(ge,ge,e,c),r&&!mt(r,ge)||W.push(ge);const le=_t(l);return G(le,le,e,-c),r&&!mt(r,le)||W.push(le),Se(W)}if(m)return;const y=-_/f;if(Math.abs(y)>1||R(y,1))return;const w=Math.atan(d/p),b=rc(y)-w,$=Math.PI-b,M=new Array,K=g();G(K,l,e,c*Math.cos(b)),G(K,K,t,c*Math.sin(b)),M.push(K);const Q=g();return G(Q,l,e,c*Math.cos($)),G(Q,Q,t,c*Math.sin($)),M.push(Q),Se(r?Rh(r,M):M)}})();function Xh(n,e){return R(n.z,e.z)?n:void 0}function jh({z:n},{planeLike:e}){const[t,i]=e.start,[s,r]=e.end,o=vt(t,i,n),l=vt(s,r,n);return e.type===xe.PLANE?new Pa(o,l):new Ih(o,l)}function Kh(n,e){const[t,i]=e.center;return new lr(vt(t,i,n.z),e.radius)}function Qh(n,e){return R(e.center[2],n.z)?e:void 0}const Jh=(()=>{const n=ae();return(e,t)=>hr(e.getPlane(n),t,t.slicePlane)})();function ed(n,{center:e,radius:t}){const i=Math.abs(e[2]-n.z);if(i>t&&!R(i,t))return;const s=vt(e[0],e[1],n.z),r=Math.sqrt(t**2-i**2);return R(r,0)?void 0:new lr(s,r)}const td=(()=>{const n=ae();return(e,{center:t,radius:i})=>{const s=ir(e.planeLike,t,i),r=t[2];e.getSlicePlane(n);const o=new Array;for(const[l,c]of s){const h=[l,c,r];mt(n,h)&&o.push(h)}return Se(o)}})(),nd=(()=>{const n=ae(),e=ae();return(t,i)=>hr(t.getPlane(n),i,t.getSlicePlane(e))})(),id=(()=>{const n=ae();return(e,{center:t,radius:i})=>{const s=e.getPlane(n),r=Vt(s,t),o=Math.abs(r);if(o>i&&!R(o,i))return;const l=Math.sqrt(i**2-r**2);if(R(l,0)){const d=j();return Js(s,t,d),new Jt(d)}const c=j(),h=_t(zt(s));return G(c,t,h,r),new cr(c,l,h,e.getSlicePlane())}})();function sd(n,e){const t=si(n.center,e.center);return R(t,0)&&R(n.radius,e.radius)?e:Aa(sr(n.center,n.radius,e.center,e.radius),e.center[2])}function rd(n,e){if(!$a(n.center,e.center))return;const t=si(n.center,e.center);return R(t,0)&&R(n.radius,e.radius)?n:Aa(sr(n.center,n.radius,e.center,e.radius),n.center[2])}function Kr(n,e){const{planeLike:t,getZ:i}=n,s=new Array;if(ve(e))n.addIfOnTheGround(s,Mh(t,e.point));else if(Ce(e))n.addIfOnTheGround(s,ma(t,e.lineLike));else if(Ve(e))for(const[r,o]of ir(t,e.center,e.radius)){const l=i(r,o);l!=null&&s.push(ht(r,o,l))}else if(Re(e)||ui(e))for(const[r,o]of ya(t,e.planeLike)){const l=i(r,o)??Oa;s.push(ht(r,o,l))}return Se(s)}function Wi(n){return Ln(n.map(([e,t])=>{const i=vt(e,t,0),s=vt(e,t,1);return new Pa(i,s)}))}function Se(n){return Ln(n.map(e=>e?new Jt(e):void 0))}function Aa(n,e){return Se(n.map(([t,i])=>[t,i,e]))}function Ln(n){if(n.length!==0)return n.length===1?n[0]??void 0:new Ma(n.filter(kn))}function ps(n){return n instanceof Ma}function ve(n){return n instanceof Jt}function Ce(n){return n instanceof ar}function He(n){return n instanceof Ca}function Re(n){return n instanceof Ra}function Ve(n){return n instanceof ka}function Ne(n){return n instanceof lr}function rt(n){return n instanceof cr}function Fe(n){return n instanceof Uh}function ui(n){return n instanceof Hh}function od(n){return n instanceof Va}function ad(n){return n instanceof ur}const Oa=0;var A;function dr(n,e){if(n==null||e==null)return;const t=fs(n,e);return t!=null?De(t,"radians","geographic"):void 0}(function(n){n.Absolute="absolute",n.Relative="relative",n.RelativeBilateral="relative-bilateral"})(A||(A={}));const fs=(()=>{const n=g(),e=g();return(t,i)=>(N(n,t.x,t.y,t.z??0),N(e,i.x,i.y,i.z??0),ld(n,e,t.spatialReference,i.spatialReference))})(),ld=(()=>{const n=L(),e=g(),t=g();return(i,s,r,o)=>{if(H(i,s))return;const l=oi(r),c=oi(o);if(l&&c&&Qt(l,c)&&be(i,r,e,l)&&be(s,o,t,c)){const{azimuth:d}=mi(dd,e,t,l);return d!=null?fi(d,"degrees","radians"):void 0}n[0]=s[0]-i[0],n[1]=s[1]-i[1];let h=ac(lc,n);return n[0]<0&&(h=pd-h),h}})();function cd(n,e,t,i=A.Absolute){if(e&&t)switch(i){case A.Absolute:return dr(e,t);case A.Relative:return hi(Qr(n,e,t),A.Relative);case A.RelativeBilateral:return hi(Qr(n,e,t),A.RelativeBilateral)}}function Qr(n,e,t){if(!n||!e||!t)return;const i=fs(n,e),s=fs(e,t);return i!=null&&s!=null?De(s-i,"radians","geographic"):void 0}function hi(n,e){if(n!=null)switch(e){case A.Absolute:return gs(n);case A.Relative:{const t=Pe(n);let i=Jr.normalize(t,0,!0);return i===-180&&(i=180),De(i,"degrees","geographic")}case A.RelativeBilateral:{const t=Pe(n),i=Math.abs(Jr.normalize(t,0,!0));return De(i,"degrees","geographic")}}}function gs(n){const e=Pe(n),t=fd.normalize(e,0,!0);return De(t,"degrees","geographic")}const ud=(()=>{const n=g();return(e,t,i,s,r,o="geodesic")=>{oe(n,t);const l=Pe(r);if(o==="geodesic"){const f=oi(i);if(f&&be(n,i,n,f))return Tn(e,n,l,s,f),e[2]=t[2],!!be(e,f,e,i)}const c=ea(l,"geographic","arithmetic"),h=fi(c,"degrees","radians"),d=t[0]+s*Math.cos(h),p=t[1]+s*Math.sin(h),_=t[2];return N(e,d,p,_),!0}})();function Pe(n){if(n!=null)return ea(hd(n),n.rotationType,"geographic")}function hd(n){return fi(n.value,n.unit,"degrees")}const dd=new yi,pd=2*Math.PI,fd=Io,Jr=new Ns(-180,180);function gd(n,e,t,i,s,r){let o="geodesic",l=oi(t);const c=j();return er(n,e,i,c),c[2]=0,l&&be(c,t,c,l)||(o="euclidean",l=t),{mode:o,view:e,elevationInfo:i,hasZ:s,directionMode:r,spatialReference:n.spatialReference,measurementSR:l,origin:c}}function md(n,e,t){if(e==null||n==null)return;const i=Fs(t.measurementSR);if(i==null)return;const s=Ei(n,t);if(s==null)return;const r=_i(e,i);return new ka(s,r)}function yd(n,e,t,i){if(t==null||n==null)return;const s=Ei(n,i);if(s==null)return;const r=Pe(t),o=10,l=h=>{if(h==null)return;const d=j(),p=De(h,"degrees","geographic");return ud(d,s,i.measurementSR,o,p,i.mode)?new zh(s,d):void 0},c=()=>{if(e!=null&&n!=null)return Pe(dr(e,n))};switch(i.directionMode){case A.Absolute:return l(r);case A.Relative:{const h=c();return h==null?void 0:l(h+r)}case A.RelativeBilateral:{const h=c();return h==null?void 0:Ln([l(h+r),l(h-r)])}}}function Ia(n,e){const t=Si(n,e);return t!=null?new Ca(t):void 0}function La(n,e,t){const{context:i,longitude:s,latitude:r,direction:o,distance:l,elevation:c}=t;if(s!=null||r!=null||l!=null||c!=null||o!=null){if(s!=null||r!=null){const h=Pe(s),d=Pe(r),p=Si(c,i);return new ur(h,d,p)}return _d(n,e,t)}}function _d(n,e,{context:t,direction:i,distance:s,elevation:r}){if(e==null)return Ia(r,t);const{view:o,elevationInfo:l,measurementSR:c}=t,h=er(e,o,l);if(!c||!be(h,e.spatialReference,eo,c))return;const[d,p]=eo,_=s!=null?_i(s,"meters"):void 0,f=Pe(i),m=Si(r,t),y=b=>{const $=new Va([d,p],c,_,m,b);return _==null||b==null||m==null&&t.hasZ?$:new Jt($.closestTo(h))};if(f==null)return y(void 0);const w=()=>{if(n!=null&&e!=null)return Pe(dr(n,e))};switch(t.directionMode){case A.Absolute:return y(f);case A.Relative:{const b=w();return b==null?void 0:y(b+f)}case A.RelativeBilateral:{const b=w();return b==null?void 0:Ln([y(b+f),y(b-f)])}}}function vd(n){return n.context.mode==="geodesic"?La(null,null,n):Da(n)}function bd(n,e,t){const{context:i,x:s,y:r,distance:o,direction:l,elevation:c}=t;return i.mode==="geodesic"?La(e,n,t):s!=null||r!=null?Da(t):xd([md(n,o,i),yd(n,e,l,i),Ia(c,i)])}function Da({x:n,y:e,elevation:t,context:i}){Nn.x=(n==null?void 0:n.value)??0,Nn.y=(e==null?void 0:e.value)??0,Nn.spatialReference=i.spatialReference;const s=Ei(Nn,i,Td);return new ur(n!=null&&s!=null?s[0]:void 0,e!=null&&s!=null?s[1]:void 0,Si(t,i))}function xd(n){let e;for(const t of n)t&&(e=(e==null?void 0:e.intersect(t))??t);return e}function Ei(n,e,t=j()){const{view:i,elevationInfo:s,measurementSR:r,origin:o,mode:l}=e;if(er(n,i,s,t),be(t,n.spatialReference,t,r))return l!=="geodesic"&&Te(t,t,o),t}function wd(n,e,t,i){const{view:s,measurementSR:r,spatialReference:o,origin:l,mode:c}=t;if(c==="geodesic"?oe(on,n):he(on,n,l),be(on,r,on,o))return Bu(on,s,e,t,i)}function Si(n,e){var t;return((t=$d(n,e))==null?void 0:t.value)??void 0}function $d(n,{view:e,origin:t,elevationInfo:i,hasZ:s,measurementSR:r}){if(n==null||!s)return;const o=Lo(r);if(o==null)return;const[l,c]=t,h=_i(n,o),d=(e==null?void 0:e.type)==="3d"?Ko(e,l,c,h,r,i):h;return d!=null?fe(d,o):void 0}const eo=j(),Td=j(),on=j(),Nn=Xs(0,0,0,pt.WGS84),to={toggle:"Control"},Ut={enterInputMode:"Tab",commit:"Enter",discard:"Escape",next:"Tab"},Me={moveUp:{key:"ArrowUp",modifier:"Shift",repeats:!0},moveDown:{key:"ArrowDown",modifier:"Shift",repeats:!0},moveLeft:{key:"ArrowLeft",modifier:"Shift",repeats:!0},moveRight:{key:"ArrowRight",modifier:"Shift",repeats:!0},scaleUp:{key:"+",modifier:"Shift"},scaleDown:{key:"-",modifier:"Shift"},factorModifier:{key:Do,continuePropagation:!0},toggleOpacity:"t",preserveAspectRatio:{key:"Shift",continuePropagation:!0},rotateIncrements:{key:"Shift",continuePropagation:!0}};let Ed=class{constructor(){this._bindings=new Map}add(e,t){return this.addToggle(e,i=>{i.type==="key-down"&&t(i)})}addToggle(e,t){const i=Sd.fromDefinition(e,t),s=cc(this._bindings,i.key,()=>[]);return s.push(i),B(()=>Go(s,i))}register(e,t=zo.WIDGET){return Mo([e.on("key-down",i=>this.dispatch(e.inputManager,i),t),e.on("key-up",i=>this.dispatch(e.inputManager,i),t)])}dispatch(e,t){const i=t.key,s=this._bindings.get(i);if(s)for(const r of s)r.process(e,t)}},Sd=class ms{constructor(e,t,i,s,r){this.key=e,this.modifiers=t,this.repeats=i,this.continuePropagation=s,this.callback=r}process(e,t){if(!(t.key!==this.key||"repeat"in t&&t.repeat&&!this.repeats)){for(const i of this.modifiers)if(!e.isModifierKeyDown(i))return;this.continuePropagation||t.stopPropagation(),this.callback(t)}}static fromDefinition(e,t){if(typeof e=="string")return new ms(e,[],!1,!1,t);const{key:i,modifier:s,repeats:r,continuePropagation:o}=e;return new ms(i,s?Array.isArray(s)?s:[s]:[],!!r,!!o,t)}};const J="esri-tooltip",Pd=`${J}-content`,Md=`${J}-content--input`,kd=`${J}-content__header`,Cd=`${J}-content__header__spacer`,no=`${J}-content__header__actions`,Ga=`${J}-draw-header-actions`,Rd=`${J}-table`,Vd=`${J}-help-message`,Ad=`${J}-help-message__text`,Od=`${J}-help-message__icon`,Fn=`${J}-field`,Zn={base:Fn,inputMode:`${Fn}--input`,title:`${Fn}__title`,value:`${Fn}__value`};let z=class extends Cn{constructor(){super(...arguments),this.hidden=!1,this.mode="feedback"}render(){return v("div",{class:this.classes({[Zn.base]:!0,[Zn.inputMode]:this.mode==="input"})},v("div",{class:Zn.title,key:"title"},this.title),v("div",{class:Zn.value,key:"value"},this.value))}};a([u()],z.prototype,"hidden",void 0),a([u()],z.prototype,"mode",void 0),a([u()],z.prototype,"title",void 0),a([u()],z.prototype,"value",void 0),z=a([x("esri.views.interactive.tooltip.components.TooltipField")],z);const Id={base:`${J}-value-by-value`};let We=class extends Cn{constructor(){super(...arguments),this.divider="×"}render(){return v("div",{class:Id.base},v("span",null,this.left),v("span",null,this.divider),v("span",null,this.right))}};a([u()],We.prototype,"left",void 0),a([u()],We.prototype,"divider",void 0),a([u()],We.prototype,"right",void 0),We=a([x("esri.views.interactive.tooltip.components.ValueByValue")],We);function ys(n){let e,t,i=[],s=!1;function r(...o){return s&&e===this&&Ld(o,i)||(t=n.apply(this,o),e=this,i=o,s=!0),t}return r}function Ld(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}function io(n){var s,r;const e="metric";if(n==null)return e;const t=n.map,i=(t&&"portalItem"in t?(s=t.portalItem)==null?void 0:s.portal:null)??uc.getDefault();switch(((r=i.user)==null?void 0:r.units)??i.units){case e:return e;case"english":return"imperial"}return hc(n.spatialReference)??e}function pr(n,e,t,i=2,s="abbr"){return _u(n,et(e,t).value,t,i,s)}function za(n,e,t,i=2,s="abbr"){return gu(n,et(e,t).value,t,i,s)}function Dd(n,e,t=2,i="abbr"){return xu(n,e.value,e.unit,t,i)}function Gd(n,e,t=2,i="abbr"){return $u(n,e.value,e.unit,t,i)}function zd(n,e,t=2,i="abbr"){return vu(n,e.value,e.unit,t,i)}function Ud(n,e,t=2,i="abbr"){return mu(n,e.value,e.unit,t,i)}function Hd(n,e,t=2,i="abbr"){return Eu(n,e.value,e.unit,t,i)}function Nd(n,e,t=2,i="abbr"){return wu(n,e.value,e.unit,t,i)}function Fd(n,e,t=2,i="abbr"){return Tu(n,e.value,e.unit,t,i)}function Zd(n,e,t=2,i="abbr"){return bu(n,e.value,e.unit,t,i)}function qd(n,e,t=2,i="abbr"){return yu(n,e.value,e.unit,t,i)}function Bd(n,e,t=2,i="abbr"){return Su(n,e.value,e.unit,t,i)}function Pi(n,e,t,i=Io,s=!0){return fu(n.value,n.unit,n.rotationType,e,t,i,s)}function so(n,e,t,i,s="abbr"){switch(i=i??2,t){case"imperial":return Nd(n,e,i,s);case"metric":return Dd(n,e,i,s);default:return pr(n,e,t,i,s)}}function Wd(n,e,t,i=2,s="abbr"){switch(t){case"imperial":return Fd(n,e,i,s);case"metric":return Gd(n,e,i,s);default:return za(n,e,t,i,s)}}function Yd(n,e,t,i=2,s="abbr"){switch(t){case"imperial":return Zd(n,e,i,s);case"metric":return zd(n,e,i,s);default:return pr(n,e,t,i,s)}}function Xd(n,e,t,i=2,s="abbr"){switch(t){case"imperial":return qd(n,e,i,s);case"metric":return Ud(n,e,i,s);default:return za(n,e,t,i,s)}}function jd(n,e,t,i=2,s="abbr"){switch(t){case"imperial":return Bd(n,e,i,s);case"metric":return Hd(n,e,i,s);default:return pr(n,e,t,i,s)}}const Mi=1,Ua=6;function Kd(n,e){return{angleRelative:Qd,direction:Jd,directionRelative:ep,directionRelativeBilateral:tp,latitudeDecimalDegrees:ip,longitudeDecimalDegrees:np,area:(t,i)=>jd(n,t,i??e.area),length:(t,i,s)=>so(n,t,i??e.length,s),lengthRelative:(t,i)=>Wd(n,t,i??e.length),totalLength:(t,i)=>so(n,t,i??e.length),verticalLength:(t,i)=>Yd(n,t,i??e.verticalLength),verticalLengthRelative:(t,i)=>Xd(n,t,i??e.verticalLength),percentage:op,scalar:Fa,scale:ap}}function Qd(n){return Rn(n,{signDisplay:"exceptZero",...fr(Mi)})}function Jd(n){return Pi(n,n.rotationType,Mi)}function ep(n){const e=Pe(n);return Rn(e,{style:"unit",unitDisplay:"narrow",unit:"degree",signDisplay:e>0?"never":"exceptZero",...fr(Mi)})}function tp(n){return Pi(n,n.rotationType,Mi)}function np(n){return Ha(n,Ba)}function ip(n){return Ha(n,Wa)}function sp(n){return Na(n,Ba)}function rp(n){return Na(n,Wa)}function Ha(n,e){return Pi(et(n,"degrees"),"geographic",Ua,e,!1)}function Na(n,e){const i=e.normalize(et(n,"degrees").value,void 0,!1);return Fa(Ke(i),Ua)}function op(n){return Rn(n.value,{style:"percent"})}function ap(n){return Rn(n,{style:"percent",maximumFractionDigits:0})}function Fa(n,e){return Rn(n.value,fr(e))}function fr(n){return{minimumFractionDigits:n,maximumFractionDigits:n}}function bt({createQuantity:n,sanitize:e}){return(t,i)=>{if(t==null)return null;e&&(t=e(t));const s=Ft(t);return s==null?null:n(s,i)}}function Za(n){return n.replaceAll(/[*^~°º]/g,"")}const lp=n=>{let e=`[-+]?[0-9${n.thousands}]+`;return n.decimal!==""&&(e+=`${n.decimal}[0-9]+`),new RegExp(`^(${e}\\s*)${n.separator}(\\s*${e})$`,"i")},cp=" ",qa=[];for(const n of[",","\\|","\\s+"])for(const e of["\\.",",",""])for(const t of["",",","\\.",cp,"\\s+"])n!==e&&n!==t&&e!==t&&qa.push({separator:n,decimal:e,thousands:t,pattern:lp({decimal:e,thousands:t,separator:n})});function up(n){for(const{decimal:e,thousands:t,pattern:i}of qa){i.lastIndex=0;const s=n.match(i);if(!s)continue;const r=Ft(ro(s[1],e,t)),o=Ft(ro(s[2],e,t));if(r!=null&&o!=null)return{x:Ke(r),y:Ke(o)}}return null}function ro(n,e,t){let i=n.replaceAll(/[\s+]/g,"");return t!==""&&(i=i.replaceAll(t,"")),e!==""&&(i=i.replaceAll(e,".")),i}function hp(n){if(!n||Ft(n)!=null||!tr())return null;const e=Sn(n),t=Kt(e==null?void 0:e.latitude),i=Kt(e==null?void 0:e.longitude);return i!=null&&t!=null?{latitude:t,longitude:i}:null}function dp(n){return Kt(ah(n))}function pp(n){return Kt(lh(n))}function Kt(n){return n!=null?De(n,"degrees","geographic"):null}const Ba=new Ns(-180,180),Wa=new Ns(-90,90),Yi=Symbol("dragHandles");let E=class extends Cn{constructor(){super(...arguments),this._focusAbortController=new AbortController,this._transitionInfo=null,this._mode="feedback",this._getFormatters=ys(Kd),this._onHeaderPointerDown=e=>{var i;const t=e.target;t instanceof HTMLElement&&((i=t==null?void 0:t.tagName)==null?void 0:i.toLowerCase())!=="calcite-button"&&(this.removeHandles(Yi),t.setPointerCapture(e.pointerId),this.tooltip.onDragStart(e.clientX,e.clientY),this.addHandles([gn(t,"pointermove",({clientX:s,clientY:r})=>{this.tooltip.onDrag(s,r)}),gn(t,["pointerup","pointercancel"],s=>{this.removeHandles(Yi),t.releasePointerCapture(e.pointerId),this.tooltip.onDragEnd()}),gn(t,"touchstart",s=>s.preventDefault())],Yi))},this._onDiscard=()=>{this.destroyed||(this.tooltip.emit("discard"),this.info.clearInputValues(),this.exitInputMode())},this._onCommit=(e,t)=>{if(this.destroyed)return;if(this.tooltip.emit("commit",{type:t}),t==="commit-and-exit")return void this.exitInputMode();if(t==="commit-on-blur")return;const i=this._getFocusableElements(),s=i.length,r=i.indexOf(e);if(r===-1)return void this.exitInputMode();const o=((r+(t==="commit-and-next"?1:-1))%s+s)%s;qn(i.at(o))},this._onKeyDown=e=>{switch(e.code){case Ut.next:return this._onNextKey(e);case Ut.discard:return e.stopPropagation(),this._onDiscard()}}}get mode(){return this._mode}get _displayUnits(){const{displayUnits:e}=this.info.sketchOptions.values,t=io(this.tooltip.view);return{length:e.length??t,verticalLength:e.verticalLength??t,area:e.area??t}}get _inputUnitInfos(){const e=this._messagesUnits,t=c=>({unit:c,abbreviation:Pu(e,c,"abbr")}),{inputUnits:i}=this.info.sketchOptions.values,s=io(this.tooltip.view),r=i.length??s,o=i.verticalLength??s,l=i.area??s;return{length:t(fc(r)),verticalLength:t(pc(o)),area:t(dc(l)),angle:t("degrees")}}get _formatters(){return this._getFormatters(this._messagesUnits,this._displayUnits)}get fieldContext(){return{formatters:this._formatters,inputUnitInfos:this._inputUnitInfos,messages:this._messagesTooltip,sketchOptions:this.info.sketchOptions,onCommit:this._onCommit,onDiscard:this._onDiscard}}render(){const{visibleElements:e}=this.info.sketchOptions.tooltips,t=this._renderedContent,i=this._renderedActions,s=this._renderedHelpMessage,r=t.length>0,o=r||!!s,l=this.mode==="input";return v("div",{class:gc(Pd,l&&Md),onkeydown:this._onKeyDown,tabIndex:-1},l&&o&&e.header?v("div",{class:kd,"data-testid":"tooltip-header",key:"header",onpointerdown:this._onHeaderPointerDown},v("calcite-button",{appearance:"transparent","data-testid":"tooltip-back-button",iconFlipRtl:"both",iconStart:"chevron-left",key:"discard-button",kind:"neutral",onclick:this._onDiscard,scale:"s",tabIndex:-1}),i.length>0?v(we,null,v("div",{class:Cd,key:"spacer"}),v("div",{class:no,key:"actions"},i)):null):null,r?v("div",{class:Rd,key:"content"},...t):null,s)}destroy(){var e;this._focusAbortController.abort(),(e=this._transitionInfo)==null||e.transition.skipTransition()}_renderActions(){return null}loadDependencies(){return Zs({button:()=>Ie(()=>import("./calcite-button-i_RwumFW.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])),icon:()=>Ie(()=>import("./calcite-icon-J4sAtRdE.js"),__vite__mapDeps([16,13,1,2,4,11])),input:()=>Ie(()=>import("./calcite-input-CnZUsYSl.js"),__vite__mapDeps([17,18,1,2,4,3,5,10,6,7,8,9,11,12,13]))})}async enterInputMode(e,t){try{await this._transitionTo("input",t),await this._focusField(e)}catch(i){kr(i)}}async exitInputMode({focusOnView:e=!0}={}){var t;try{const{container:i,info:s}=this;s.clearInputValues();const r=e?(t=i==null?void 0:i.closest(".esri-view"))==null?void 0:t.querySelector(".esri-view-surface"):null;await this._transitionTo("feedback"),r instanceof HTMLElement&&r.focus()}catch(i){kr(i)}}_onNextKey(e){const t=this._getFocusableElements(),i=t.at(0),s=t.at(-1);i&&s&&(e.shiftKey?document.activeElement===i&&(e.preventDefault(),e.stopPropagation(),qn(s)):document.activeElement===s&&(e.preventDefault(),e.stopPropagation(),qn(i)))}get _renderedContent(){return oo(this._renderContent())}get _renderedActions(){return oo(this._renderActions())}get _renderedHelpMessage(){const{sketchOptions:e,visibleElements:t}=this.info;if(!t.helpMessage)return null;const i=e.tooltips.helpMessage??this._defaultHelpMessage;if(!i)return null;const s=e.tooltips.helpMessageIcon??"information";return v("div",{class:Vd,key:"help-message"},s?v("calcite-icon",{class:Od,icon:s,scale:"s"}):null,v("div",{class:Ad},i))}get _defaultHelpMessage(){var s,r,o;const{helpMessage:e,viewType:t}=this.info;if(e==null)return null;const i=t==="3d"?"helpMessages3d":"helpMessages2d";return(o=(r=(s=this._messagesTooltip)==null?void 0:s.sketch)==null?void 0:r[i])==null?void 0:o[e]}async _focusField(e){var r;(r=this._focusAbortController)==null||r.abort(),this._focusAbortController=new AbortController;const{signal:t}=this._focusAbortController;await this._waitForInputs(),mc(t);const i=this._getFocusableInputs(),s=e?i.find(o=>o.getAttribute("data-field-name")===e):i.at(0);await qn(s)}async _transitionTo(e,t){var r,o,l;if(this._mode===e&&!this._transitionInfo)return;if(((r=this._transitionInfo)==null?void 0:r.mode)===e)return this._transitionInfo.transition.finished;(o=this._transitionInfo)==null||o.transition.skipTransition();const i=async()=>{this.destroyed||(this._mode=e,await Cr(),this.destroyed||(this.renderNow(),await Cr(),this.destroyed||(t==null||t())))};if(!((l=this.domNode)!=null&&l.firstChild)||!document.startViewTransition||yc())return void await i();this.autoRenderingEnabled=!1;const s=this._transitionInfo={transition:document.startViewTransition(async()=>{this.destroyed||s!==this._transitionInfo||(this.autoRenderingEnabled=!0,await i())}),mode:e};try{await s.transition.finished}finally{s===this._transitionInfo&&(this._transitionInfo=null)}}async _waitForInputs(){const e=()=>{var t;return Array.from(((t=this.domNode)==null?void 0:t.querySelectorAll("calcite-input"))??[])};for(;e().length===0;)await _c(fp);await Uo()}_getFocusableInputs(){var e;return Array.from(((e=this.domNode)==null?void 0:e.querySelectorAll("calcite-input:not([read-only]):not([disabled])"))??[])}_getFocusableElements(){var t;const e=(t=this.domNode)==null?void 0:t.querySelector(`.${Ga}`);return[...Array.from((e==null?void 0:e.querySelectorAll(`.${no} calcite-button:not([disabled])`))??[]),...this._getFocusableInputs()]}};async function qn(n){await(n==null?void 0:n.setFocus())}function oo(n){return(Array.isArray(n)?n:[n]).flat(10).filter(e=>!!e)}a([ss("esri/core/t9n/Units"),u()],E.prototype,"_messagesUnits",void 0),a([ss("esri/views/interactive/tooltip/t9n/Tooltip"),u()],E.prototype,"_messagesTooltip",void 0),a([u()],E.prototype,"info",void 0),a([u()],E.prototype,"tooltip",void 0),a([u()],E.prototype,"_mode",void 0),a([u()],E.prototype,"mode",null),a([u()],E.prototype,"_displayUnits",null),a([u()],E.prototype,"_inputUnitInfos",null),a([u()],E.prototype,"_formatters",null),a([u()],E.prototype,"fieldContext",null),a([u()],E.prototype,"_renderedContent",null),a([u()],E.prototype,"_renderedActions",null),a([u()],E.prototype,"_renderedHelpMessage",null),a([u()],E.prototype,"_defaultHelpMessage",null),E=a([x("esri.views.interactive.tooltip.content.TooltipContent")],E);const fp=20;let _s=class extends E{_renderContent(){const{area:e,radius:t,xSize:i,ySize:s,visibleElements:r}=this.info,o=this._messagesTooltip.sketch,l=this._formatters;return v(we,null,r.radius&&t!=null?v(z,{title:o.radius,value:l.length(t)}):null,r.size&&i!=null&&s!=null?v(z,{title:o.size,value:v(We,{left:l.length(i),right:l.length(s)})}):null,r.area?v(z,{title:o.area,value:l.area(e)}):null)}};_s=a([x("esri.views.interactive.tooltip.content.TooltipContentDrawCircle")],_s);const ce=`${J}-editable-field`,se={base:ce,inputMode:`${ce}--input`,feedbackMode:`${ce}--feedback`,readOnly:`${ce}--read-only`,locked:`${ce}--locked`,title:`${ce}__title`,value:`${ce}__value`,valueContent:`${ce}__value__content`,valueContentReadOnly:`${ce}__value__content--read-only`,lockIcon:`${ce}__lock-icon`,input:`${ce}__input`,inputSuffix:`${ce}__input-suffix`,button:`${ce}__button`},Xi={lock:"lock",unlock:"unlock"};let ye=class extends Cn{constructor(){super(...arguments),this._input=null,this._lock=null,this._onLockClick=()=>{this.field.toggleLock(this.context)},this._onLockAfterCreate=e=>{this._lock=e},this._onLockAfterRemoved=()=>{this._lock=null},this._onKeyDown=e=>{e.key===Ut.discard&&this.mode==="input"&&this._input&&this.context.onDiscard(this._input)},this._onInputKeyDown=e=>{const t=this._input;if(t)switch(e.key){case Ut.commit:return this.field.onCommit("commit-and-exit",t,this.context);case Ut.next:{e.preventDefault(),e.stopPropagation();const i=e.shiftKey?"commit-and-previous":"commit-and-next";return this.field.onCommit(i,t,this.context)}}},this._onInput=e=>{this.field.onInput(e.target.value)},this._onInputBlur=e=>{const t=this._input;t&&e.relatedTarget!==this._lock&&this.field.onCommit("commit-on-blur",t,this.context)},this._selectText=()=>{const e=()=>{var t;this._input===document.activeElement&&((t=this._input)==null||t.selectText())};e(),Uo().then(e)},this._onAfterCreate=e=>{this._input=e,e.addEventListener("paste",this._onPaste),e.addEventListener("beforeinput",this._onBeforeInput)},this._onAfterRemoved=e=>{e.removeEventListener("paste",this._onPaste),e.removeEventListener("beforeinput",this._onBeforeInput)},this._onPaste=e=>{var i;const t=(i=e.clipboardData)==null?void 0:i.getData("text");t&&this.field.parse(t,this.context)!=null&&(e.stopPropagation(),this.field.onInput(t))},this._onBeforeInput=e=>{(e.inputType==="historyUndo"||e.inputType==="historyRedo")&&!this.field.dirty&&e.preventDefault()}}initialize(){this.addHandles(U(()=>this._rawDisplayValue,()=>{const{committed:e,inputValue:t}=this.field;e||t||this._input!==document.activeElement||this._selectText()}))}loadDependencies(){return Zs({button:()=>Ie(()=>import("./calcite-button-i_RwumFW.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])),icon:()=>Ie(()=>import("./calcite-icon-J4sAtRdE.js"),__vite__mapDeps([16,13,1,2,4,11])),input:()=>Ie(()=>import("./calcite-input-CnZUsYSl.js"),__vite__mapDeps([17,18,1,2,4,3,5,10,6,7,8,9,11,12,13]))})}render(){const{field:e,mode:t}=this,i=t==="input",{locked:s,readOnly:r}=e;return v("div",{class:this.classes({[se.base]:!0,[se.feedbackMode]:t==="feedback",[se.inputMode]:t==="input",[se.locked]:s,[se.readOnly]:r})},v("div",{class:se.title,key:"title"},this._title),v("div",{class:se.value,key:"value",onkeydown:this._onKeyDown},i?this._renderValueInputMode():this._renderValueFeedbackMode()))}get _formattedValue(){return this.field.getFormattedValue(this.context)||ao}get _rawDisplayValue(){return this.field.getRawDisplayValue(this.context)}get _suffix(){return this.field.getSuffix(this.context)}get _title(){const{title:e}=this.field;return typeof e=="string"?e:e(this.context)}_renderValueFeedbackMode(){return v(we,null,v("div",{class:se.valueContent,key:"value-feedback"},this._formattedValue),this.field.locked&&this.mode!=="input"?v("calcite-icon",{class:se.lockIcon,icon:Xi.lock,key:"icon",scale:"s"}):null)}_renderValueInputMode(){return this.field.readOnly?this._renderValueReadOnly():this._renderValueWritable()}_renderValueReadOnly(){return v("div",{class:this.classes(se.valueContent,se.valueContentReadOnly),key:"value-read-only"},this._formattedValue)}_renderValueWritable(){var l;const{field:e}=this,{name:t,invalid:i,locked:s}=e,r=((l=this.context)==null?void 0:l.messages.sketch)??{},o=s?r.unlockConstraint:r.lockConstraint;return v(we,null,v("calcite-input",{afterCreate:this._onAfterCreate,afterRemoved:this._onAfterRemoved,class:se.input,"data-field-name":t,"data-testid":`tooltip-field-${t}`,key:"input",onblur:this._onInputBlur,onfocus:this._selectText,onkeydown:this._onInputKeyDown,scale:"s",status:i?"invalid":"idle",type:"text",value:this._rawDisplayValue??ao,onCalciteInputInput:this._onInput}),v("div",{class:se.inputSuffix,key:"suffix"},this._suffix),e.lockable?v("calcite-button",{afterCreate:this._onLockAfterCreate,afterRemoved:this._onLockAfterRemoved,alignment:"center",appearance:"transparent",class:se.button,"data-testid":`tooltip-field-${t}-lock`,iconStart:s?Xi.lock:Xi.unlock,key:"lock",kind:"neutral",label:o,onclick:this._onLockClick,scale:"s",tabIndex:-1,title:o}):v("div",{key:"lock-empty"}))}};a([u()],ye.prototype,"field",void 0),a([u()],ye.prototype,"context",void 0),a([u()],ye.prototype,"mode",void 0),a([u()],ye.prototype,"_input",void 0),a([u()],ye.prototype,"_lock",void 0),a([u()],ye.prototype,"_formattedValue",null),a([u()],ye.prototype,"_rawDisplayValue",null),a([u()],ye.prototype,"_suffix",null),a([u()],ye.prototype,"_title",null),ye=a([x("esri.views.interactive.tooltip.components.TooltipEditableField")],ye);const ao="—";function tt(n){const e=n.fields.filter(t=>(t==null?void 0:t.visible)===!0);return e.length===0?null:v(we,null,e.map(t=>v(ye,{context:n.context,field:t,key:t.id,mode:n.mode})))}let vs=class extends E{_renderContent(){const{fieldContext:e,info:t,mode:i}=this,{visibleElements:s}=t;return v(tt,{context:e,fields:[s.coordinates?t.effectiveX:void 0,s.coordinates?t.effectiveY:void 0,s.elevation?t.elevation:void 0,s.orientation?t.orientation:void 0,s.scale?t.scale:void 0],mode:i})}};vs=a([x("esri.views.interactive.tooltip.content.TooltipContentDrawMesh")],vs);let bs=class extends E{_renderContent(){const{fieldContext:e,info:t,mode:i}=this,{elevation:s,visibleElements:r}=t;return v(tt,{context:e,fields:[r.coordinates?t.effectiveX:void 0,r.coordinates?t.effectiveY:void 0,r.elevation?s:void 0],mode:i})}};bs=a([x("esri.views.interactive.tooltip.content.TooltipContentDrawPoint")],bs);const ji={absolute:"absolute-direction",relative:"relative-direction"};let Tt=class extends Cn{constructor(e){super(e),this.visibleElements={}}render(){return v("div",{class:Ga},this._isElementVisible("direction")?v(gp,{messages:this.messages,sketchOptions:this.sketchOptions}):null)}loadDependencies(){return Zs({button:()=>Ie(()=>import("./calcite-button-i_RwumFW.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])),dropdown:()=>Ie(()=>import("./calcite-dropdown-DMhepRjP.js"),__vite__mapDeps([19,1,2,4,20,21,15,5,10,8,11,22])),"dropdown-item":()=>Ie(()=>import("./calcite-dropdown-item-BkiIw8Zj.js"),__vite__mapDeps([23,1,2,4,8,7,5,24,13,11])),"dropdown-group":()=>Ie(()=>import("./calcite-dropdown-group-DzaI9WZB.js"),__vite__mapDeps([25,1,2,11,24]))})}_isElementVisible(e){var t;return((t=this.visibleElements)==null?void 0:t[e])??this.sketchOptions.tooltips.visibleElements[e]}};function gp(n){var o,l,c,h;const{directionMode:e}=n.sketchOptions.values,t=(o=n.messages)==null?void 0:o.sketch,i=(l=t==null?void 0:t.directionModeSelect)==null?void 0:l.title,s="absolute",r="relative";return v("calcite-dropdown",{key:"direction-mode",placement:"bottom-end",scale:"s",widthScale:"s",onCalciteDropdownSelect:d=>{var _,f;const p=(f=(_=d.target.selectedItems)==null?void 0:_[0])==null?void 0:f.getAttribute("data-mode");n.sketchOptions.values.directionMode=p??"absolute"}},v("calcite-button",{alignment:"end",appearance:"transparent",iconStart:ji[e],kind:"neutral",label:i,scale:"s",slot:"trigger",title:i}),v("calcite-dropdown-group",{selectionMode:"single"},v("calcite-dropdown-item",{"data-mode":r,"data-testid":"tooltip-direction-mode-relative",iconStart:ji.relative,key:"relative",selected:e===r},(c=t==null?void 0:t.directionModeSelect)==null?void 0:c.relative),v("calcite-dropdown-item",{"data-mode":s,"data-testid":"tooltip-direction-mode-absolute",iconStart:ji.absolute,key:"absolute",selected:e===s},(h=t==null?void 0:t.directionModeSelect)==null?void 0:h.absolute)))}a([ss("esri/views/interactive/tooltip/t9n/Tooltip"),u()],Tt.prototype,"messages",void 0),a([u()],Tt.prototype,"sketchOptions",void 0),a([u()],Tt.prototype,"visibleElements",void 0),Tt=a([x("esri.views.interactive.tooltip.components.DrawHeaderActions")],Tt);let xs=class extends E{_renderContent(){const{fieldContext:e,info:t,mode:i}=this,{xyMode:s,visibleElements:r}=t;return v(tt,{context:e,fields:[...s==="direction-distance"?[r.direction?t.direction:void 0,r.distance?t.distance:void 0]:[r.coordinates?t.effectiveX:void 0,r.coordinates?t.effectiveY:void 0],r.elevation?t.elevation:void 0,r.area?t.area:void 0],mode:i})}_renderActions(){const{xyMode:e,sketchOptions:t}=this.info;return v(Tt,{sketchOptions:t,visibleElements:{direction:e==="direction-distance"}})}};xs=a([x("esri.views.interactive.tooltip.content.TooltipContentDrawPolygon")],xs);let ws=class extends E{_renderContent(){const{fieldContext:e,info:t,mode:i}=this,{xyMode:s,visibleElements:r}=t;return v(tt,{context:e,fields:[...s==="direction-distance"?[r.direction?t.direction:void 0,r.distance?t.distance:void 0]:[r.coordinates?t.effectiveX:void 0,r.coordinates?t.effectiveY:void 0],r.elevation?t.elevation:void 0,r.totalLength?t.totalLength:void 0],mode:i})}_renderActions(){const{xyMode:e,sketchOptions:t}=this.info;return v(Tt,{sketchOptions:t,visibleElements:{direction:e==="direction-distance"}})}};ws=a([x("esri.views.interactive.tooltip.content.TooltipContentDrawPolyline")],ws);let $s=class extends E{_renderContent(){const{area:e,xSize:t,ySize:i,visibleElements:s}=this.info,r=this._messagesTooltip.sketch,o=this._formatters;return v(we,null,s.size&&t!=null&&i!=null?v(z,{title:r.size,value:v(We,{left:o.length(t),right:o.length(i)})}):null,s.area?v(z,{title:r.area,value:o.area(e)}):null)}};$s=a([x("esri.views.interactive.tooltip.content.TooltipContentDrawRectangle")],$s);let Ts=class extends E{_renderContent(){const{angle:e,visibleElements:t}=this.info,i=this._messagesTooltip.sketch;return v(we,null,t.rotation?v(z,{title:i.rotation,value:this._formatters.angleRelative(e)}):null)}};Ts=a([x("esri.views.interactive.tooltip.content.TooltipContentExtentRotate")],Ts);let Es=class extends E{_renderContent(){const e=this.info,{visibleElements:t}=e,i=this._messagesTooltip.sketch,s=this._formatters;return v(we,null,t.size?v(z,{title:i.size,value:v(We,{left:s.length(e.xSize),right:s.length(e.ySize)})}):null,t.scale?v(z,{title:i.scale,value:v(We,{left:s.scale(e.xScale),right:s.scale(e.yScale)})}):null)}};Es=a([x("esri.views.interactive.tooltip.content.TooltipContentExtentScale")],Es);let Ss=class extends E{_renderContent(){const{fieldContext:e,info:t,mode:i}=this,{visibleElements:s}=t;return v(tt,{context:e,fields:[s.coordinates?t.effectiveX:void 0,s.coordinates?t.effectiveY:void 0,s.elevation?t.elevation:void 0],mode:i})}};Ss=a([x("esri.views.interactive.tooltip.content.TooltipContentMovePoint")],Ss);let Ps=class extends E{_renderContent(){const{fieldContext:e,info:t,mode:i}=this,{visibleElements:s}=t;return v(tt,{context:e,fields:[s.distance?t.distance:void 0,s.area?t.area:void 0,s.totalLength?t.totalLength:void 0],mode:i})}};Ps=a([x("esri.views.interactive.tooltip.content.TooltipContentReshapeEdgeOffset")],Ps);let Ms=class extends E{_renderContent(){const{fieldContext:e,info:t,mode:i}=this,{visibleElements:s}=t;return v(tt,{context:e,fields:[s.coordinates?t.effectiveX:void 0,s.coordinates?t.effectiveY:void 0,s.elevation?t.elevation:void 0,s.area&&t.geometryType==="polygon"?t.area:null,s.totalLength&&t.geometryType==="polyline"?t.totalLength:null],mode:i})}};Ms=a([x("esri.views.interactive.tooltip.content.TooltipContentSelectedVertex")],Ms);let ks=class extends E{_renderContent(){const{fieldContext:e,info:t,mode:i}=this,{visibleElements:s}=t;return v(tt,{context:e,fields:[s.coordinates?t.effectiveX:void 0,s.coordinates?t.effectiveY:void 0,s.elevation?t.elevation:void 0,s.orientation?t.orientation:void 0,s.scale?t.scale:void 0],mode:i})}};ks=a([x("esri.views.interactive.tooltip.content.TooltipContentTransformMesh")],ks);let Cs=class extends E{_renderContent(){const{fieldContext:e,info:t,mode:i}=this,{visibleElements:s}=t;return v(tt,{context:e,fields:[s.coordinates?t.effectiveX:void 0,s.coordinates?t.effectiveY:void 0,s.elevation?t.elevation:void 0,s.orientation?t.orientation:void 0,s.size?t.size:void 0],mode:i})}};Cs=a([x("esri.views.interactive.tooltip.content.TooltipContentTransformPoint")],Cs);let Rs=class extends E{_renderContent(){const{info:e}=this,{visibleElements:t}=e,i=this._messagesTooltip.sketch,s=this._formatters;return v(we,null,t.distance?v(z,{title:i.distance,value:s.length(e.distance)}):null)}};Rs=a([x("esri.views.interactive.tooltip.content.TooltipContentTranslate")],Rs);let Vs=class extends E{_renderContent(){const{distance:e,elevation:t,area:i,totalLength:s,visibleElements:r}=this.info,o=this._messagesTooltip.sketch,l=this._formatters;return v(we,null,r.distance?v(z,{title:o.distance,value:l.length(e)}):null,r.elevation&&(t==null?void 0:t.actual)!=null?v(z,{title:o.elevation,value:l.verticalLength(t.actual)}):null,r.area&&i!=null?v(z,{title:o.area,value:l.area(i)}):null,r.totalLength&&s!=null?v(z,{title:o.totalLength,value:l.length(s)}):null)}};Vs=a([x("esri.views.interactive.tooltip.content.TooltipContentTranslateVertex")],Vs);let As=class extends E{_renderContent(){const{info:e}=this,{visibleElements:t}=e,i=this._messagesTooltip.sketch,s=this._formatters;return v(we,null,t.distance?v(z,{title:i.distance,value:s.length(e.distance)}):null)}};As=a([x("esri.views.interactive.tooltip.content.TooltipContentTranslateXY")],As);let Os=class extends E{_renderContent(){const{info:e}=this,{visibleElements:t}=e,i=this._messagesTooltip.sketch;return v(we,null,t.distance?v(z,{title:i.distance,value:this._formatters.verticalLengthRelative(e.distance)}):null)}};Os=a([x("esri.views.interactive.tooltip.content.TooltipContentTranslateZ")],Os);function mp(n,e){if(e==null)return null;const t=document.createElement("div");switch(e.type){case"draw-point":return new bs({tooltip:n,info:e,container:t});case"draw-polygon":return new xs({tooltip:n,info:e,container:t});case"draw-polyline":return new ws({tooltip:n,info:e,container:t});case"draw-mesh":return new vs({tooltip:n,info:e,container:t});case"draw-rectangle":return new $s({tooltip:n,info:e,container:t});case"draw-circle":return new _s({tooltip:n,info:e,container:t});case"extent-rotate":return new Ts({tooltip:n,info:e,container:t});case"extent-scale":return new Es({tooltip:n,info:e,container:t});case"move-point":return new Ss({tooltip:n,info:e,container:t});case"selected-vertex":return new Ms({tooltip:n,info:e,container:t});case"transform-point":return new Cs({tooltip:n,info:e,container:t});case"transform-mesh":return new ks({tooltip:n,info:e,container:t});case"translate":return new Rs({tooltip:n,info:e,container:t});case"translate-vertex":return new Vs({tooltip:n,info:e,container:t});case"translate-z":return new Os({tooltip:n,info:e,container:t});case"translate-xy":return new As({tooltip:n,info:e,container:t});case"reshape-edge-offset":return new Ps({tooltip:n,info:e,container:t})}}const un={base:`${J}`,ltr:`${J}--ltr`,rtl:`${J}--rtl`,debug:`${J}--debug`},yp=20,_p=16,vp="bottom-end";let F=class extends kt.EventedAccessor{constructor(e){super(e),this.info=null,this.options=null,this.position=null,this.content=null,this._focused=!1,this.outerContainer=document.createElement("div"),this.debug=!1,this._lastPosition=null,this._rtl=!1,this._prevXY=[0,0]}initialize(){const{outerContainer:e}=this;this.addHandles([U(()=>{var t;return(t=this.view.overlay)==null?void 0:t.surface},t=>{e.remove(),t==null||t.appendChild(e),this._rtl=bc(t)},Mt),U(()=>this.info,(t,i)=>{if(this.content!=null&&t!=null&&i!=null&&t.type===i.type)this.content.info=t;else{pe(this.content);const s=mp(this,t);s?(this.content=s,s.container&&e.appendChild(s.container),this.exitInputMode()):this.content=null}},Mt),U(()=>({container:this.outerContainer,style:this._outerContainerStyle}),({container:t,style:i})=>{Object.assign(t.style,i)},rs),U(()=>({outerContainer:this.outerContainer,placement:this.effectivePlacement,effectiveOffset:this._effectiveOffset,rtl:this._rtl,debug:this.debug}),({outerContainer:t,placement:i,effectiveOffset:s,rtl:r,debug:o})=>{const{classList:l}=t;l.add(un.base),l.toggle(un.rtl,r),l.toggle(un.ltr,!r),l.toggle(un.debug,o),this.outerContainer.style.setProperty("--offset",`${s}px`),xc(t),wp(t,i)},rs),vc(()=>this.mode==="feedback",()=>{this.position=null,this._clearOverride("effectivePlacement")},qs),gn(this.outerContainer,"paste",t=>{this.emit("paste",t)}),gn(this.outerContainer,["focusin","focusout"],()=>{setTimeout(()=>{var t,i;this._focused=((i=(t=this.content)==null?void 0:t.container)==null?void 0:i.contains(document.activeElement))??!1})})])}destroy(){this.info=null,this.content=pe(this.content),this.outerContainer.remove()}get mode(){var e;return((e=this.content)==null?void 0:e.mode)??"feedback"}get focused(){return this._focused}get visible(){return this._outerContainerStyle.display!=="none"}get contentContainer(){var e;return(e=this.content)==null?void 0:e.container}get effectivePlacement(){var t;const e=(t=this.options)==null?void 0:t.placement;return e==="auto"?"bottom-end":e??vp}get _screenPoint(){const{inputManager:e}=this.view;return e!=null&&e.multiTouchActive?null:e==null?void 0:e.latestPointerLocation}get _effectiveOffset(){var e;return((e=this.options)==null?void 0:e.offset)??yp}get _outerContainerStyle(){const e=this.position??this._screenPoint;return this._lastPosition=Rr(e),e!=null&&this.content!=null?{display:"block",transform:`translate(${Math.round(e.x)}px, ${Math.round(e.y)}px)`}:{display:"none",transform:"none"}}clear(){this.info=null}async enterInputMode(e){var o;const t=this.position??this._lastPosition??this._screenPoint,i=this.position=Rr(t),{effectivePlacement:s}=this;this._override("effectivePlacement",s);const r=()=>{i&&(this.position=bp(this.contentContainer,i,this._effectiveOffset,this.view),Object.assign(this.outerContainer.style,this._outerContainerStyle))};await((o=this.content)==null?void 0:o.enterInputMode(e,r))}async exitInputMode(e){var t;await((t=this.content)==null?void 0:t.exitInputMode(e))}onDragStart(e,t){this._prevXY=[e,t]}onDrag(e,t){const i=e-this._prevXY[0],s=t-this._prevXY[1];this._prevXY=[e,t];const{position:r}=this;if(r){const{view:o}=this,l=e-o.position[0],c=t-o.position[1];if(l<0||l>o.width||c<0||c>o.height-_p)return;this.position=Bs(r.x+i,r.y+s)}}onDragEnd(){this._prevXY=[0,0]}};function bp(n,e,t,i){if(!n||!i.container)return e;const s=n.getBoundingClientRect(),{left:r,top:o}=i.container.getBoundingClientRect();let{x:l,y:c}=e;const h=s.left-r-t;h<0&&(l-=h);const d=s.right-r+t-i.width;d>0&&(l-=d);const p=s.top-o-t;p<0&&(c-=p);const _=s.bottom-o+t-i.height;return _>0&&(c-=_),Bs(l,c)}a([u({nonNullable:!0})],F.prototype,"view",void 0),a([u()],F.prototype,"info",void 0),a([u()],F.prototype,"options",void 0),a([u()],F.prototype,"position",void 0),a([u()],F.prototype,"content",void 0),a([u({readOnly:!0})],F.prototype,"mode",null),a([u()],F.prototype,"_focused",void 0),a([u({readOnly:!0})],F.prototype,"focused",null),a([u({readOnly:!0})],F.prototype,"outerContainer",void 0),a([u({readOnly:!0})],F.prototype,"contentContainer",null),a([u({readOnly:!0})],F.prototype,"effectivePlacement",null),a([u()],F.prototype,"debug",void 0),a([u()],F.prototype,"_lastPosition",void 0),a([u()],F.prototype,"_screenPoint",null),a([u()],F.prototype,"_rtl",void 0),a([u()],F.prototype,"_effectiveOffset",null),a([u()],F.prototype,"_outerContainerStyle",null),F=a([x("esri.views.interactive.Tooltip")],F);const xp=["top","bottom","leading","trailing"].flatMap(n=>[ei(`${n}-start`),ei(n),ei(`${n}-end`)]);function ei(n){return`${un.base}--${n}`}function wp({classList:n},e){xp.forEach(t=>n.remove(t)),n.add(ei(e))}const $p=F;function Tp(n){const e=new $p(n());return e.addHandles(U(()=>n(),({view:t,options:i,info:s})=>{e.view=t,i!==void 0&&(e.options=i),s!==void 0&&(e.info=s)})),e}function Ep(n,e){const t=Gu(e.vertexSpace),{scale:i,orientation:s}=n,{transform:r}=e,o=Sp(r);t&&o!=null?(s.actual=De(o,"degrees","arithmetic"),s.visible=!0):(s.actual=null,s.visible=!1),t?(i.actual=Ke(kp(r)),i.visible=!0):(i.actual=null,i.visible=!1)}function Sp(n){if(!n)return 0;const e=Pp(n.rotationAxis);return e!=null?e*n.rotationAngle:null}function Pp(n){return Bt(n,Hs)?1:Bt(n,Mp)?-1:null}const Mp=os(g(),Hs);function kp(n){return n?Math.max(...n.scale):1}function Cp(n,e){return!(n.type!=="key-down"||n.key!==Ut.enterInputMode||!e||!Rp(e.info))&&(e.enterInputMode(),n.preventDefault(),n.stopPropagation(),!0)}function Rp(n){const e=n==null?void 0:n.sketchOptions;if(!e)return!1;const{inputEnabled:t,visibleElements:i}=e.tooltips;return t&&n.editableFields.some(({name:s})=>s==="x"||s==="y"?i.coordinates:i[s])===!0}function Vp(n,e,t){var r;if(!e||!("geographic"in e))return;const i=(r=n.clipboardData)==null?void 0:r.getData("text");if(!i)return;const s=o=>{n.stopPropagation(),n.preventDefault(),o()};if(e.geographic){const o=hp(i);o&&s(()=>{e.longitude.applyValue(o.longitude),e.latitude.applyValue(o.latitude)})}else{const o=up(i);o&&s(()=>{e.x.applyValue(o.x),e.y.applyValue(o.y)})}}let re=class extends te{constructor(e){super(e),this.helpMessage=void 0,this.viewType=void 0}get visibleElements(){return this.sketchOptions.tooltips.visibleElements}get allFields(){return[]}get editableFields(){return this.allFields.filter(e=>e.visible&&!e.readOnly)}clearInputValues(){this.allFields.forEach(e=>e.clearInputValue())}};a([u()],re.prototype,"sketchOptions",void 0),a([u()],re.prototype,"visibleElements",null),a([u()],re.prototype,"helpMessage",void 0),a([u()],re.prototype,"viewType",void 0),a([u()],re.prototype,"allFields",null),a([u()],re.prototype,"editableFields",null),re=a([x("esri.views.interactive.tooltip.infos.SketchTooltipInfo")],re);let Ze=class extends re{constructor(e){super(e),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=Yt}get allFields(){return[]}};a([u()],Ze.prototype,"type",void 0),a([u()],Ze.prototype,"radius",void 0),a([u()],Ze.prototype,"xSize",void 0),a([u()],Ze.prototype,"ySize",void 0),a([u()],Ze.prototype,"area",void 0),a([u()],Ze.prototype,"allFields",null),Ze=a([x("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],Ze);let P=class extends te{constructor(e){super(e),this.actual=null,this.lockable=!0,this.id=wc(),this.inputValue=null,this.readOnly=!1,this.suffix=null,this.visible=!0,this.invalid=!1,this.unlockOnVertexPlacement=!0}get committed(){return this.lockable?this._get("committed"):null}set committed(e){this.lockable&&this._set("committed",e)}get dirty(){return this.inputValue!=null}get locked(){return this.lockable&&this.committed!=null}onInput(e){this.inputValue=e}onCommit(e,t,i){this.lockable?this._onCommitLockable(e,i):this._onCommitNonLockable(i),this.invalid&&e==="commit-and-exit"||i.onCommit(t,e)}_onCommitLockable(e,t){const{inputValue:i,locked:s}=this;s&&Bn(i)?this.unlock():(e==="commit-and-exit"&&!s||i!=null)&&this._parseInputAndLock(t)}_onCommitNonLockable(e){const{inputValue:t}=this;Bn(t)?this.setActual(null):t!=null&&this._parseInputAndSetActual(e)}applyValue(e){this.lockable?this.lock(e):this.setActual(e)}clearInputValue(){this.inputValue=null,this.invalid=!1}setActual(e){this.actual=e,this.clearInputValue()}lock(e){this.lockable&&(this.committed=e??this.actual,this.clearInputValue())}unlock(){this.lockable&&(this.committed=null,this.clearInputValue())}toggleLock(e){this.lockable&&(this.locked?this.unlock():this._parseInputAndLock(e))}getSuffix(e){const{suffix:t}=this;return typeof t=="function"?t(e):t}getFormattedValue(e){const{actual:t,committed:i,format:s}=this;return i!=null?s(i,e):t!=null?s(t,e):null}getRawDisplayValue(e){const{actual:t,committed:i,inputValue:s}=this;return s??(this.lockable&&i!=null?this.formatForInputMode(i,e):t!=null?this.formatForInputMode(t,e):null)}_parseInputAndSetActual(e){const{inputValue:t}=this;if(t==null||Bn(t))return this.setActual(null);const i=this.parse(t,e);i!=null?this.setActual(i):this.invalid=!0}_parseInputAndLock(e){const{inputValue:t,actual:i}=this;if(Bn(t))return this.unlock();if(t==null)return this.lock(i);const s=this.parse(t,e);s!=null?this.lock(s):this.invalid=!0}};function Bn(n){return n!=null&&n.trim()===""}a([u()],P.prototype,"actual",void 0),a([u()],P.prototype,"committed",null),a([u()],P.prototype,"dirty",null),a([u()],P.prototype,"format",void 0),a([u()],P.prototype,"formatForInputMode",void 0),a([u()],P.prototype,"lockable",void 0),a([u()],P.prototype,"locked",null),a([u()],P.prototype,"id",void 0),a([u()],P.prototype,"inputValue",void 0),a([u()],P.prototype,"name",void 0),a([u()],P.prototype,"parse",void 0),a([u()],P.prototype,"readOnly",void 0),a([u()],P.prototype,"suffix",void 0),a([u()],P.prototype,"title",void 0),a([u()],P.prototype,"visible",void 0),a([u()],P.prototype,"invalid",void 0),a([u()],P.prototype,"unlockOnVertexPlacement",void 0),P=a([x("esri.views.interactive.tooltip.fields.TooltipField")],P);let ti=class extends P{constructor(e){super(e),this.showAsZ=!1}normalizeCtorArgs(e){const t=i=>i.inputUnitInfos.verticalLength.unit;return{name:"elevation",actual:Qe,parse:bt({createQuantity:(i,s)=>fe(i,t(s))}),format:(i,s)=>s.formatters.verticalLength(i),formatForInputMode:(i,s)=>s.formatters.scalar(et(i,t(s))),suffix:i=>i.inputUnitInfos.verticalLength.abbreviation,title:i=>i.messages.sketch[this.showAsZ?"z":"elevation"],unlockOnVertexPlacement:!1,...e}}};a([u()],ti.prototype,"showAsZ",void 0),ti=a([x("esri.views.interactive.tooltip.fields.TooltipFieldElevation")],ti);let ni=class extends P{constructor(e){super(e),this.precision=1}normalizeCtorArgs(e){const t=i=>i.inputUnitInfos.angle.unit;return{name:"orientation",actual:null,parse:bt({createQuantity:(i,s)=>De(i,t(s),"geographic"),sanitize:Za}),format:i=>{const s=gs(i);return Pi(s,"geographic",this.precision)},formatForInputMode:(i,s)=>{const r=gs(i);return s.formatters.scalar(r)},suffix:i=>i.inputUnitInfos.angle.abbreviation,title:i=>i.messages.sketch.orientation,...e}}};a([u()],ni.prototype,"precision",void 0),ni=a([x("esri.views.interactive.tooltip.fields.TooltipFieldOrientation")],ni);let Ki=class extends P{constructor(e){super(e),this.precision=null}normalizeCtorArgs(e){const t=i=>i.inputUnitInfos.length.unit;return{name:"size",actual:null,parse:bt({createQuantity:(i,s)=>fe(i,t(s))}),format:(i,s)=>s.formatters.length(i),formatForInputMode:(i,s)=>s.formatters.scalar(et(i,t(s))),suffix:i=>i.inputUnitInfos.length.abbreviation,title:i=>i.messages.sketch.size,...e}}};a([u()],Ki.prototype,"precision",void 0),Ki=a([x("esri.views.interactive.tooltip.fields.TooltipFieldSize")],Ki);function Ya(n){const e=i=>i.inputUnitInfos.angle.unit,t=i=>i.sketchOptions.values.effectiveDirectionMode;return new P({name:"direction",actual:Ks,parse:bt({createQuantity:(i,s)=>De(i,e(s),"geographic"),sanitize:Za}),format:(i,s)=>{const r=t(s),o=hi(i,r);switch(r){case A.Absolute:return s.formatters.direction(o);case A.Relative:return s.formatters.directionRelative(o);case A.RelativeBilateral:return s.formatters.directionRelativeBilateral(o)}},formatForInputMode:(i,s)=>{const r=hi(i,t(s));return s.formatters.scalar(et(r,e(s)))},suffix:i=>i.inputUnitInfos.angle.abbreviation,title:i=>{const s=t(i),{absolute:r,relative:o}=i.messages.sketch.direction;switch(s){case A.Absolute:return r;case A.Relative:case A.RelativeBilateral:return o}},...n})}function Xa(n){const e=t=>t.inputUnitInfos.length.unit;return new P({name:"distance",actual:Qe,parse:bt({createQuantity:(t,i)=>fe(Math.max(t,0),e(i))}),format:(t,i)=>i.formatters.length(t),formatForInputMode:(t,i)=>i.formatters.scalar(et(t,e(i))),suffix:t=>t.inputUnitInfos.length.abbreviation,title:t=>t.messages.sketch.distance,...n})}function Ap(n){return Xa({format:(e,t)=>t.formatters.totalLength(e),title:e=>e.messages.sketch.totalLength,readOnly:!0,...n})}function ja(n){return Xa({...n})}function Op(n){return new ti(n)}function Ip(n){return new ni(n)}function Lp(n){return gr("scale",{name:"scale",actual:null,parse:bt({createQuantity:e=>Ke(Math.abs(e))}),...n})}function Dp(n){const e=t=>t.inputUnitInfos.area.unit;return new P({name:"area",actual:Yt,parse:bt({createQuantity:(t,i)=>vi(t,e(i))}),format:(t,i)=>i.formatters.area(t),formatForInputMode:(t,i)=>i.formatters.scalar(et(t,e(i))),suffix:t=>t.inputUnitInfos.area.abbreviation,title:t=>t.messages.sketch.area,readOnly:!0,...n})}function Gp(n){return new P({name:"x",actual:Ks,parse:dp,format:(e,t)=>t.formatters.longitudeDecimalDegrees(e),formatForInputMode:e=>sp(e),suffix:e=>e.inputUnitInfos.angle.abbreviation,title:e=>e.messages.sketch.longitude,...n})}function zp(n){return new P({name:"y",actual:Ks,parse:pp,format:(e,t)=>t.formatters.latitudeDecimalDegrees(e),formatForInputMode:e=>rp(e),suffix:e=>e.inputUnitInfos.angle.abbreviation,title:e=>e.messages.sketch.latitude,...n})}function Up(n){return gr("x",{name:"x",...n})}function Hp(n){return gr("y",{name:"y",...n})}function gr(n,e){return new P({actual:Ke(0),parse:bt({createQuantity:t=>Ke(t)}),format:(t,i)=>i.formatters.scalar(t),formatForInputMode:(t,i)=>i.formatters.scalar(t),title:t=>t.messages.sketch[n],...e})}function Np(n){return Qo(n)||Ws(n)}function mr(n,e,t,...i){return Qo(n)?e.apply(void 0,i):Ws(n)?t.apply(void 0,i):null}const ki=n=>{let e=class extends n{constructor(){super(...arguments),this.longitude=Gp(),this.latitude=zp(),this.x=Up(),this.y=Hp(),this.elevation=Op(),this.geographic=!1}get effectiveX(){return this.geographic?this.longitude:this.x}get effectiveY(){return this.geographic?this.latitude:this.y}get key(){return{longitude:this.longitude.actual,latitude:this.latitude.actual,x:this.x.actual,y:this.y.actual,elevation:this.elevation.actual,geographic:this.geographic}}setLocationFromPoint(t,i=t==null?void 0:t.spatialReference){if(this.geographic=!!i&&Np(i),t==null)return this._setActualLonLat(null,null),void this._setActualXY(null,null);if(this.geographic){const s=$c(t,Fp);this._setActualLonLat(Kt(s==null?void 0:s[0]),Kt(s==null?void 0:s[1]))}else this._setActualXY(Ke(t.x),Ke(t.y))}_setActualLonLat(t,i){this.longitude.actual=t,this.latitude.actual=i}_setActualXY(t,i){this.x.actual=t,this.y.actual=i}};return a([u()],e.prototype,"geographic",void 0),a([u()],e.prototype,"effectiveX",null),a([u()],e.prototype,"effectiveY",null),a([u()],e.prototype,"key",null),e=a([x("esri.views.interactive.tooltip.infos.TooltipInfoWithCoordinates")],e),e},Fp=[0,0];let hn=class extends ki(re){constructor(e){super(e),this.type="draw-mesh",this.orientation=Ip({lockable:!1}),this.scale=Lp({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};a([u()],hn.prototype,"helpMessage",void 0),a([u()],hn.prototype,"allFields",null),hn=a([x("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],hn);let dn=class extends ki(re){constructor(e){super(e),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};a([u()],dn.prototype,"helpMessage",void 0),a([u()],dn.prototype,"allFields",null),dn=a([x("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],dn);let At=class extends ki(re){constructor(e){super(e),this.type="draw-polygon",this.direction=Ya(),this.distance=ja(),this.area=Dp(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};a([u()],At.prototype,"xyMode",void 0),a([u()],At.prototype,"helpMessage",void 0),a([u()],At.prototype,"allFields",null),At=a([x("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],At);let Ot=class extends ki(re){constructor(e){super(e),this.type="draw-polyline",this.direction=Ya(),this.distance=ja(),this.totalLength=Ap(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};a([u()],Ot.prototype,"helpMessage",void 0),a([u()],Ot.prototype,"xyMode",void 0),a([u()],Ot.prototype,"allFields",null),Ot=a([x("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],Ot);let ot=class extends re{constructor(e){super(e),this.type="draw-rectangle",this.xSize=Qe,this.ySize=Qe,this.area=Yt}get allFields(){return[]}};a([u()],ot.prototype,"type",void 0),a([u()],ot.prototype,"xSize",void 0),a([u()],ot.prototype,"ySize",void 0),a([u()],ot.prototype,"area",void 0),a([u()],ot.prototype,"allFields",null),ot=a([x("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],ot);function yr(n){return Tc(n)?Ec(n)||Ws(n)||Sc(n)||Pc(n)?Hu:n:Nu(n)}function Zp(n,e=_r()){return qp(n,e,!1)}function qp(n,e,t=n.hasZ){const i=yr(n.spatialReference),s=Mc(i);if(s==null)return null;const r=(l,c)=>!(c.length<2)&&(N(l,c[0],c[1],t&&c[2]||0),!0);let o=0;for(const l of n.rings){const c=l.length;if(c<3)continue;const{positionsWorldCoords:h}=e;for(;h.length<c;)h.push(g());const d=Bp,p=N(Wp,0,0,0),_=1/c;for(let y=0;y<c;y++){if(!r(d,l[y])||!be(d,n.spatialReference,h[y],i))return null;G(p,p,h[y],_)}const f=ia(h[0],h[1],p,Cu());if(Ao(zt(f))===0)continue;for(let y=0;y<c;y++)Ru(f,p,h[y],h[y]);const m=Yp(h);for(let y=0;y<m.length;y+=3)o+=Uu(h[m[y]],h[m[y+1]],h[m[y+2]])}return vi(o,s)}const Bp=g(),Wp=g();function _r(){return{positionsWorldCoords:[]}}function Yp(n){return zu(Xp(n),[],2)}function Xp(n){const e=new Float64Array(2*n.length);for(let t=0;t<n.length;++t){const i=n[t],s=2*t;e[s]=i[0],e[s+1]=i[1]}return e}function jp(n){const{spatialReference:e}=n;return mr(e,Kp,Qp,n)}function Kp(n){return vi(Math.abs(au([n],"square-meters")[0]),"square-meters")}function Qp(n){try{return vi(Math.abs(hu(n,"square-meters")),"square-meters")}catch{return null}}function Jp(n,e,t=_r()){{const i=jp(n);return i??Zp(n,t)}}function Ka(n,e=_r()){return Jp(n,"on-the-ground",e)}var je;function ef(n){return tf(n,je.Horizontal)}function tf(n,e){const{hasZ:t,spatialReference:i}=n,s=yr(i);let r=0;const o=Fs(s);if(o==null)return null;const l=e===je.Direct?rf:Ja;for(const c of n.paths){if(c.length<2)continue;const h=c.length-1;for(let d=0;d<h;++d){const p=c[d];ct[0]=p[0],ct[1]=p[1],ct[2]=t?p[2]:0;const _=c[d+1];ut[0]=_[0],ut[1]=_[1],ut[2]=t?_[2]:0;const f=l(ct,ut,i);if(f==null)return null;r+=f.value}}return fe(r,o)}function nf(n,e){const{spatialReference:t}=n;return Qt(t,e.spatialReference)?(ct[0]=n.x,ct[1]=n.y,ct[2]=n.hasZ?n.z:0,ut[0]=e.x,ut[1]=e.y,ut[2]=e.hasZ?e.z:0,Ja(ct,ut,t)):null}function sf(n){return n!=null?Qa(n.hasZ?n.z:0,n.spatialReference):null}function Qa(n,e){const t=Lo(e);return t!=null?fe(n??0,t):null}function rf(n,e,t){const i=el(n,e,t,je.Direct);return i!=null?fe(i.direct,i.unit):null}function Ja(n,e,t){const i=el(n,e,t,je.Horizontal);return i!=null?fe(i.horizontal,i.unit):null}function el(n,e,t,i){const s=yr(t),r=Fs(s);if(r==null)return null;const o=e[2]-n[2];if(i===je.Vertical)return{verticalSigned:o,unit:r};if(!be(n,t,Qi,s)||!be(e,t,Wn,s))return null;if(i===je.Direct)return{direct:dt(Wn,Qi),unit:r};if(N(Yn,n[0],n[1],e[2]),!be(Yn,t,Yn,s))return null;const l=dt(Yn,Wn);return i===je.Horizontal?{horizontal:l,unit:r}:{direct:dt(Wn,Qi),horizontal:l,vertical:Math.abs(o),unit:r}}(function(n){n[n.Direct=0]="Direct",n[n.Horizontal=1]="Horizontal",n[n.Vertical=2]="Vertical"})(je||(je={}));const ct=g(),ut=g(),Qi=g(),Wn=g(),Yn=g();function of(n){const{spatialReference:e}=n;return mr(e,hf,df,n)}function af(n,e){if(!Qt(n.spatialReference,e.spatialReference))return null;const{spatialReference:t}=n;return Xn[0]=n.x,Xn[1]=n.y,Xn[2]=n.hasZ?n.z:0,jn[0]=e.x,jn[1]=e.y,jn[2]=e.hasZ?e.z:0,lf(Xn,jn,t)}function lf(n,e,t){return mr(t,cf,uf,n,e,t)}function cf(n,e,t){return fe(mi(ff,n,e,t).distance,"meters")}function uf(n,e,t){return fe(Jo(pf(n,e,t),"meters"),"meters")}function hf(n){return fe(lu([n],"meters")[0],"meters")}function df(n){return fe(Jo(n,"meters"),"meters")}function pf(n,e,t){return{type:"polyline",spatialReference:t,paths:[[[...n],[...e]]]}}const ff=new yi,Xn=g(),jn=g();function gf(n){return of(n)??ef(n)}function Ci(n,e){return af(n,e)??nf(n,e)}function mf(n,e){return{point:new dn({sketchOptions:e,viewType:n}),polyline:new Ot({sketchOptions:e,viewType:n}),polygon:new At({sketchOptions:e,viewType:n}),mesh:new hn({sketchOptions:e,viewType:n}),rectangle:new ot({sketchOptions:e}),circle:new Ze({sketchOptions:e})}}function lo(n){const{directionOptions:e,geometryType:t,sketchOptions:i,tooltipInfos:s}=n,r=l=>{const c=Ri(n).mode,h=s[l].elevation;c==="relative-to-ground"||c==="relative-to-scene"||c==="on-the-ground"?h.lock(br(n)):h.unlock()},o=l=>{if(e){const c=s[l].direction;c.committed=e.angle,c.unlockOnVertexPlacement=!1,i.values.directionMode=e.mode}};switch(t){case"polygon":case"polyline":r(t),o(t);break;case"point":case"mesh":r(t)}}function yf(n,e){const{drawOperation:t,view:i}=e,s=vr(e),r=Ri(e);if(i.type==="2d"||!n||r.mode!=="absolute-height"||(t==null?void 0:t.numCommittedVertices)!==1||!s||s.type!=="draw-polyline"&&s.type!=="draw-polygon"||s.elevation.locked)return;const[o,l,c]=n,h=kf(o,l,c,r,e);h!=null&&s.elevation.lock(h)}function co(n){var e;(e=vr(n))==null||e.allFields.forEach(t=>{t.unlockOnVertexPlacement&&t.unlock()})}function vr({geometryType:n,graphic:e,tooltipInfos:t}){var i;return n==="multipoint"||((i=e==null?void 0:e.geometry)==null?void 0:i.type)!==_f[n]?null:t[n]}const _f={point:"point",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon"};function vf(n,e){switch(n==null?void 0:n.type){case"draw-point":bf(n,e);break;case"draw-polyline":wf(n,e);break;case"draw-polygon":$f(n,e);break;case"draw-rectangle":Ef(n,e);break;case"draw-circle":Sf(n,e);break;case"draw-mesh":xf(n,e)}}function bf(n,e){var i;const t=(i=e.graphic)==null?void 0:i.geometry;(t==null?void 0:t.type)==="point"&&(tl(n,t,e),n.helpMessage=nr("point",t))}function xf(n,e){const{graphic:t,view:i}=e,s=t==null?void 0:t.geometry;i.type!=="3d"||s&&s.type!=="mesh"||(tl(n,s==null?void 0:s.origin,e),s&&Ep(n,s),n.helpMessage=xh(t,i))}function tl(n,e,t){const{drawOperation:i,view:s,sketchOptions:r}=t,{cursorVertex:o}=i;if(n.sketchOptions=r,n.viewType=s.type,n.setLocationFromPoint(e,en(t)),il(n.elevation,t),!o)return void(i.constraints=void 0);const l=o;i.constraints={context:al(l,t),x:n.x.committed,y:n.y.committed,longitude:n.longitude.committed,latitude:n.latitude.committed,elevation:n.elevation.committed,distance:null,direction:null}}function wf(n,e){const{createOperationGeometry:t,drawOperation:i}=e,s=t!=null?t.full:null;s&&s.type!=="polyline"||(nl(n,e),n.totalLength.actual=i.lastVertex?(s?gf(s):null)??Qe:null,n.helpMessage=nr("polyline",s))}function $f(n,e){const{createOperationGeometry:t,drawOperation:i}=e,s=t!=null?t.full:null;s&&s.type!=="polygon"||(nl(n,e),n.area.actual=i.lastVertex?(s?Ka(s):null)??Yt:null,n.helpMessage=nr("polygon",s))}function nl(n,e){const{drawOperation:t,sketchOptions:i,view:s}=e,{cursorVertex:r,lastVertex:o,secondToLastVertex:l}=t,c=i.values.effectiveDirectionMode;n.sketchOptions=i,n.viewType=s.type;const h=o&&r?Ci(o,r)??Qe:null;if(n.distance.actual=h,n.distance.readOnly=o==null,n.direction.actual=null,n.direction.readOnly=!0,o&&r&&(c==="absolute"||l)){const _=cd(l,o,r,c);n.direction.actual=_??Mu,n.direction.readOnly=!1}n.setLocationFromPoint(r,en(e)),il(n.elevation,e);const d=Tf(o,e);n.xyMode=d,n.direction.visible=d==="direction-distance",n.distance.visible=d==="direction-distance",n.effectiveX.visible=d==="coordinates",n.effectiveY.visible=d==="coordinates";const p=r??o;t.constraints=p?{context:al(p,e),x:n.x.committed,y:n.y.committed,longitude:n.longitude.committed,latitude:n.latitude.committed,elevation:n.elevation.committed,distance:n.distance.committed,direction:n.direction.committed}:void 0}function Tf(n,{sketchOptions:e}){const t=e.tooltips.xyMode;return t==="auto"?n?"direction-distance":"coordinates":t}function Ef(n,e){n.sketchOptions=e.sketchOptions,n.xSize=rl(e),n.ySize=ol(e),n.area=sl(e)}function Sf(n,e){const{forceUniformSize:t,sketchOptions:i}=e;n.sketchOptions=i,n.radius=t?Pf(e):null,n.xSize=t?null:rl(e),n.ySize=t?null:ol(e),n.area=sl(e)}function il(n,e){const{drawOperation:t}=e,i=(t==null?void 0:t.cursorVertex)??(t==null?void 0:t.lastVertex);n.actual=sf(i)??br(e),n.visible=t.hasZ,n.readOnly=!1,n.showAsZ=!0}function sl(n){var t;const e=(t=n.createOperationGeometry)==null?void 0:t.full;return(e==null?void 0:e.type)!=="polygon"?Yt:Ka(e)??Yt}function rl(n){var t,i;const e=(i=(t=n.createOperationGeometry)==null?void 0:t.rectangle)==null?void 0:i.midpoints;return(e!=null?Ci(e.left,e.right):null)??Qe}function ol(n){var t,i;const e=(i=(t=n.createOperationGeometry)==null?void 0:t.rectangle)==null?void 0:i.midpoints;return(e!=null?Ci(e.top,e.bottom):null)??Qe}function Pf({createOperationGeometry:n}){var e;return(((e=n==null?void 0:n.circle)==null?void 0:e.center)!=null&&n.circle.edge!=null?Ci(n.circle.center,n.circle.edge):null)??Qe}function Mf(n){const{geometryType:e,tooltipInfos:t}=n;switch(e){case"point":case"mesh":case"polyline":case"polygon":{const i=t[e].elevation.committed;return i?_i(i,"meters")/Us(en(n)):void 0}default:return}}function kf(n,e,t,i,s){const{view:r,drawOperation:o}=s;if(r.type!=="3d"||!o)return;t??(t=0);const l=en(s),c=Ri(s),h=Ko(r,n,e,t,l,c,i);return Qa(h,l)??br(s)}function Ri(n){return n.drawOperation.elevationInfo??gi}function en(n){return n.drawOperation.coordinateHelper.spatialReference}function br(n){const e=Us(en(n));return fe(n.defaultZ*e,"meters")}function al(n,e){return gd(n,e.view,en(e),Ri(e),e.drawOperation.coordinateHelper.hasZ(),e.sketchOptions.values.effectiveDirectionMode)}var Et;(function(n){n[n.WhenToolEditable=0]="WhenToolEditable",n[n.WhenToolNotEditable=1]="WhenToolNotEditable",n[n.Always=2]="Always"})(Et||(Et={}));let Cf=class{constructor(){this._isToolEditable=!0,this._manipulators=new ts,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(e){this._isToolEditable=e}get length(){return this._manipulators.length}add(e,t=Et.WhenToolEditable){this.addMany([e],t)}addMany(e,t=Et.WhenToolEditable){for(const i of e){const s={manipulator:i,visibilityPredicate:t,attached:!1};this._manipulators.add(s),this._attached&&this._updateManipulatorAttachment(s)}}remove(e){for(let t=0;t<this._manipulators.length;t++)if(this._manipulators.at(t).manipulator===e){const i=this._manipulators.splice(t,1)[0];this._detachManipulator(i);break}}removeAll(){this._manipulators.forEach(e=>{this._detachManipulator(e)}),this._manipulators.removeAll()}attach(){this._manipulators.forEach(e=>{this._updateManipulatorAttachment(e)}),this._attached=!0}detach(){this._manipulators.forEach(e=>{this._detachManipulator(e)}),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach(({manipulator:e})=>e.destroy()),this._manipulators.destroy(),this._resourceContexts=null}on(e,t){return this._manipulators.on(e,i=>{t(i)})}forEach(e){for(const t of this._manipulators.items)e(t)}some(e){return this._manipulators.items.some(e)}toArray(){const e=[];return this.forEach(t=>e.push(t.manipulator)),e}intersect(e,t){let i=null,s=Number.MAX_VALUE;return this._manipulators.forEach(({manipulator:r,attached:o})=>{if(!o||!r.interactive)return;const l=r.intersectionDistance(e,t);l!=null&&l<s&&(s=l,i=r)}),i}_updateManipulatorAttachment(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}_attachManipulator(e){e.attached||(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),e.attached=!0)}_detachManipulator(e){if(!e.attached)return;const t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}_isManipulatorItemVisible(e){return e.visibilityPredicate===Et.Always||(this._isToolEditable?e.visibilityPredicate===Et.WhenToolEditable:e.visibilityPredicate===Et.WhenToolNotEditable)}},q=class extends te{constructor(e){super(e),this.manipulators=new Cf,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[wt.MANAGER,!0],[wt.USER,!0]]),this._creationFinishedResolver=kc()}get active(){return this.view!=null&&this.view.activeTool===this}set visible(e){this._get("visible")!==e&&(this._set("visible",e),this._syncVisible())}get editable(){return this.getEditableFlag(wt.USER)}set editable(e){this.setEditableFlag(wt.USER,e)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){this.view!=null&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(e){this.onInputEvent(e)}handleInputEventAfter(e){this.onInputEventAfter(e)}setEditableFlag(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),e===wt.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(e){return this._editableFlags.get(e)??!1}endDrag(){const e=this.view.inputManager.latestPointerLocation;if(!e)return;let t=!1;this.manipulators.forEach(({manipulator:i})=>{i.dragging&&(t=!0,i.events.emit("drag",{action:"end",start:e,screenPoint:e}))}),t&&(this.view.toolViewManager.activeTool=null)}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}get internallyEditable(){return this.getEditableFlag(wt.USER)&&this.getEditableFlag(wt.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized){if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};a([u({constructOnly:!0})],q.prototype,"view",void 0),a([u({readOnly:!0})],q.prototype,"active",null),a([u({value:!0})],q.prototype,"visible",null),a([u({value:!0})],q.prototype,"editable",null),a([u({readOnly:!0})],q.prototype,"manipulators",void 0),a([u({readOnly:!0})],q.prototype,"updating",null),a([u()],q.prototype,"cursor",null),a([u({readOnly:!0})],q.prototype,"automaticManipulatorSelection",void 0),a([u()],q.prototype,"hasFocusedManipulators",null),a([u()],q.prototype,"hasGrabbedManipulators",void 0),a([u()],q.prototype,"hasHoveredManipulators",void 0),a([u()],q.prototype,"firstGrabbedManipulator",void 0),a([u({readOnly:!0})],q.prototype,"created",void 0),a([u({readOnly:!0})],q.prototype,"removeIncompleteOnCancel",void 0),q=a([x("esri.views.interactive.InteractiveToolBase")],q);let ii=class extends te{constructor(e){super(e),this.enabled=!1}};a([u({type:Boolean,nonNullable:!0})],ii.prototype,"enabled",void 0),ii=a([x("esri.views.interactive.sketch.SketchLabelOptions")],ii);const Vi=ii;let yn=class extends te{constructor(e){super(e),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};a([u({type:String,nonNullable:!0})],yn.prototype,"mode",void 0),yn=a([x("esri.views.interactive.sketch.SketchTooltipElevationOptions")],yn);let ee=class extends te{constructor(e){super(e),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}};a([u({type:Boolean,nonNullable:!0})],ee.prototype,"area",void 0),a([u({type:Boolean,nonNullable:!0})],ee.prototype,"coordinates",void 0),a([u({type:Boolean,nonNullable:!0})],ee.prototype,"direction",void 0),a([u({type:Boolean,nonNullable:!0})],ee.prototype,"distance",void 0),a([u({type:Boolean,nonNullable:!0})],ee.prototype,"elevation",void 0),a([u({type:Boolean,nonNullable:!0})],ee.prototype,"header",void 0),a([u({type:Boolean,nonNullable:!0})],ee.prototype,"helpMessage",void 0),a([u({type:Boolean,nonNullable:!0})],ee.prototype,"orientation",void 0),a([u({type:Boolean,nonNullable:!0})],ee.prototype,"radius",void 0),a([u({type:Boolean,nonNullable:!0})],ee.prototype,"rotation",void 0),a([u({type:Boolean,nonNullable:!0})],ee.prototype,"scale",void 0),a([u({type:Boolean,nonNullable:!0})],ee.prototype,"size",void 0),a([u({type:Boolean,nonNullable:!0})],ee.prototype,"totalLength",void 0),ee=a([x("esri.views.interactive.sketch.SketchTooltipVisibleElements")],ee);const ll=ee;let ne=class extends te{constructor(e){super(e),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new yn,this.placement="auto",this.offset=null,this.visibleElements=new ll,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}};a([u({type:Boolean,nonNullable:!0})],ne.prototype,"enabled",void 0),a([u()],ne.prototype,"forceEnabled",void 0),a([u()],ne.prototype,"effectiveEnabled",null),a([u()],ne.prototype,"helpMessage",void 0),a([u()],ne.prototype,"helpMessageIcon",void 0),a([u({type:Boolean,nonNullable:!0})],ne.prototype,"inputEnabled",void 0),a([u({type:yn,nonNullable:!0})],ne.prototype,"elevation",void 0),a([u()],ne.prototype,"placement",void 0),a([u()],ne.prototype,"offset",void 0),a([u({type:ll,nonNullable:!0})],ne.prototype,"visibleElements",void 0),a([u()],ne.prototype,"visualVariables",void 0),a([u()],ne.prototype,"xyMode",void 0),ne=a([x("esri.views.interactive.sketch.SketchTooltipOptions")],ne);const cl=ne;let It=class extends te{constructor(e){super(e),this.length=null,this.verticalLength=null,this.area=null}};a([u()],It.prototype,"length",void 0),a([u()],It.prototype,"verticalLength",void 0),a([u()],It.prototype,"area",void 0),It=a([x("esri.views.interactive.sketch.Units")],It);const di=It;let at=class extends te{constructor(e){super(e),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?A.RelativeBilateral:A.Relative;case"absolute":return A.Absolute}}get displayUnits(){return this._get("displayUnits")??new di}set displayUnits(e){this._set("displayUnits",e)}get inputUnits(){return this._get("inputUnits")??new di}set inputUnits(e){this._set("inputUnits",e)}};a([u({type:String,nonNullable:!0})],at.prototype,"directionMode",void 0),a([u({type:Boolean,nonNullable:!0})],at.prototype,"relativeDirectionIsBilateral",void 0),a([u()],at.prototype,"effectiveDirectionMode",null),a([u({type:di,nonNullable:!0})],at.prototype,"displayUnits",null),a([u({type:di,nonNullable:!0})],at.prototype,"inputUnits",null),at=a([x("esri.views.interactive.sketch.SketchValueOptions")],at);const ul=at;let Lt=class extends te{constructor(e){super(e),this.labels=new Vi,this.tooltips=new cl,this.values=new ul}};a([u({nonNullable:!0,type:Vi})],Lt.prototype,"labels",void 0),a([u({nonNullable:!0,type:cl})],Lt.prototype,"tooltips",void 0),a([u({nonNullable:!0,type:ul})],Lt.prototype,"values",void 0),Lt=a([x("esri.views.interactive.sketch.SketchOptions")],Lt);const hl=Lt;let S=class extends kt.EventedMixin(q){constructor(n){super(n),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new hl}initialize(){const{view:n}=this;this.internalGraphicsLayer=new js({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);const e=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=mf(n.type,this.sketchOptions);const t=Tp(()=>({view:n,options:this.sketchOptions.tooltips}));this.tooltip=t,lo(this._tooltipsContext),this._coordinateFormatterLoadTask=Cc(()=>oh()),this.addHandles([e.on("vertex-add",i=>this.onVertexAdd(i)),e.on("vertex-remove",i=>this.onVertexRemove(i)),e.on("vertex-update",i=>this.onVertexUpdate(i)),e.on("cursor-update",i=>this.onCursorUpdate(i)),e.on("cursor-remove",()=>this._updateGraphic()),e.on("complete",i=>this.onComplete(i)),this._coordinateFormatterLoadTask,t.on("paste",i=>Vp(i,this.activeTooltipInfo)),U(()=>this.cursor,i=>{e.cursor=i},Mt),Vr(()=>{const{activeTooltipInfo:i,sketchOptions:s}=this;vf(i,this._tooltipsContext),t.info=s.tooltips.effectiveEnabled?i:null}),Vr(()=>{e.constraintZ=Mf(this._tooltipsContext)},qs)]),this.finishToolCreation()}destroy(){this.drawOperation=pe(this.drawOperation),this.tooltip=pe(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=pe(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){return{createOperationGeometry:this._createOperationGeometry,defaultZ:this.defaultZ,directionOptions:this.directionOptions,drawOperation:this.drawOperation,forceUniformSize:this.forceUniformSize,geometryType:this.geometryType,graphic:this.graphic,sketchOptions:this.sketchOptions,tooltipInfos:this.tooltipInfos,view:this.view}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(n){this._set("centered",n),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(n){this._set("cursor",n)}set enabled(n){this.drawOperation.interactive=n,this._set("enabled",n)}set forceUniformSize(n){this._set("forceUniformSize",n),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(n){this._set("graphicSymbol",n),this._graphic!=null&&(this._graphic.symbol=n)}set mode(n){const e=this.drawOperation;e&&(e.drawingMode=n),this._set("mode",n)}get updating(){var n;return((n=this.drawOperation)==null?void 0:n.updating)??!1}get undoRedo(){const{view:{type:n,map:e}}=this;return n==="2d"&&e&&"undoRedo"in e&&e.undoRedo instanceof ke?e.undoRedo:null}set undoRedo(n){this._override("undoRedo",n)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(n){this.destroyed||Cp(n,this.tooltip)||this.drawOperation.onInputEvent(n)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),this.drawOperation.numCommittedVertices===0&&lo(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(me.outline),this.removeHandles(me.regularVertices),this.removeHandles(me.activeVertex),this.removeHandles(me.activeEdge),this.removeHandles(Ji)}_createOrUpdateGraphic(n){if(this._graphic!=null)return this.updateGraphicGeometry(n),this._graphic;const e=new Oe({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=e,this.updateGraphicGeometry(n),this.internalGraphicsLayer.add(e),this.addHandles(this.initializeGraphic(e)),this.notifyChange("graphic"),this.addHandles(B(()=>{this.internalGraphicsLayer.remove(e),this._graphic===e&&(this._graphic=null)}),Ji),e}updateGraphicGeometry(n){this._graphic.geometry=n}_getCreateOperationGeometry(n={operationComplete:!1}){var y,w;if(this.drawOperation==null)return;const{coordinateHelper:e,view:t,visualizationCursorVertex:i,lastVertex:s,committedVertices:r,geometryIncludingUncommittedVertices:o,numCommittedVertices:l}=this.drawOperation;if(!(l>0||i!=null))return;const c=n.operationComplete?r:o,h=c.length,d=i!=null?e.pointToArray(i):null,p=this._drawSpatialReference,_=t.type==="3d"&&t.viewingMode==="global",f=new uh;f.committedVertices=r,f.cursorVertex=d;const{geometryType:m}=this;switch(m){case"point":case"mesh":f.full=e.arrayToPoint(c[0]);break;case"multipoint":f.full=h>0?gh(c,p):null;break;case"polyline":case"polygon":h>0&&(f.full=m==="polygon"?On([c],p,_,!0):qr([c],p,_),f.cursorEdge=d!=null&&s&&!mn(i,s)?qr([[d,e.pointToArray(s)]],p,_):null,f.outline=h>1?f.full:null);break;case"circle":case"rectangle":{if(f.committedVertices=f.cursorVertex=null,!h)break;const b=fh(t,c[0]),$=c[0],M=b.makeMapPoint($[0]+Vf*t.resolution,$[1]);m==="circle"?h===1&&n.operationComplete?f.circle=Wr([$,M],b,!0):h===2&&(this.forceUniformSize?f.circle=Wr(c,b,this.centered):f.rectangle=yh(c,b,this.centered)):h===1&&n.operationComplete?f.rectangle=Br([$,M],b,!0):h===2&&(f.rectangle=this.forceUniformSize?Br(c,b,this.centered):mh(c,b,this.centered)),f.full=f.circle!=null?f.circle.geometry:(y=f.rectangle)==null?void 0:y.geometry,f.outline=((w=f.full)==null?void 0:w.type)==="polygon"?f.full:null;break}default:return null}return f}initializeGraphic(n){return B()}onComplete(n){if(!this.drawOperation)return;this._updateGraphic();let e=null;if(this.drawOperation.isCompleted){const t=this._getCreateOperationGeometry({operationComplete:!0});t!=null&&(e=this._createOrUpdateGraphic(t.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:e,...n})}onCursorUpdate(n){this._updateGraphic(),this.emit("cursor-update",n)}onDeactivate(){const{drawOperation:n}=this;n&&(n.isCompleted||n.cancel())}onOutlineChanged(n){return B()}onCursorEdgeChanged(n){return B()}onVertexAdd(n){var e;co(this._tooltipsContext),this._updateGraphic(),yf((e=n.vertices.at(0))==null?void 0:e.coordinates,this._tooltipsContext),this.emit("vertex-add",n)}onVertexRemove(n){co(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",n)}onVertexUpdate(n){this._updateGraphic(),this.emit("vertex-update",n)}_updateGraphic(){const n=this._getCreateOperationGeometry();this._createOperationGeometry=n,n!=null?(n.cursorEdge!=null?this.addHandles(this.onCursorEdgeChanged(n.cursorEdge),me.activeEdge):this.removeHandles(me.activeEdge),n.outline!=null?this.addHandles(this.onOutlineChanged(n.outline),me.outline):this.removeHandles(me.outline),n.committedVertices!=null?this.addHandles(this.onRegularVerticesChanged(n.committedVertices),me.regularVertices):this.removeHandles(me.regularVertices),n.cursorVertex!=null?this.addHandles(this.onActiveVertexChanged(n.cursorVertex),me.activeVertex):this.removeHandles(me.activeVertex),n.full!=null?this._createOrUpdateGraphic(n.full):this.removeHandles(Ji)):this._destroyAllVisualizations()}get activeTooltipInfo(){var n;return(n=this._coordinateFormatterLoadTask)!=null&&n.finished?vr(this._tooltipsContext):null}};a([u()],S.prototype,"_coordinateFormatterLoadTask",void 0),a([u()],S.prototype,"_createOperationGeometry",void 0),a([u()],S.prototype,"_tooltipsContext",null),a([u({value:!0})],S.prototype,"centered",null),a([u()],S.prototype,"cursor",null),a([u({nonNullable:!0})],S.prototype,"defaultZ",void 0),a([u({constructOnly:!0})],S.prototype,"directionOptions",void 0),a([u()],S.prototype,"drawOperation",void 0),a([u({value:!0})],S.prototype,"enabled",null),a([u({value:!0})],S.prototype,"forceUniformSize",null),a([u({constructOnly:!0})],S.prototype,"geometryType",void 0),a([u()],S.prototype,"graphic",null),a([u({constructOnly:!0})],S.prototype,"graphicProperties",void 0),a([u()],S.prototype,"graphicSymbol",null),a([u({constructOnly:!0})],S.prototype,"hasZ",void 0),a([u({constructOnly:!0})],S.prototype,"geometryToPlace",void 0),a([u()],S.prototype,"mode",null),a([u()],S.prototype,"snappingManager",void 0),a([u()],S.prototype,"snapToScene",void 0),a([u()],S.prototype,"tooltip",void 0),a([u()],S.prototype,"tooltipInfos",void 0),a([u({constructOnly:!0,type:hl})],S.prototype,"sketchOptions",void 0),a([u()],S.prototype,"updating",null),a([u({constructOnly:!0,nonNullable:!0})],S.prototype,"view",void 0),a([u({constructOnly:!0})],S.prototype,"undoRedo",null),a([u()],S.prototype,"activeTooltipInfo",null),S=a([x("esri.views.draw.DrawGraphicTool")],S);const Ji=Symbol("create-operation-graphic"),me={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function Rf(n){switch(n){case"point":case"polyline":case"polygon":case"multipoint":return n;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const Vf=48,dl="click";let Af=class{constructor({consumesClicks:e,grabbableForEvent:t}){this.events=new kt,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.consumesClicks=e,this.grabbableForEvent=t}destroy(){}intersectionDistance(e,t){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}};var D;(function(n){n[n.Z=0]="Z",n[n.M=1]="M"})(D||(D={}));let Of=class{constructor(e){this.spatialReference=e}createVector(){return this._tag(L())}pointToVector(e){return this._tag(gt(e.x,e.y))}arrayToVector(e){return this._tag(gt(e[0],e[1]))}vectorToArray(e){return[e[0],e[1]]}pointToArray(e){return[e.x,e.y]}vectorToPoint(e,t=new C){return t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new C){return t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t){if(e)return t??(t={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"}),t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.hasZ=!1,t.hasM=!1,t.spatialReference=this.spatialReference,t}lerp(e,t,i,s){return Vo(s,e,t,i)}addDelta(e,t,i){e[0]+=t,e[1]+=i}distance(e,t){return Ho(e,t)}getZ(e,t=void 0){return t}hasZ(){return!1}getM(e,t=void 0){return t}hasM(){return!1}clone(e){return this._tag(Lc(e))}copy(e,t){return Dc(t,e)}fromXYZ(e){return this._tag(gt(e[0],e[1]))}toXYZ(e,t=g()){return N(t,e[0],e[1],0)}pointToXYZ(e,t=g()){return N(t,e.x,e.y,0)}equals(e,t){return Gc(e,t)}_tag(e){return e}};class uo{constructor(e,t){this._valueType=e,this.spatialReference=t}createVector(){return this._tag(g())}pointToVector(e){return this._tag(ht(e.x,e.y,this._valueType===D.Z?e.z:e.m))}arrayToVector(e){return this._tag(ht(e[0],e[1],e[2]||0))}vectorToArray(e){return[e[0],e[1],e[2]]}pointToArray(e){return this._valueType===D.Z?[e.x,e.y,e.z]:[e.x,e.y,e.m]}vectorToPoint(e,t=new C){return t.x=e[0],t.y=e[1],t.z=this._valueType===D.Z?e[2]:void 0,t.m=this._valueType===D.M?e[2]:void 0,t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new C){return t.x=e[0],t.y=e[1],t.z=this._valueType===D.Z?e[2]:void 0,t.m=this._valueType===D.M?e[2]:void 0,t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t){if(!e)return;t??(t={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"});const i=this._valueType===D.Z,s=this._valueType===D.M;return t.x=e[0],t.y=e[1],t.z=i?e[2]:void 0,t.m=s?e[2]:void 0,t.hasZ=i,t.hasM=s,t.spatialReference=this.spatialReference,t}lerp(e,t,i,s){return St(s,e,t,i)}addDelta(e,t,i,s){e[0]+=t,e[1]+=i,this._valueType===D.Z&&(e[2]+=s)}distance(e,t){return this._valueType===D.Z?dt(e,t):Ho(e,t)}getZ(e,t=void 0){return this._valueType===D.Z?e[2]:t}hasZ(){return this._valueType===D.Z}getM(e,t=void 0){return this._valueType===D.M?e[2]:t}hasM(){return this._valueType===D.M}clone(e){return this._tag(Ic(e))}copy(e,t){return oe(t,e)}fromXYZ(e,t=0,i=0){return this._tag(ht(e[0],e[1],this._valueType===D.Z?e.length>2?e[2]:t:i))}toXYZ(e,t=g()){return N(t,e[0],e[1],this._valueType===D.Z?e[2]:0)}pointToXYZ(e,t=g()){return N(t,e.x,e.y,this._valueType===D.Z?e.z??0:0)}equals(e,t){return Bt(e,t)}_tag(e){return e}}let If=class{constructor(e){this.spatialReference=e}createVector(){return this._tag(Oo())}pointToVector(e){return this._tag(Ui(e.x,e.y,e.z,e.m))}arrayToVector(e){return this._tag(Ui(e[0],e[1],e[2]||0,e[3]||0))}vectorToArray(e){return[e[0],e[1],e[2],e[3]]}pointToArray(e){return[e.x,e.y,e.z,e.m]}vectorToPoint(e,t=new C){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new C){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t){if(e)return t??(t={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"}),t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.hasZ=!0,t.hasM=!0,t.spatialReference=this.spatialReference,t}lerp(e,t,i,s){return Rc(s,e,t,i)}addDelta(e,t,i,s){e[0]+=t,e[1]+=i,e[2]+=s}distance(e,t){return dt(e,t)}getZ(e){return e[2]}hasZ(){return!0}getM(e){return e[3]}hasM(){return!0}clone(e){return this._tag(Vc(e))}copy(e,t){return Ac(t,e)}fromXYZ(e,t=0,i=0){return this._tag(Ui(e[0],e[1],e.length>2?e[2]:t,i))}toXYZ(e,t=g()){return N(t,e[0],e[1],e[2])}pointToXYZ(e,t=g()){return N(t,e.x,e.y,e.z??0)}equals(e,t){return Oc(e,t)}_tag(e){return e}};function pl(n,e,t){return n&&e?new If(t):e?new uo(D.M,t):n?new uo(D.Z,t):new Of(t)}function Lf(n,e){if(!e.supported)return;let t=1/0,i=-1/0;const s=e.upperBoundX-e.lowerBoundX;n.forEach(o=>{let l=o.pos[0];for(;l<e.lowerBoundX;)l+=s;for(;l>e.upperBoundX;)l-=s;t=Math.min(t,l),i=Math.max(i,l),o.pos[0]=l});const r=i-t;s-r<r&&n.forEach(o=>{o.pos[0]<0&&(o.pos[0]+=s)})}function Df(n,e){const t=No(n);return e===wn.Global&&t?{supported:!0,lowerBoundX:t.valid[0],upperBoundX:t.valid[1]}:{supported:!1,lowerBoundX:null,upperBoundX:null}}let Dn=class{constructor(e){this.component=e,this.leftEdge=null,this.rightEdge=null,this.type="vertex",this.index=null}get pos(){return this._pos}set pos(e){this._pos=e,this.component.unnormalizeVertexPositions()}};class Je{constructor(e,t,i){this.component=e,this.leftVertex=t,this.rightVertex=i,this.type="edge",t.rightEdge=this,i.leftEdge=this}}class Ai{constructor(e,t){this._spatialReference=e,this._viewingMode=t,this.vertices=[],this.edges=[],this.index=null}unnormalizeVertexPositions(){this.vertices.length<=1||Lf(this.vertices,Df(this._spatialReference,this._viewingMode))}updateVertexIndex(e,t){if(this.vertices.length===0)return;const i=this.vertices[0];let s=null,r=e,o=t;do s=r,s.index=o++,r=s.rightEdge?s.rightEdge.rightVertex:null;while(r!=null&&r!==i);s.leftEdge&&s!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(s),this.vertices.length-1)}getFirstVertex(){return this.vertices.at(0)}getLastVertex(){return this.vertices.at(-1)}isClosed(){return this.vertices.length>2&&this.vertices[0].leftEdge!==null}swapVertices(e,t){const i=this.vertices[e];this.vertices[e]=this.vertices[t],this.vertices[t]=i}iterateVertices(e){if(this.vertices.length===0)return;const t=this.vertices[0];let i=t;do e(i,i.index),i=i.rightEdge!=null?i.rightEdge.rightVertex:null;while(i!==t&&i!=null)}}let pi=class fl extends kt{constructor(e,t){super(),this.type=e,this.coordinateHelper=t,this._geometry=null,this._dirty=!0,this.components=[]}get geometry(){if(this._dirty){switch(this.type){case"point":this._geometry=this._toPoint();break;case"polyline":this._geometry=this._toPolyline();break;case"polygon":this._geometry=this._toPolygon();break;case"mesh":break;default:zc(this.type)}this._dirty=!1}return this._geometry}get spatialReference(){return this.coordinateHelper.spatialReference}get allVertices(){return Array.from(this.iterateVertices())}*iterateVertices(){for(const e of this.components)for(const t of e.vertices)yield t}notifyChanges(e){this._dirty=!0,this.emit("change",e)}_toPoint(){return this.components.length===0||this.components[0].vertices.length===0?null:this.coordinateHelper.vectorToPoint(this.components[0].vertices[0].pos)}_toPolyline(){const e=[],t=this.coordinateHelper.vectorToArray;for(const i of this.components){if(i.vertices.length<1)continue;const s=[];let r=i.vertices.find(l=>l.leftEdge==null);const o=r;do s.push(t(r.pos)),r=r.rightEdge?r.rightEdge.rightVertex:null;while(r&&r!==o);e.push(s)}return new pn({paths:e,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}_toPolygon(){const e=[],t=this.coordinateHelper.vectorToArray;for(const i of this.components){if(i.vertices.length<1)continue;const s=[],r=i.vertices[0];let o=r;const l=o;do s.push(t(o.pos)),o=o.rightEdge!=null?o.rightEdge.rightVertex:null;while(o&&o!==l);i.isClosed()&&s.push(t(r.pos)),e.push(s)}return new Dt({rings:e,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}static fromGeometry(e,t){const i=e.spatialReference,s=pl(e.hasZ,e.hasM,i),r=new fl(e.type,s);switch(e.type){case"polygon":Gf(r,e,t);break;case"polyline":zf(r,e,t);break;case"point":ho(r,e,t);break;case"mesh":ho(r,e.origin,t),r._geometry=e,r._dirty=!1}return r}};function Gf(n,e,t){const i=e.spatialReference,s=n.coordinateHelper,r=e.rings;for(let o=0;o<r.length;++o){const l=r[o],c=new Ai(i,t);c.index=o;const h=l.length>2&&Zt(l[0],l[l.length-1]),d=h?l.length-1:l.length;for(let _=0;_<d;++_){const f=s.arrayToVector(l[_]),m=new Dn(c);c.vertices.push(m),m.pos=f,m.index=_}const p=c.vertices.length-1;for(let _=0;_<p;++_){const f=c.vertices[_],m=c.vertices[_+1],y=new Je(c,f,m);c.edges.push(y)}if(h){const _=new Je(c,c.vertices[c.vertices.length-1],c.vertices[0]);c.edges.push(_)}n.components.push(c)}}function zf(n,e,t){const i=e.spatialReference,s=n.coordinateHelper,r=e.paths;for(let o=0;o<r.length;++o){const l=r[o],c=new Ai(i,t);c.index=o;const h=l.length;for(let p=0;p<h;++p){const _=s.arrayToVector(l[p]),f=new Dn(c);c.vertices.push(f),f.pos=_,f.index=p}const d=c.vertices.length-1;for(let p=0;p<d;++p){const _=c.vertices[p],f=c.vertices[p+1],m=new Je(c,_,f);c.edges.push(m)}n.components.push(c)}}function ho(n,e,t){const i=e.spatialReference,s=n.coordinateHelper,r=new Ai(i,t);r.index=0;const o=new Dn(r);o.index=0,o.pos=s.pointToVector(e),r.vertices.push(o),n.components.push(r)}function an(n){return n.type==="mesh"}var I;(function(n){n[n.NEW_STEP=0]="NEW_STEP",n[n.ACCUMULATE_STEPS=1]="ACCUMULATE_STEPS"})(I||(I={}));let Uf=class{constructor(e,t,i){this._editGeometry=e,this._component=t,this._pos=i,this._addedVertex=null,this._originalEdge=null,this._left=null,this._right=null}apply(){let e="redo";this._addedVertex==null&&(e="apply",this._addedVertex=new Dn(this._component));const t=this._component.getLastVertex();if(t==null)this._component.vertices.push(this._addedVertex),this._addedVertex.pos=this._pos,this._addedVertex.index=0;else{let i=null;t.rightEdge&&(this._originalEdge=t.rightEdge,i=this._originalEdge.rightVertex,this._component.edges.splice(this._component.edges.indexOf(this._originalEdge),1)),this._component.vertices.push(this._addedVertex),this._addedVertex.pos=this._pos,this._left==null&&(this._left=new Je(this._component,t,this._addedVertex)),this._component.edges.push(this._left),t.rightEdge=this._left,this._originalEdge!=null&&i!=null&&(this._right==null&&(this._right=new Je(this._component,this._addedVertex,i)),this._component.edges.push(this._right),i.leftEdge=this._right),this._component.updateVertexIndex(this._addedVertex,t.index+1)}this._editGeometry.notifyChanges({operation:e,addedVertices:[this._addedVertex]})}undo(){this._addedVertex!=null&&(this._component.vertices.splice(this._component.vertices.indexOf(this._addedVertex),1),this._left!=null&&(this._component.edges.splice(this._component.edges.indexOf(this._left),1),this._left.leftVertex.rightEdge=null),this._right!=null&&(this._component.edges.splice(this._component.edges.indexOf(this._right),1),this._right.rightVertex.leftEdge=null),this._originalEdge!=null&&(this._component.edges.push(this._originalEdge),this._originalEdge.leftVertex.rightEdge=this._originalEdge,this._originalEdge.rightVertex.leftEdge=this._originalEdge),this._left!=null?this._component.updateVertexIndex(this._left.leftVertex,this._left.leftVertex.index):this._component.updateVertexIndex(this._addedVertex,0),this._editGeometry.notifyChanges({operation:"undo",removedVertices:[this._addedVertex]}))}accumulate(){return!1}},gl=class ml{constructor(e,t,i){this._editGeometry=e,this._vertices=t,this.operation=i,this._undone=!1}apply(){this._vertices.forEach(e=>this.operation.apply(e)),this._editGeometry.components.forEach(e=>e.unnormalizeVertexPositions()),this._editGeometry.notifyChanges({operation:this._undone?"redo":"apply",updatedVertices:this._vertices})}undo(){this._vertices.forEach(e=>this.operation.undo(e)),this._editGeometry.notifyChanges({operation:"undo",updatedVertices:this._vertices}),this._undone=!0}canAccumulate(e){if(this._undone||e._vertices.length!==this._vertices.length)return!1;for(let t=0;t<e._vertices.length;++t)if(e._vertices[t]!==this._vertices[t])return!1;return this.operation.canAccumulate(e.operation)}accumulate(e){return!!(e instanceof ml&&this.canAccumulate(e))&&(this._vertices.forEach(t=>this.operation.accumulate(t,e.operation)),this.operation.accumulateParams(e.operation),this._editGeometry.components.forEach(t=>t.unnormalizeVertexPositions()),this._editGeometry.notifyChanges({operation:"apply",updatedVertices:this._vertices}),!0)}};var ie;(function(n){n[n.CUMULATIVE=0]="CUMULATIVE",n[n.REPLACE=1]="REPLACE"})(ie||(ie={}));let Hf=class{constructor(e,t,i=0){this._editGeometry=e,this._vertices=t,this._minNumberOfVertices=i,this.removedVertices=null}apply(){let e="redo";if(this.removedVertices==null){const t=this.removedVertices=[];this._vertices.forEach(i=>{const s=this._removeVertex(i);s!=null&&t.push(s)}),e="apply"}else this.removedVertices.forEach(t=>{this._removeVertex(t.removedVertex)});this._editGeometry.notifyChanges({operation:e,removedVertices:this._vertices})}undo(){var e;(e=this.removedVertices)==null||e.forEach(t=>{this._undoRemoveVertex(t)}),this._editGeometry.notifyChanges({operation:"undo",addedVertices:this._vertices})}accumulate(){return!1}_removeVertex(e){const t=e.component;if(t.vertices.length<=this._minNumberOfVertices)return null;const i={removedVertex:e,createdEdge:null},s=e.leftEdge,r=e.rightEdge;return t.vertices.splice(t.vertices.indexOf(e),1),s&&(t.edges.splice(t.edges.indexOf(s),1),s.leftVertex.rightEdge=null),r&&(t.edges.splice(t.edges.indexOf(r),1),r.rightVertex.leftEdge=null),e.index===0&&r&&this._vertices.length>0&&t.swapVertices(t.vertices.indexOf(r.rightVertex),0),s&&r&&(i.createdEdge=new Je(t,s.leftVertex,r.rightVertex),t.edges.push(i.createdEdge)),r&&t.updateVertexIndex(r.rightVertex,r.rightVertex.index-1),i}_undoRemoveVertex(e){const t=e.removedVertex,i=e.removedVertex.component,s=t.leftEdge,r=t.rightEdge;e.createdEdge&&i.edges.splice(i.edges.indexOf(e.createdEdge),1),i.vertices.push(t),s&&(i.edges.push(s),s.leftVertex.rightEdge=s),r&&(i.edges.push(r),r.rightVertex.leftEdge=r),i.updateVertexIndex(t,t.index)}},Nf=class{constructor(e,t,i){this._editGeometry=e,this._edge=t,this._t=i,this.createdVertex=null,this._left=null,this._right=null}apply(){let e="redo";const t=this._edge,i=t.component,s=t.leftVertex,r=t.rightVertex;i.edges.splice(i.edges.indexOf(t),1),this.createdVertex==null&&(e="apply",this.createdVertex=new Dn(t.component)),i.vertices.push(this.createdVertex),this.createdVertex.pos=this._editGeometry.coordinateHelper.lerp(t.leftVertex.pos,t.rightVertex.pos,this._t,this._editGeometry.coordinateHelper.createVector()),this._left==null&&(this._left=new Je(i,s,this.createdVertex)),this._left.leftVertex.leftEdge?i.edges.push(this._left):i.edges.unshift(this._left),s.rightEdge=this._left,this._right==null&&(this._right=new Je(i,this.createdVertex,r)),i.edges.push(this._right),r.leftEdge=this._right,i.updateVertexIndex(this.createdVertex,s.index+1),this._editGeometry.notifyChanges({operation:e,addedVertices:[this.createdVertex]})}undo(){if(this.createdVertex==null||this._left==null||this._right==null)return null;const e=this._edge,t=e.component,i=this.createdVertex.leftEdge,s=this.createdVertex.rightEdge,r=i==null?void 0:i.leftVertex,o=s==null?void 0:s.rightVertex;t.vertices.splice(t.vertices.indexOf(this.createdVertex),1),t.edges.splice(t.edges.indexOf(this._left),1),t.edges.splice(t.edges.indexOf(this._right),1),this._edge.leftVertex.leftEdge?t.edges.push(this._edge):t.edges.unshift(this._edge),r&&(r.rightEdge=e),o&&(o.leftEdge=e),r&&t.updateVertexIndex(r,r.index),this._editGeometry.notifyChanges({operation:"undo",removedVertices:[this.createdVertex]})}accumulate(){return!1}},Ff=class yl{constructor(e,t,i){this._editGeometry=e,this._vertex=t,this._pos=i}apply(){const e=this._originalPosition==null;e&&(this._originalPosition=this._vertex.pos),this._apply(e?"apply":"redo")}undo(){this._vertex.pos=this._originalPosition,this._editGeometry.notifyChanges({operation:"undo",updatedVertices:[this._vertex]})}accumulate(e){return e instanceof yl&&e._vertex===this._vertex&&(this._pos=e._pos,this._apply("apply"),!0)}_apply(e){this._vertex.pos=this._pos,this._editGeometry.components.forEach(t=>t.unnormalizeVertexPositions()),this._editGeometry.notifyChanges({operation:e,updatedVertices:[this._vertex]})}},Zf=class{constructor(e,t){this._editGeometry=e,this._component=t,this._createdEdge=null}apply(){let e="redo";if(this._createdEdge==null){e="apply";const t=this._component.getFirstVertex(),i=this._component.getLastVertex();if(this._component.isClosed()||this._component.vertices.length<3||t==null||i==null)return;this._createdEdge=new Je(this._component,i,t)}this._createdEdge.leftVertex.rightEdge=this._createdEdge,this._createdEdge.rightVertex.leftEdge=this._createdEdge,this._component.edges.push(this._createdEdge),this._editGeometry.notifyChanges({operation:e})}undo(){this._createdEdge!=null&&(Go(this._component.edges,this._createdEdge),this._createdEdge.leftVertex.rightEdge=null,this._createdEdge.rightVertex.leftEdge=null,this._editGeometry.notifyChanges({operation:"undo"}))}accumulate(){return!1}},po=class _l{constructor(e,t,i,s){this._editGeometry=e,this.dx=t,this.dy=i,this.dz=s,this._firstTime=!0}apply(){const e=this._firstTime?"apply":"redo";this._firstTime=!1,this._apply(e,this.dx,this.dy,this.dz)}undo(){this._apply("undo",-this.dx,-this.dy,-this.dz)}accumulate(e){const t=this._editGeometry.geometry;return e instanceof _l&&e._editGeometry.geometry===t&&(this._apply("apply",e.dx,e.dy,e.dz),this.dx+=e.dx,this.dy+=e.dy,this.dz+=e.dz,!0)}_apply(e,t,i,s){const r=this._editGeometry.geometry;r.offset(t,i,s);const o=this._editGeometry.components[0].getFirstVertex();if(!o)return;const l=this._editGeometry.coordinateHelper;o.pos=l.pointToVector(r.origin),this._editGeometry.notifyChanges({operation:e,updatedVertices:[o]})}},vl=class bl{constructor(e,t,i,s){this._helper=e,this.dx=t,this.dy=i,this.dz=s}_move(e,t,i,s){this._helper.addDelta(e.pos,t,i,s)}apply(e){this._move(e,this.dx,this.dy,this.dz)}undo(e){this._move(e,-this.dx,-this.dy,-this.dz)}canAccumulate(e){return e instanceof bl}accumulate(e,t){this._move(e,t.dx,t.dy,t.dz)}accumulateParams(e){this.dx+=e.dx,this.dy+=e.dy,this.dz+=e.dz}},qf=class Is{get plane(){return this._plane}get requiresSplitEdgeLeft(){return!this._left.isOriginalDirection}get requiresSplitEdgeRight(){return!this._right.isOriginalDirection}get edgeDirection(){return this._edgeDirection}constructor(e,t,i,s=0,r=_n.IMMEDIATE){this._helper=e,this._planeType=t,this._edge=i,this.distance=s,this._plane=ae(),this._offsetPlane=ae(),this._minDistance=-1/0,this._maxDistance=1/0,this._selectedArrow=1,r===_n.IMMEDIATE&&this._initialize()}_initialize(){this._initializeNeighbors(),this._initializePlane(),this._initializeDistanceConstraints()}_initializeNeighbors(){var r,o,l,c;const e=this._toXYZ(this._edge.leftVertex.pos),t=this._toXYZ((o=(r=this._edge.leftVertex.leftEdge)==null?void 0:r.leftVertex)==null?void 0:o.pos),i=this._toXYZ(this._edge.rightVertex.pos),s=this._toXYZ((c=(l=this._edge.rightVertex.rightEdge)==null?void 0:l.rightVertex)==null?void 0:c.pos);this._edgeDirection=Ar(g(),e,i),t?(this._left=this._computeNeighbor(e,t,this._edgeDirection),this._right=this._computeNeighbor(i,s,this._edgeDirection,this._left)):(this._right=this._computeNeighbor(i,s,this._edgeDirection),this._left=this._computeNeighbor(e,t,this._edgeDirection,this._right))}_toXYZ(e){return e!=null?this._helper.toXYZ(e):null}_pointToXYZ(e){return this._toXYZ(this._helper.pointToVector(e))}_computeNeighbor(e,t,i,s){const r=g();if(t){Ar(r,e,t);const o=!this._passesBisectingAngleThreshold(r,i);return{start:e,end:t,direction:o?this._bisectVectorsPerpendicular(i,r):r,isOriginalDirection:!o}}return this._helper.hasZ()?s&&(Ae(r,i,s.direction),Ae(r,r,i),lt(r,r),Math.sign(r[1])!==Math.sign(i[0])&&ft(r,r,-1)):N(r,-i[1],i[0],0),{start:e,end:t,direction:r,isOriginalDirection:!0}}_passesBisectingAngleThreshold(e,t){const i=Math.abs(Vu(t,e));return i>=fo&&i<=Math.PI-fo}_bisectVectorsPerpendicular(e,t){const i=Z(e,t)<0?e:os(g(),e),s=Math.abs(Z(i,t));if(!(s<go||s>1-go))return this._bisectDirection(i,t);const r=Ae(g(),i,[0,0,1]);return lt(r,r)}_bisectDirection(e,t){const i=he(g(),e,t);return lt(i,i)}_initializePlane(){const e=this._computeNormalDirection(this._left),t=this._computeNormalDirection(this._right);Z(e,t)<0&&os(t,t),Vn(this._left.start,this._bisectDirection(e,t),this._plane)}_computeNormalDirection(e){const t=Ae(g(),e.direction,this._edgeDirection);lt(t,t);const i=Ae(g(),this._edgeDirection,t);return this._planeType===Ls.XY&&(i[2]=0),lt(i,i)}_initializeDistanceConstraints(){this._left.end==null||this.requiresSplitEdgeLeft||this._updateDistanceConstraint(Vt(this._plane,this._left.end)),this._right.end==null||this.requiresSplitEdgeRight||this._updateDistanceConstraint(Vt(this._plane,this._right.end)),this._updateIntersectDistanceConstraint(this._plane)}_updateDistanceConstraint(e){e<=0&&(this._minDistance=Math.max(this._minDistance,e)),e>=0&&(this._maxDistance=Math.min(this._maxDistance,e))}_updateIntersectDistanceConstraint(e){const t=zt(e),i=this._edgeDirection,s=he(g(),this._left.start,this._left.direction),r=he(g(),this._right.start,this._right.direction),o=this._pointInBasis2D(L(),t,i,this._left.start),l=this._pointInBasis2D(L(),t,i,s),c=this._pointInBasis2D(L(),t,i,this._right.start),h=this._pointInBasis2D(L(),t,i,r),[d]=Eh({start:l,end:o,type:O.LINE},{start:h,end:c,type:O.LINE});if(!d)return;const p=X(L(),o,l);Ys(p,p);const _=X(L(),d,l),f=yt(p,_),m=he(g(),s,ft(g(),this._left.direction,-f)),y=Vt(e,m);this._updateDistanceConstraint(y)}_pointInBasis2D(e,t,i,s){return e[0]=Hr(t,s),e[1]=Hr(i,s),e}_offset(e,t){Number.isFinite(this._minDistance)&&(t=Math.max(this._minDistance,t)),Number.isFinite(this._maxDistance)&&(t=Math.min(this._maxDistance,t)),Ni(this._offsetPlane,this._plane),this._offsetPlane[3]-=t;const i=(r,o,l)=>o!=null&&Qs(this._offsetPlane,r,he(g(),r,o),l),s=g();(e===this._edge.leftVertex?i(this._left.start,this._left.direction,s):i(this._right.start,this._right.direction,s))&&this._helper.copy(this._helper.fromXYZ(s,void 0,this._helper.getM(e.pos)),e.pos)}selectArrowFromStartPoint(e){this._selectedArrow=na(this.plane,this._pointToXYZ(e))?1:-1}get selectedArrow(){return this._selectedArrow}signedDistanceToPoint(e){return Vt(this.plane,this._pointToXYZ(e))}clampedStartAndEnd(e){const t=this._helper.toXYZ(this._helper.pointToVector(e)),i=Js(this._plane,t,g()),s=Vt(this._plane,t),r=Uc(s,this._minDistance,this._maxDistance);return St(t,i,t,r/s),{start:i,end:t}}apply(e){this._offset(e,this.distance)}undo(e){this._offset(e,0)}canAccumulate(e){return e instanceof Is&&this._edge.leftVertex.index===e._edge.leftVertex.index&&this._edge.rightVertex.index===e._edge.rightVertex.index&&this._edge.component===e._edge.component&&this._maybeEqualsVec3(this._left.direction,e._left.direction)&&this._maybeEqualsVec3(this._right.direction,e._right.direction)&&Bt(zt(this._plane),zt(e._plane))}accumulate(e,t){const i=this._plane[3]-t._plane[3]+t.distance;this._offset(e,i)}accumulateParams(e){const t=e.distance-e._plane[3];this.distance=t+this._plane[3]}clone(){const e=new Is(this._helper,this._planeType,this._edge,this.distance,_n.DEFERRED);return Ni(e._plane,this._plane),Ni(e._offsetPlane,this._offsetPlane),e._maxDistance=this._maxDistance,e._minDistance=this._minDistance,e._left=this._cloneNeighbor(this._left),e._right=this._cloneNeighbor(this._right),e._edgeDirection=oe(g(),this._edgeDirection),e}_maybeEqualsVec3(e,t){return e==null&&t==null||e!=null&&t!=null&&Bt(e,t)}_cloneNeighbor({start:e,end:t,direction:i,isOriginalDirection:s}){return{start:oe(g(),e),end:t!=null?oe(g(),t):null,direction:oe(g(),i),isOriginalDirection:s}}};const fo=Fo(15),go=.001;var Ls,_n;(function(n){n[n.XYZ=0]="XYZ",n[n.XY=1]="XY"})(Ls||(Ls={})),function(n){n[n.IMMEDIATE=0]="IMMEDIATE",n[n.DEFERRED=1]="DEFERRED"}(_n||(_n={}));let xl=class wl{constructor(e,t,i=ie.CUMULATIVE){this.origin=e,this.angle=t,this._accumulationType=i}_rotate(e,t){Hc(e.pos,e.pos,this.origin,t)}apply(e){this._rotate(e,this.angle)}undo(e){this._rotate(e,-this.angle)}canAccumulate(e){return e instanceof wl&&Zt(this.origin,e.origin)}accumulate(e,t){const i=t._accumulationType===ie.REPLACE;this._rotate(e,i?t.angle-this.angle:t.angle)}accumulateParams(e){const t=e._accumulationType===ie.REPLACE;this.angle=t?e.angle:this.angle+e.angle}};class Oi{constructor(e,t,i,s,r=ie.CUMULATIVE){this.origin=e,this.axis1=t,this.factor1=i,this.factor2=s,this._accumulationType=r,this.axis2=gt(t[1],-t[0])}_scale(e,t,i){ri(e.pos,e.pos,this.origin,this.axis1,t),ri(e.pos,e.pos,this.origin,this.axis2,i)}apply(e){this._scale(e,this.factor1,this.factor2)}undo(e){this._scale(e,1/this.factor1,1/this.factor2)}canAccumulate(e){return e instanceof Oi&&Zt(this.origin,e.origin)&&Zt(this.axis1,e.axis1)}accumulate(e,t){t._accumulationType===ie.REPLACE?this._scale(e,t.factor1/this.factor1,t.factor2/this.factor2):this._scale(e,t.factor1,t.factor2)}accumulateParams(e){const t=e._accumulationType===ie.REPLACE;this.factor1=t?e.factor1:this.factor1*e.factor1,this.factor2=t?e.factor2:this.factor2*e.factor2}}let Bf=class $l{constructor(e,t){this._editGeometry=e,this._newPositions=t}apply(){const e=this._originalPositions==null?"apply":"redo";if(!this._originalPositions){const t=this._editGeometry.coordinateHelper;this._originalPositions=this._editGeometry.allVertices.map(i=>t.clone(i.pos))}this._apply(e,this._newPositions)}undo(){this._originalPositions&&this._apply("undo",this._originalPositions)}accumulate(e){return e instanceof $l&&(this._newPositions=e._newPositions,this._apply("apply",this._newPositions),!0)}_apply(e,t){const i=this._editGeometry.coordinateHelper,s=this._editGeometry.allVertices;for(let r=0;r<s.length;r++)i.copy(t[r],s[r].pos);this._editGeometry.components.forEach(r=>r.unnormalizeVertexPositions()),this._editGeometry.notifyChanges({operation:e,updatedVertices:s})}};var Tl;const Wf=Symbol();let Yf=class{constructor(e){this._operations=[],this._closed=!1,this[Tl]=!0,e&&(this._operations=e,this._closed=!0)}close(){this._closed=!0}apply(){for(const e of this._operations)e.apply()}undo(){for(let e=this._operations.length-1;e>=0;e--)this._operations[e].undo()}accumulate(e){if(this._closed)return!1;const t=this._operations.length?this._operations[this._operations.length-1]:null;return t&&t.accumulate(e)||(this._operations.push(e),e.apply()),!0}};Tl=Wf;let xr=class El extends kt{constructor(e,t){super(),this.data=e,this.viewingMode=t,this._undoStack=[],this._redoStack=[],this._listener=this.data.on("change",i=>{i.addedVertices&&this.emit("vertex-add",{type:"vertex-add",vertices:i.addedVertices,operation:i.operation}),i.removedVertices&&this.emit("vertex-remove",{type:"vertex-remove",vertices:i.removedVertices,operation:i.operation}),i.updatedVertices&&this.emit("vertex-update",{type:"vertex-update",vertices:i.updatedVertices,operation:i.operation})})}destroy(){this._listener.remove()}splitEdge(e,t){return this._apply(new Nf(this.data,e,t))}updateVertices(e,t,i=I.ACCUMULATE_STEPS){return this._apply(new gl(this.data,e,t),i)}move(e,t,i,s=I.ACCUMULATE_STEPS){return an(this.data)?this._apply(new po(this.data,e,t,i),s):this.moveVertices(this.data.allVertices,e,t,i,s)}moveVertices(e,t,i,s,r=I.ACCUMULATE_STEPS){return an(this.data)?this._apply(new po(this.data,t,i,s),r):this.updateVertices(e,new vl(this.data.coordinateHelper,t,i,s),r)}scale(e,t,i,s,r=I.ACCUMULATE_STEPS,o=ie.CUMULATIVE){return this.scaleVertices(this.data.allVertices,e,t,i,s,r,o)}scaleVertices(e,t,i,s,r,o=I.ACCUMULATE_STEPS,l=ie.CUMULATIVE){return this.updateVertices(e,new Oi(t,i,s,r,l),o)}rotate(e,t,i=I.ACCUMULATE_STEPS,s=ie.CUMULATIVE){return this.rotateVertices(this.data.allVertices,e,t,i,s)}rotateVertices(e,t,i,s=I.ACCUMULATE_STEPS,r=ie.CUMULATIVE){return this.updateVertices(e,new xl(t,i,r),s)}removeVertices(e){return this._apply(new Hf(this.data,e,this._minNumVerticesPerType))}appendVertex(e){return this.data.components.length===0?null:this._apply(new Uf(this.data,this.data.components[0],e))}setVertexPosition(e,t){return this._apply(new Ff(this.data,e,t))}offsetEdge(e,t,i,s=I.ACCUMULATE_STEPS){return this.updateVertices([t.leftVertex,t.rightVertex],new qf(this.data.coordinateHelper,e,t,i),s)}trySetGeometry(e,t=I.ACCUMULATE_STEPS){const{data:i}=this,{coordinateHelper:s}=i;if(i.type!==e.type||!i.spatialReference.equals(e.spatialReference)||s.hasZ()!==e.hasZ||s.hasM()!==e.hasM||!Nc(i.geometry,e)||an(i))return;const r=Array.from(pi.fromGeometry(e,this.viewingMode).iterateVertices(),o=>o.pos);return this.setVertexPositions(r,t)}setVertexPositions(e,t=I.ACCUMULATE_STEPS){return this._apply(new Bf(this.data,e),t)}createResetState(){if(an(this.data))return this._createResetStateMesh();const e=this.data.geometry.clone();return B(()=>this.trySetGeometry(e))}closeComponent(e){return this.data.components.includes(e)?this._apply(new Zf(this.data,e)):null}canRemoveVertex(e){return e.vertices.length>this._minNumVerticesPerType}createUndoGroup(){const e=new Yf;return this._apply(e),B(()=>e.close())}undo(){if(this._undoStack.length>0){const e=this._undoStack.pop();return e.undo(),this._redoStack.push(e),e}return null}redo(){if(this._redoStack.length>0){const e=this._redoStack.pop();return e.apply(),this._undoStack.push(e),e}return null}get canUndo(){return this._undoStack.length>0}get canRedo(){return this._redoStack.length>0}get lastOperation(){return this._undoStack.length>0?this._undoStack[this._undoStack.length-1]:null}get _minNumVerticesPerType(){switch(this.data.type){case"point":return 1;case"polyline":return 2;case"polygon":return 3;default:return 0}}_apply(e,t=I.ACCUMULATE_STEPS){return t!==I.NEW_STEP&&this.lastOperation!=null&&this.lastOperation.accumulate(e)||(e.apply(),this._undoStack.push(e),this._redoStack=[]),e}_createResetStateMesh(){if(!an(this.data))return B();const e=this.data.geometry,{vertexSpace:t}=e;if(t.origin){const s=_t(t.origin);return B(()=>{e.vertexSpace.origin=s})}const i=e.vertexAttributes.clonePositional();return B(()=>{e.vertexAttributes=i,e.vertexAttributesChanged()})}static fromGeometry(e,t){return new El(pi.fromGeometry(e,t),t)}};function Xf(n,e){let t=null,i=null;return s=>{if(s.action==="cancel")return void(i!=null&&(i.execute({action:"cancel"}),t=null,i=null));const r={action:s.action,screenStart:s.start,screenEnd:s.screenPoint};s.action==="start"&&t==null&&(t=new Pn,i=new Pn,e(n,t,i,s.pointerType,r)),t!=null&&t.execute(r),s.action==="end"&&t!=null&&(t=null,i=null)}}function Ht(n,e){return n.events.on("drag",Xf(n,e))}function wr(n,e=null,t){var o;let i=null;const s=e==null||(o=n.spatialReference)!=null&&o.equals(e)?l=>l:l=>l!=null?Wt(l,e):l,r={exclude:[],...t};return l=>{if(l.action==="start"&&(i=s(n.toMap(l.screenStart,r))),i==null)return null;const c=s(n.toMap(l.screenEnd,r));return c!=null?{...l,mapStart:i,mapEnd:c}:null}}const jf=()=>{};let Pn=class Sl{constructor(){this.execute=jf}next(e,t=new Sl){return e!=null&&(this.execute=i=>{const s=e(i);s!=null&&t.execute(s)}),t}};function Kf(n,e,t=[]){if(n.type==="2d")return s=>s;let i=null;return s=>{s.action==="start"&&(i=n.toMap(s.screenStart,{exclude:t}),i!=null&&(i.z=zr(i,n,e)));const r=n.toMap(s.screenEnd,{exclude:t});r!=null&&(r.z=zr(r,n,e));const o=i!=null&&r!=null?{sceneStart:i,sceneEnd:r}:null;return{...s,scenePoints:o}}}let Ds=class{constructor(e){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.drawConstraints=null,this.editGeometryOperations=e.editGeometryOperations,this.elevationInfo=e.elevationInfo,this.pointer=e.pointer,this.vertexHandle=e.vertexHandle,this.excludeFeature=e.excludeFeature,this.feature=e.feature,this.visualizer=e.visualizer,this.selfSnappingZ=e.selfSnappingZ,this.drawConstraints=e.drawConstraints}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}get spatialReference(){return this.coordinateHelper.spatialReference}};function Qf({predicate:n=()=>!0,snappingManager:e,snappingContext:t,updatingHandles:i,useZ:s=!0}){const r=new Pn;if(e==null)return{snappingStep:[mo,r],cancelSnapping:mo};let o,l=null,c=null,h=null;const d=()=>{l=as(l),e.doneSnapping(),c==null||c.frameTask.remove(),c=null,o=Zo(o),h=null},p=Jf(e,s,r);let _=null,f=null,m=null;return{snappingStep:[y=>{if(!n(y))return y;const{action:w}=y;if(w==="start"){const{info:b}=y,$=eg(e.view);if(c=tg(t,y,$),c.context.selfSnappingZ=null,!s&&b!=null){const M=ig(t.coordinateHelper,b.handle.component);M!=null&&(c.context.selfSnappingZ={value:M,elevationInfo:t.elevationInfo??gi})}}if(c!=null){const{context:b,originalScenePos:$,originalPos:M}=c,{mapEnd:K,mapStart:Q,scenePoints:W}=y,ge=Pl(M,Gs(K,Q)),le=Gs(Q,M),tn={...y,action:"update"},Ge=c.context,nt=ng($,W),xt=e.update({point:ge,scenePoint:nt,context:b});if(m=xt,Ml(K,xt,le,s),_=ge,f=nt,w!=="end"){const{frameTask:Ii}=c;l==null&&(l=new AbortController),h=Al=>{i.addPromise(ls(p({frameTask:Ii,event:tn,context:Ge,point:ge,scenePoint:nt,delta:le,getLastState:()=>({point:_,scenePoint:f,updatePoint:Al.forceUpdate?null:m})},l.signal)))},h({forceUpdate:!1}),o==null&&(o=U(()=>e.options.effectiveEnabled,()=>h==null?void 0:h({forceUpdate:!0})))}}return w==="end"&&d(),y},r],cancelSnapping:y=>(d(),y)}}function Jf(n,e,t){return Wo(async({frameTask:i,point:s,scenePoint:r,context:o,event:l,delta:c,getLastState:h},d)=>{const p=await i.schedule(()=>n.snap({point:s,scenePoint:r,context:o,signal:d}),d);if(p.valid){let _=await i.schedule(()=>p.apply(),d);const f=h();f.point!=null&&s!==f.point&&(_=n.update({point:f.point,scenePoint:f.scenePoint,context:o})),f.updatePoint!=null&&mn(_,f.updatePoint)||(Ml(l.mapEnd,_,c,e),t.execute(l))}})}function eg(n){return n.type==="3d"?n.resourceController.scheduler.registerTask(Bo.SNAPPING):qo}function tg(n,e,t){return{context:new Ds({editGeometryOperations:n.editGeometryOperations,elevationInfo:n.elevationInfo,pointer:n.pointer,vertexHandle:e.info!=null?e.info.handle:null,excludeFeature:n.excludeFeature,feature:n.feature,visualizer:n.visualizer}),originalPos:e.snapOrigin!=null?n.coordinateHelper.vectorToDehydratedPoint(e.snapOrigin):e.mapStart,originalScenePos:e.scenePoints!=null?e.scenePoints.sceneStart:null,frameTask:t}}function Pl(n,[e,t,i]){const s=sa(n);return s.x+=e,s.y+=t,s.hasZ&&(s.z+=i),s}function ng(n,e){return n==null||e==null?null:Pl(n,Gs(e.sceneEnd,e.sceneStart))}function Gs(n,e){const t=n.hasZ&&e.hasZ?n.z-e.z:0;return[n.x-e.x,n.y-e.y,t]}function Ml(n,e,[t,i,s],r){n.x=e.x+t,n.y=e.y+i,r&&n.hasZ&&e.hasZ&&(n.z=e.z+s)}function ig(n,e){if(!n.hasZ())return null;const t=e.vertices;let i=null;for(const s of t){const r=n.getZ(s.pos);if(i!=null&&r!=null&&Math.abs(r-i)>1e-6)return null;i==null&&(i=r)}return i}function mo(n){return n}let $t=class extends te{constructor(n){super(n),this.constrainResult=e=>e,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=Wo(async(e,t,i,s)=>{const r=this._frameTask;if(r==null)return;const o=await r.schedule(()=>t.snap({...e,context:i,signal:s}),s);o.valid&&await r.schedule(()=>{this.stagedPoint=o.apply(),e!==this._snapPoints&&this._snapPoints!=null&&(this.stagedPoint=t.update({...this._snapPoints,context:i}))},s)})}get stagedPoint(){return this._stagedPoint}set stagedPoint(n){this._stagedPoint=this.constrainResult(n)}initialize(){var e,t;const n=this.view.type==="3d"?(t=(e=this.view)==null?void 0:e.resourceController)==null?void 0:t.scheduler:null;this._frameTask=n!=null?n.registerTask(Bo.SNAPPING):qo}destroy(){this._abortController=as(this._abortController),this._frameTask=Zo(this._frameTask)}update(n,e,t){this._snapPoints=n;const{point:i,scenePoint:s}=n,r=e.update({point:i,scenePoint:s,context:t});return this.stagedPoint=r,r}async snap(n,e,t){const{point:i,scenePoint:s}=n;return this.stagedPoint=e.update({point:i,scenePoint:s,context:t}),this._snapPoints=n,this._abortController==null&&(this._abortController=new AbortController),this._snap(n,e,t,this._abortController.signal)}async snapAgainNearPreviousMapPoint(n,e){this._snapPoints!=null&&await this.snap(this._snapPoints,n,e)}abort(){this._abortController=as(this._abortController),this._snapPoints=null}};a([u({constructOnly:!0})],$t.prototype,"view",void 0),a([u()],$t.prototype,"stagedPoint",null),a([u()],$t.prototype,"constrainResult",void 0),a([u()],$t.prototype,"_stagedPoint",void 0),$t=a([x("esri.views.interactive.snapping.SnappingOperation")],$t);var yo;(function(n){n[n.TARGET=0]="TARGET",n[n.REFERENCE=1]="REFERENCE",n[n.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"})(yo||(yo={}));const _o=Symbol("snapping-toggle");function sg(n,e=()=>{}){const t=U(()=>({view:n.view,snappingOptions:n.snappingOptions}),({view:i,snappingOptions:s})=>{if(n.removeHandles(_o),!i||!s)return;const r=zo.TOOL,o=[i.on("key-down",l=>{l.key!==to.toggle||l.repeat||(s.enabledToggled=!0,e())},r),i.on("key-up",l=>{l.key===to.toggle&&(s.enabledToggled=!1,e())},r),i.on("pointer-move",l=>{const c=l.native.ctrlKey;s.enabledToggled!==c&&(s.enabledToggled=c,e())},r)];n.addHandles(o,_o)},Mt);n.addHandles(t)}const rg="crosshair",og="progress",vo=Symbol(),bo=Symbol();let T=class extends kt.EventedMixin(te){constructor(e){super(e),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new ku,this._stagedScreenPoint=null,this._stagedPointerType=null,this._updatingHandles=new ko,this._stagedPointerId=null,this.constraintsEnabled=!1,this.constraints=void 0,this._getPointConstraint=ys(vd),this._getPolylineOrPolygonConstraint=ys(bd),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new Vi,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,e.elevationInfo==null&&(this.elevationInfo=ru(!!e.hasZ))}initialize(){const{geometryType:e,view:t}=this,i=t.spatialReference,s="viewingMode"in t.state?t.state.viewingMode:wn.Local,r=e==="segment"||e==="multipoint"?"polyline":e;this.coordinateHelper=pl(this.hasZ,this.hasM,i),this._editGeometryOperations=new xr(new pi(r,this.coordinateHelper),s),this._snappingOperation=new $t({view:t}),this.addHandles([U(()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this._constraint}),({stagedPoint:c,constraint:h},d)=>{const{snappingOptions:p}=this;if(p&&(p.forceDisabled=h!=null&&ve(h)),d!=null&&c===d.stagedPoint&&h!==d.constraint)return this._onKeyboardBasedChange();this._processCursor(c??this._screenToMap(this._stagedScreenPoint))},{equals:(c,h)=>c.stagedPoint===h.stagedPoint&&Fc(c.constraint,h.constraint)}),U(()=>this.view.viewpoint,(c,h)=>{c&&h&&Zc(c,h)&&this._onKeyboardBasedChange()})]),this._activeComponent=new Ai(i,s),this._editGeometryOperations.data.components.push(this._activeComponent);const o=this.segmentLabels;o!=null&&(o.context={view:t,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.addHandles(U(()=>this.labelOptions.enabled,c=>{o.visible=c},Mt))),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],c=>{var m,y,w,b;const h=c.vertices.map($=>({componentIndex:0,vertexIndex:$.index,coordinates:this.coordinateHelper.vectorToArray($.pos)})),d=h.map($=>$.coordinates),p=this.coordinateHelper.vectorToDehydratedPoint((m=this._activeComponent.getFirstVertex())==null?void 0:m.pos)??null;mn(p,this.firstVertex)||(this.firstVertex=p);const _=this.coordinateHelper.vectorToDehydratedPoint((y=this._activeComponent.getLastVertex())==null?void 0:y.pos)??null;mn(_,this.lastVertex)||(this.lastVertex=_);const f=this.coordinateHelper.vectorToDehydratedPoint((b=(w=this._activeComponent.edges.at(-1))==null?void 0:w.leftVertex)==null?void 0:b.pos)??null;switch(mn(f,this.secondToLastVertex)||(this.secondToLastVertex=f),this._processCursor(this.cursorVertex),c.type){case"vertex-add":this.emit(c.type,{...c,added:d,vertices:h});break;case"vertex-update":this.emit(c.type,{...c,updated:d,vertices:h});break;case"vertex-remove":this.emit(c.type,{...c,removed:d,vertices:h})}}));const l=this._manipulator=new Af({consumesClicks:!1,grabbableForEvent:c=>this.drawingMode!=="click"||c.pointerType==="touch"&&this._snappingEnabled&&this._pointerDownStates.size===1});this.manipulators.add(l),l.grabbable=e!=="point",this.addHandles([l.events.on("immediate-click",c=>this._onImmediateClick(c)),l.events.on("immediate-double-click",c=>this._onImmediateDoubleClick(c)),U(()=>this.drawingMode,()=>{this.removeHandles(vo),this.addHandles(this._createManipulatorDragPipeline(l),vo)},Mt),U(()=>({effectiveCursor:this.effectiveCursor}),({effectiveCursor:c})=>{l.cursor=c},Mt)]),sg(this,()=>{const c=this.view.inputManager.latestPointerType??"mouse",h=this._getSnappingContext(c);if(this.snappingManager!=null){const d=this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,h);this._updatingHandles.addPromise(ls(d))}})}destroy(){pe(this.segmentLabels),pe(this._snappingOperation),this._editGeometryOperations=pe(this._editGeometryOperations),this._updatingHandles.destroy()}get _isDragging(){const{_stagedPointerId:e,_manipulator:t}=this;return e!=null&&this._pointerDownStates.has(e)||t.grabbing||!t.interactive}get _snappingEnabled(){return this.snappingManager!=null&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const e=this._updateAndGetEffectiveDrawSurface();return this.view.type==="3d"&&this.drawSurface!==e}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map(e=>this.coordinateHelper.vectorToArray(e.pos))}get _constraint(){const{constraints:e,constraintsEnabled:t}=this;if(e&&t)switch(this.geometryType){case"point":return this._getPointConstraint(e);case"polygon":case"polyline":return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,e)}}set drawingMode(e){this._set("drawingMode",e??dl)}get effectiveCursor(){return this.loading?og:this._hideDefaultCursor?null:this.cursor||rg}get interactive(){return this._manipulator.interactive}set interactive(e){this._manipulator.interactive=e}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get snappingOptions(){return this.snappingManager!=null?this.snappingManager.options:null}get cursorVertex(){return this._get("cursorVertex")}get visualizationCursorVertex(){return this._stagedPointerType==="mouse"?this.cursorVertex:null}get committableVertex(){const{cursorVertex:e,lastVertex:t,firstVertex:i,geometryType:s}=this;return s==="polygon"&&Fi(e,i)||Fi(e,t)?null:e}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){const{committedVertices:e,committableVertex:t,coordinateHelper:i}=this,s=e.slice();return t!=null&&s.push(i.pointToArray(t)),s}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();const{committableVertex:e}=this;e!=null&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(e))}complete(e){var o;const t=(e==null?void 0:e.aborted)||!1;this._snappingOperation.abort(),(o=this.snappingManager)==null||o.doneSnapping();const{geometryType:i,numCommittedVertices:s}=this,r=i==="multipoint"&&s===0||i==="polyline"&&s<2||i==="polygon"&&s<3;i!=="segment"&&i!=="point"||this.commitStagedVertex(),this._createOperationCompleted=!r,(this.isCompleted||t)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit("complete",{vertices:this.committedVertices.map((l,c)=>({componentIndex:0,vertexIndex:c,coordinates:l})),aborted:t,type:"complete"}))}onInputEvent(e){switch(e.type){case"pointer-down":this._pointerDownStates.add(e.pointerId);break;case"pointer-up":this._pointerDownStates.delete(e.pointerId)}switch(e.type){case"pointer-move":return this._onPointerMove(e);case"hold":return this._onHold(e)}}redo(){this._editGeometryOperations.redo()}undo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(e){var l,c;const t=ns(this.cursorVertex),i=ns(e),s=i&&(((l=this._updateAndGetEffectiveDrawSurface())==null?void 0:l.constrainZ(i))??i),r=this._snapToClosingVertex(s),o=this._applyConstraints(r);Fi(t,o)||(this._set("cursorVertex",o),(c=this.segmentLabels)==null||c.set("stagedVertex",o!=null?this.coordinateHelper.pointToVector(o):null),o==null||this._stagedPointerType!=="mouse"?this.emit("cursor-remove"):this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(o)}],operation:"apply",type:"vertex-update"}))}_snapToClosingVertex(e){if(e==null||this._isDragging||this.geometryType!=="polygon"||this.numCommittedVertices<=2)return e;const t=this._mapToScreen(e);if(!t)return e;const i=this._activeComponent;return this._vertexWithinPointerDistance(i.vertices[0].pos,t)?this.firstVertex:this._vertexWithinPointerDistance(i.vertices.at(-1).pos,t)?this.lastVertex:e}_createManipulatorDragPipeline(e){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(e);case"freehand":return this._createManipulatorDragPipelineFreehand(e);case"hybrid":return this._createManipulatorDragPipelineHybrid(e)}}_createManipulatorDragPipelineClick(e){return Ht(e,(t,i,s,r)=>{const o=r==="touch"&&this._snappingEnabled;if(this.isCompleted||!o)return;const{snappingStep:l,cancelSnapping:c}=Qf({predicate:()=>o,snappingManager:this.snappingManager,snappingContext:new Ds({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:r,visualizer:this.snappingVisualizer,drawConstraints:this.constraints}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});s=s.next(h=>(o&&this.snappingManager!=null&&this.snappingManager.doneSnapping(),h)).next(c),i.next(this._screenToMapDragEventStep()).next(h=>(h.action==="start"&&(this._processCursor(h.mapStart),(this.geometryType==="segment"||o&&!this.numCommittedVertices)&&this.commitStagedVertex()),h)).next(Kf(this.view,this.elevationInfo)).next(...l).next(h=>(o&&(this._processCursor(h.mapEnd),h.action==="end"&&this.commitStagedVertex()),h)).next(h=>(h.action==="end"&&(this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()),h))})}_createManipulatorDragPipelineFreehand(e){return Ht(e,(t,i)=>{this.isCompleted||i.next(this._screenToMapDragEventStep()).next(s=>(s.action==="start"&&(this._snappingOperation.abort(),this.committableVertex==null&&this._processCursor(s.mapStart),this.geometryType==="segment"&&this.commitStagedVertex()),s)).next(s=>{switch(s.action){case"start":case"update":this._processCursor(s.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this.complete()}return s})})}_createManipulatorDragPipelineHybrid(e){return Ht(e,(t,i)=>{this.isCompleted||i.next(this._screenToMapDragEventStep()).next(s=>(s.action==="start"&&(this._snappingOperation.abort(),this.addHandles(this._editGeometryOperations.createUndoGroup(),bo),this._processCursor(s.mapStart),this.commitStagedVertex()),s)).next(s=>{switch(s.action){case"start":case"update":this._processCursor(s.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.removeHandles(bo),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()}return s})})}get _drawAtFixedElevation(){const{constraintsEnabled:e,constraintZ:t,geometryType:i,numCommittedVertices:s}=this;return e?t!=null||i==="segment"&&s>0:(i==="segment"||i==="polygon")&&s>0}_updateAndGetEffectiveDrawSurface(){var h;const{constraintsEnabled:e,coordinateHelper:t,drawSurface:i,elevationDrawSurface:s,snapToSceneEnabled:r}=this;if(s==null)return i;if(!this.hasZ)return s.defaultZ=null,s;const o=(h=this.elevationInfo)==null?void 0:h.mode;let l=this.defaultZ,c=e||o==="absolute-height";return r!=null&&(c=r),o==="on-the-ground"&&(c=!1),this._drawAtFixedElevation&&(l=(e?this.constraintZ:null)??t.getZ(this._activeComponent.vertices[0].pos),c=!1),c?i:(s.defaultZ=l,s)}_mapToScreen(e){var t;return(t=this._updateAndGetEffectiveDrawSurface())==null?void 0:t.mapToScreen(e)}_onHold(e){this._snappingOperation.abort(),this.drawingMode==="click"&&e.pointerType==="touch"&&this._snappingEnabled&&this._processCursor(e.mapPoint),e.stopPropagation()}_onImmediateClick(e){if(!(e.pointerType==="mouse"&&e.button===2||this._manipulator.dragging))try{const{drawingMode:t,geometryType:i}=this;this._stagedPointerType=e.pointerType,this._stagedScreenPoint=e.screenPoint;const s=this._screenToMap(e.screenPoint);if(s==null||s==null||t==="freehand"&&i!=="point")return;if(this._snappingEnabled&&this.cursorVertex!=null||this._processCursor(s),this.committableVertex==null)return void this.complete();this.commitStagedVertex(),e.pointerType!=="mouse"&&this._processCursor(null),(t==="freehand"||i==="point"||i==="segment"&&this.numCommittedVertices===2||i==="segment"&&t==="hybrid"&&this.numCommittedVertices===1)&&this.complete()}finally{e.stopPropagation()}}_onImmediateDoubleClick(e){this._manipulator.dragging||this.geometryType==="point"||(this.complete(),e.stopPropagation())}_onPointerMove(e){const t=Bs(e.x,e.y);this._stagedScreenPoint=t,this._stagedPointerType=e.pointerType,this._stagedPointerId=e.pointerId,this._isDragging?this._snappingOperation.abort():(e.stopPropagation(),this._processCursorMovementRelativeToSurface(t,e.pointerType))}_onKeyboardBasedChange(){this._stagedPointerType==="mouse"&&this._stagedScreenPoint&&this._stagedPointerId!=null&&!this._isDragging?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(e,t){var c;const i=this._snappingOperation,s=this._screenToMap(e),r=this._requiresScenePoint?(c=this.drawSurface)==null?void 0:c.screenToMap(e):null;if(s==null)return this._hideDefaultCursor=!0,this._processCursor(null),void i.abort();this._hideDefaultCursor=!1;const o=this.snappingManager;if(o==null)return this._processCursor(s),void i.abort();const l=this._getSnappingContext(t);this._updatingHandles.addPromise(ls(i.snap({point:s,scenePoint:r},o,l)))}_applyConstraints(e){const{_constraint:t,constraints:i}=this;if(!e||!i||!t)return e;const{context:s}=i,r=Ei(e,s),o=r?t.closestTo(r):void 0;if(!o)return e;const l=wd(o,e,s),c=this.view.type==="2d"||s.elevationInfo.mode!=="absolute-height";return l!=null&&c&&this.constraintZ!=null&&this.hasZ&&(l.z=this.constraintZ),l}_screenToMap(e){var t;return e?(t=this._updateAndGetEffectiveDrawSurface())==null?void 0:t.screenToMap(e):null}_screenToMapDragEventStep(){let e=null;return t=>{if(t.action==="start"&&(e=this._screenToMap(t.screenStart)),e==null)return null;const i=this._screenToMap(t.screenEnd);return i!=null?{...t,mapStart:e,mapEnd:i}:null}}_vertexWithinPointerDistance(e,t){const s=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(e));return s!=null&&ag(s,t,25)}_getSnappingContext(e){var i;const t=this._drawAtFixedElevation?(i=this.elevationDrawSurface)==null?void 0:i.defaultZ:null;return new Ds({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:e,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:t!=null?{value:t,elevationInfo:this.elevationInfo}:null,drawConstraints:this.constraints})}};function ag(n,e,t){const i=n.x-e.x,s=n.y-e.y;return i*i+s*s<=t}a([u()],T.prototype,"_hideDefaultCursor",void 0),a([u()],T.prototype,"_stagedPointerId",void 0),a([u()],T.prototype,"_isDragging",null),a([u()],T.prototype,"_snappingOperation",void 0),a([u()],T.prototype,"_snappingEnabled",null),a([u({constructOnly:!0})],T.prototype,"graphic",void 0),a([u()],T.prototype,"constraintsEnabled",void 0),a([u()],T.prototype,"constraints",void 0),a([u()],T.prototype,"_constraint",null),a([u()],T.prototype,"constraintZ",void 0),a([u()],T.prototype,"defaultZ",void 0),a([u()],T.prototype,"isDraped",void 0),a([u({value:dl})],T.prototype,"drawingMode",null),a([u({constructOnly:!0})],T.prototype,"elevationDrawSurface",void 0),a([u({constructOnly:!0})],T.prototype,"elevationInfo",void 0),a([u({constructOnly:!0,type:Vi})],T.prototype,"labelOptions",void 0),a([u({constructOnly:!0})],T.prototype,"geometryType",void 0),a([u({constructOnly:!0})],T.prototype,"hasM",void 0),a([u({constructOnly:!0})],T.prototype,"hasZ",void 0),a([u()],T.prototype,"cursor",void 0),a([u()],T.prototype,"effectiveCursor",null),a([u()],T.prototype,"loading",void 0),a([u({constructOnly:!0})],T.prototype,"manipulators",void 0),a([u({constructOnly:!0})],T.prototype,"drawSurface",void 0),a([u({constructOnly:!0})],T.prototype,"segmentLabels",void 0),a([u({constructOnly:!0})],T.prototype,"snappingManager",void 0),a([u({constructOnly:!0})],T.prototype,"snappingVisualizer",void 0),a([u()],T.prototype,"snapToSceneEnabled",void 0),a([u({readOnly:!0})],T.prototype,"cursorVertex",null),a([u({readOnly:!0})],T.prototype,"visualizationCursorVertex",null),a([u()],T.prototype,"committableVertex",null),a([u()],T.prototype,"firstVertex",void 0),a([u()],T.prototype,"lastVertex",void 0),a([u()],T.prototype,"secondToLastVertex",void 0),a([u()],T.prototype,"updating",null),a([u({constructOnly:!0})],T.prototype,"view",void 0),T=a([x("esri.views.draw.DrawOperation")],T);let lg=class{constructor(e,t=!1,i=0){this.view=e,this.hasZ=t,this.defaultZ=i,this.mapToScreen=s=>e.toScreen(s),this.screenToMap=t?s=>{const r=e.toMap(s);return r.z=i,r}:s=>e.toMap(s)}constrainZ(e){const{defaultZ:t}=this;return this.hasZ&&e.z!==t&&((e=sa(e)).z=t),e}};new pt;let ln=class extends S{constructor(e){super(e),this._visualElementGraphics={regularVertices:null,activeVertex:null,activeEdge:null},this.activeFillSymbol=null,this.type="draw-2d",this._visualElementSymbols={outline:e.activeLineSymbol??nh,regularVertices:e.regularVerticesSymbol??ih,activeVertex:e.activeVertexSymbol??sh,fill:e.activeFillSymbol},e.activeVertexSymbol||this.addHandles(U(()=>{var t,i;return(i=(t=this.view)==null?void 0:t.effectiveTheme)==null?void 0:i.accentColor},t=>{var s;if(!t)return;const i=this._visualElementSymbols.activeVertex.clone().set({color:t});(s=this._visualElementGraphics.activeVertex)==null||s.set("symbol",i),this._visualElementSymbols={...this._visualElementSymbols,activeVertex:i}},rs))}normalizeCtorArgs(e){const t={...e};return delete t.activeFillSymbol,delete t.activeVertexSymbol,delete t.regularVerticesSymbol,delete t.activeLineSymbol,t}initializeGraphic(e){return this._visualElementSymbols.fill!=null&&(e.symbol=this._visualElementSymbols.fill),this.internalGraphicsLayer.graphics.sort(Kn),B()}makeDrawOperation(){const{defaultZ:e,hasZ:t,view:i}=this;return this._createOrUpdateGraphic(null),new T({view:i,manipulators:this.manipulators,geometryType:Rf(this.geometryType),drawingMode:this.mode,hasZ:t,defaultZ:e,snapToSceneEnabled:this.snapToScene,drawSurface:new lg(i,t,e),hasM:!1,snappingManager:this.snappingManager,snappingVisualizer:new eh(this.internalGraphicsLayer),graphic:this.graphic,cursor:this.cursor,constraintsEnabled:!0})}onActiveVertexChanged(e){if(this.geometryType==="point")return B();const[t,i]=e,s=new C({x:t,y:i,spatialReference:this.view.spatialReference});return this._visualElementGraphics.activeVertex!=null?(this._visualElementGraphics.activeVertex.geometry=s,B()):(this._visualElementGraphics.activeVertex=new Oe({geometry:s,symbol:this._visualElementSymbols.activeVertex,attributes:{displayOrder:2}}),this.internalGraphicsLayer.add(this._visualElementGraphics.activeVertex),this.internalGraphicsLayer.graphics.sort(Kn),B(()=>{this._visualElementGraphics.activeVertex!=null&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.activeVertex),this._visualElementGraphics.activeVertex=pe(this._visualElementGraphics.activeVertex))}))}onCursorEdgeChanged(e){return this._visualElementGraphics.activeEdge!=null?(this._visualElementGraphics.activeEdge.geometry=e,B()):(this._visualElementGraphics.activeEdge=new Oe({geometry:e,symbol:this._visualElementSymbols.outline,attributes:{displayOrder:0}}),this.internalGraphicsLayer.add(this._visualElementGraphics.activeEdge),this.internalGraphicsLayer.graphics.sort(Kn),B(()=>{this._visualElementGraphics.activeEdge!=null&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.activeEdge),this._visualElementGraphics.activeEdge=pe(this._visualElementGraphics.activeEdge))}))}onRegularVerticesChanged(e){const t=new Ro({points:e,spatialReference:this.view.spatialReference});return this._visualElementGraphics.regularVertices!=null?(this._visualElementGraphics.regularVertices.geometry=t,B()):(this._visualElementGraphics.regularVertices=new Oe({geometry:t,symbol:this._visualElementSymbols.regularVertices,attributes:{displayOrder:1}}),this.internalGraphicsLayer.add(this._visualElementGraphics.regularVertices),this.internalGraphicsLayer.graphics.sort(Kn),B(()=>{this._visualElementGraphics.regularVertices!=null&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.regularVertices),this._visualElementGraphics.regularVertices=pe(this._visualElementGraphics.regularVertices))}))}};function Kn(n,e){var t,i;return(((t=n.attributes)==null?void 0:t.displayOrder)??-1/0)-(((i=e.attributes)==null?void 0:i.displayOrder)??-1/0)}a([u()],ln.prototype,"activeFillSymbol",void 0),a([u({readOnly:!0})],ln.prototype,"type",void 0),a([u({constructOnly:!0,nonNullable:!0})],ln.prototype,"view",void 0),ln=a([x("esri.views.2d.interactive.editingTools.draw.DrawGraphicTool2D")],ln);let $r=class{get hovering(){return this.someManipulator(e=>e.hovering)}get grabbing(){return this.someManipulator(e=>e.grabbing)}get dragging(){return this.someManipulator(e=>e.dragging)}hasManipulator(e){return this.someManipulator(t=>t===e)}someManipulator(e){let t=!1;return this.forEachManipulator(i=>{!t&&e(i)&&(t=!0)}),t}};var Mn;(function(n){n[n.TRANSLATE_XY=0]="TRANSLATE_XY",n[n.SCALE=1]="SCALE",n[n.ROTATE=2]="ROTATE"})(Mn||(Mn={}));function kl(n){let e=0,t=0,i=0;return n?(n.type==="cim"&&n.data.symbol&&"symbolLayers"in n.data.symbol&&n.data.symbol.symbolLayers&&n.data.symbol.symbolLayers.map(s=>{s.type==="CIMVectorMarker"&&s.anchorPoint&&(Math.abs(s.anchorPoint.x)>e&&(e=s.anchorPoint.x),Math.abs(s.anchorPoint.y)>t&&(t=s.anchorPoint.y),s.size!=null&&s.size>i&&(i=s.size))}),e=Gt(e),t=Gt(t),i=Gt(i),{offsetX:e,offsetY:t,size:i}):{offsetX:e,offsetY:t,size:i}}let Y=class extends te{set graphic(e){this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()}get elevationInfo(){const{layer:e}=this.graphic,t=e&&"elevationInfo"in e?e.elevationInfo:null,i=ou(this.graphic),s=t?t.offset:0;return new qc({mode:i,offset:s})}set focusedSymbol(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())}set hovering(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())}set selected(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}constructor(e){super(e),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.consumesClicks=!0,this.events=new kt.EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(e){const t=this.graphic;if(t.visible===!1)return null;const i=t.geometry;if(i==null)return null;const s=this._get("focusedSymbol"),r=s??t.symbol;return this.view.type==="2d"?this._intersectDistance2D(this.view,e,i,r):this._intersectDistance3D(this.view,e,t)}attach(){this.attachSymbolChanged(),this.layer!=null&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this.layer!=null&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=U(()=>{var e;return(e=this.graphic)==null?void 0:e.symbol},e=>{e!=null&&e!==this.focusedSymbol&&e!==this._originalSymbol&&(this._originalSymbol=e,this._focused&&this.focusedSymbol!=null&&(this.graphic.symbol=this.focusedSymbol))},qs)}detachSymbolChanged(){this._graphicSymbolChangedHandle!=null&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}onElevationChange(){}onViewChange(){}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&this.focusedSymbol!=null?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(e,t,i,s){var l,c;if((s=s||Bc(i))==null)return null;const r=1;let o=this._circleCollisionCache;if(i.type==="point"&&s.type==="cim"&&((l=s.data.symbol)==null?void 0:l.type)==="CIMPointSymbol"&&s.data.symbol.symbolLayers){const{offsetX:h,offsetY:d,size:p}=kl(s),_=Or(t,wo),f=p/2,m=e.toScreen(i),y=m.x+h,w=m.y+d;return si(_,[y,w])<f*f?r:null}if(i.type!=="point"||s.type!=="simple-marker")return Zu(t,i,e)?r:null;if(o==null||!o.originalPoint.equals(i)){const h=i,d=e.spatialReference;if(Wc(h.spatialReference,d)){const p=Wt(h,d);o={originalPoint:h.clone(),mapPoint:p,radiusPx:Gt(s.size)},this._circleCollisionCache=o}}if(o!=null){const h=Or(t,wo),d=(c=e.toScreen)==null?void 0:c.call(e,o.mapPoint);if(!d)return null;const p=o.radiusPx,_=d.x+Gt(s.xoffset),f=d.y-Gt(s.yoffset);return si(h,[_,f])<p*p?r:null}return null}_intersectDistance3D(e,t,i){const s=e.toMap(t,{include:[i]});return s&&Fu(s,xo,e.renderSpatialReference)?dt(xo,e.state.camera.eye):null}};a([u({constructOnly:!0,nonNullable:!0})],Y.prototype,"graphic",null),a([u()],Y.prototype,"elevationInfo",null),a([u({constructOnly:!0,nonNullable:!0})],Y.prototype,"view",void 0),a([u({value:null})],Y.prototype,"focusedSymbol",null),a([u({constructOnly:!0})],Y.prototype,"layer",void 0),a([u()],Y.prototype,"interactive",void 0),a([u()],Y.prototype,"selectable",void 0),a([u()],Y.prototype,"grabbable",void 0),a([u({value:!1})],Y.prototype,"grabbing",null),a([u()],Y.prototype,"dragging",void 0),a([u()],Y.prototype,"hovering",null),a([u({value:!1})],Y.prototype,"selected",null),a([u()],Y.prototype,"cursor",void 0),Y=a([x("esri.views.interactive.GraphicManipulator")],Y);const xo=g(),wo=Yc();let Cl=class extends $r{constructor(e){super(),this._view=e.view,this._tool=e.tool,this._graphic=e.graphic,this._manipulator=this._createManipulator(),this.forEachManipulator(t=>this._tool.manipulators.add(t))}destroy(){this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null,this._graphic=null}forEachManipulator(e){e(this._manipulator,Mn.TRANSLATE_XY)}createDragPipeline(e,t){let i=null,s=null,r=0,o=0,l=0;const{offsetX:c,offsetY:h,size:d}=kl(this._graphic.symbol);return Ht(this._manipulator,(p,_)=>{_.next(f=>{if(f.action==="start"){const m=e();i=m.editGeometryOperations,s=m.constraints}return f}).next(wr(this._view)).next(f=>{const{x:m,y,z:w}=f.mapEnd;if(s&&(m+c<s.xmin||y+h-d<s.ymin||m+c>s.xmax||y+h-d>s.ymax))return f;(f.action==="start"||r===0&&o===0&&l===0)&&(r=f.mapStart.x,o=f.mapStart.y,l=f.mapStart.z);const b=m-r,$=y-o,M=w-l;r=m,o=y,l=w;const K=f.action==="start"?I.NEW_STEP:I.ACCUMULATE_STEPS,Q=i.move(b,$,M,K);return t(f,Q),f})})}_createManipulator(){const e=this._view,t=this._graphic;return new Y({view:e,graphic:t,selectable:!0,cursor:"move"})}};const ze={up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",toggleOpacity:"t",shift:"Shift",primaryKey:Do},cg=1,ug=10,$o=new vn("#009af2");let qe=class extends q{constructor(n){super(n),this._isOpacityToggled=!1,this._isModifierActive=!1,this._factor=1,this._initialControlPoints=null,this._graphicsLayer=new js({internal:!0,listMode:"hide",visible:!1,effect:"drop-shadow(0px, 0px, 3px)"}),this._undoStack=[],this._redoStack=[],this._sharedUndoStack=[],this._sharedRedoStack=[],this._highlightHandle=null,this.activeHandle=0,this.type="reshape"}initialize(){this._initialize()}destroy(){const{map:n}=this.view;this._controlPointManipulations.forEach(e=>e.destroy()),this._controlPointEditGeometryOperations.forEach(e=>e.destroy()),n.removeMany([this._graphicsLayer]),this._graphicsLayer.removeAll(),this._graphicsLayer=pe(this._graphicsLayer),this._georeference=null,this._controlPointGraphics=null,this._controlPointManipulations=null,this._graphicsLayer=null,this._controlPointEditGeometryOperations=null,this._undoStack=null,this._redoStack=null,this._initialControlPoints=null,this._sharedUndoStack=null,this._sharedRedoStack=null}get _hasValidSpatialReference(){return zs(this.view.spatialReference)}onActivate(){this.visible=!0}onDeactivate(){this.visible=!1}onShow(){this._graphicsLayer.visible=!0}onHide(){this._graphicsLayer.visible=!1}canUndo(){const n=this._undoStack[this._undoStack.length-1];return n!=null&&this._controlPointEditGeometryOperations[n].canUndo}canRedo(){const n=this._redoStack[this._redoStack.length-1];return n!=null&&this._controlPointEditGeometryOperations[n].canRedo}undo(){if(this._undoStack.length>0){const n=this._undoStack.pop();this._controlPointEditGeometryOperations[n].undo(),this.updateGraphics(),this._redoStack.push(n)}}redo(){if(this._redoStack.length>0){const n=this._redoStack.pop();this._controlPointEditGeometryOperations[n].redo(),this.updateGraphics(),this._undoStack.push(n)}}refresh(){const{mediaElement:n}=this;if(n.georeference==null)return;const e=n.georeference;e.type==="control-points"&&e.coords!=null&&(this._georeference=e,this._georeference.controlPoints.forEach(({mapPoint:t},i)=>{const s=this._controlPointEditGeometryOperations[i],r=s.data.components[0].vertices[0];s.setVertexPosition(r,s.data.coordinateHelper.pointToVector(t))}),this.updateGraphics())}reset(){this._georeference.controlPoints=this._initialControlPoints,this.refresh(),this._sharedUndoStack.length=0,this._sharedRedoStack.length=0}updateGraphics(){const n=this._georeference,e=n.controlPoints,t=e[0].mapPoint.spatialReference,i=this._hasValidSpatialReference;this._georeference.controlPoints=this._controlPointEditGeometryOperations.map((s,r)=>{const o=s.data.geometry;return this._controlPointGraphics[r].geometry=o,{mapPoint:Wt(o,t),sourcePoint:i?e[r].sourcePoint:n.toSource(o)}})}updateActiveHandle(n){if(this.activeHandle===n)return;const e=this._controlPointGraphics[this.activeHandle].symbol.clone();Nr(e,this.view.effectiveTheme.accentColor),this._controlPointGraphics[this.activeHandle].symbol=e;const t=this._controlPointGraphics[n].symbol.clone();Nr(t,$o),this._controlPointGraphics[n].symbol=t,this.activeHandle=n,this.view.surface===document.activeElement&&this.highlightActiveHandle()}async highlightActiveHandle(){this.removeHighlightActiveHandle();const n=await this.view.whenLayerView(this._graphicsLayer);this._highlightHandle=n.highlight(this._controlPointGraphics[this.activeHandle])}removeHighlightActiveHandle(){this._highlightHandle&&this._highlightHandle.remove()}setSharedUndoStack(n){this._sharedUndoStack=n}setSharedRedoStack(n){this._sharedRedoStack=n}async _initialize(){const{view:n,mediaElement:e}=this;if(e.georeference==null)return;const t=e.georeference;t.type==="control-points"&&t.coords!=null&&(this._georeference=t,this._initialControlPoints=this._georeference.controlPoints,n.map.addMany([this._graphicsLayer]),n.focus(),this.visible=!1,this.finishToolCreation(),await this._loadProjectionEngine(),this._controlPointEditGeometryOperations=this._georeference.controlPoints.map(({mapPoint:i})=>xr.fromGeometry(Wt(i,n.spatialReference),wn.Local)),this._controlPointGraphics=this._controlPointEditGeometryOperations.map((i,s)=>new Oe({symbol:new fn({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,colorLocked:!0,anchorPoint:{x:0,y:-15.75},anchorPointUnits:"Absolute",dominantSizeAxis3D:"Y",size:9,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:84.3,ymax:84.3},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[83.2,32.5],[84.3,40.7],[83.8,48.9],[81.7,56.9],[78.1,64.3],[73,70.9],[66.9,76.4],[59.7,80.5],[51.9,83.2],[43.7,84.3],[35.4,83.8],[27.4,81.7],[20,78],[13.4,73],[7.9,66.8],[3.8,59.7],[1.1,51.9],[0,43.7],[.5,35.4],[2.6,27.4],[6.3,20],[11.3,13.4],[17.5,7.9],[24.7,3.8],[32.5,1.1],[39.8,.1],[47.1,.3],[54.3,1.8],[61.1,4.5],[67.4,8.4],[72.9,13.3],[77.4,19.1],[80.9,25.5],[83.2,32.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[255,255,255,255]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[84.3,0],[84.3,84.3],[0,84.3],[0,0]]]}},rotation:0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-11.25},anchorPointUnits:"Absolute",dominantSizeAxis3D:"Y",size:22.5,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:197.7,ymax:294.7},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[98.9,0],[119.4,23.2],[139.4,49.3],[156.8,75.2],[171.2,100.8],[182.4,125.3],[190.6,148.8],[195.7,171.4],[197.7,192.9],[197.7,195.8],[197.7,200.3],[197.6,202.5],[197.5,204.8],[197.3,207.1],[197,209.4],[196.7,211.7],[196.4,214.1],[196,216.4],[195.5,218.7],[195,221.1],[194.4,223.4],[193.7,225.8],[193,228.1],[192.2,230.5],[191.4,232.8],[190.5,235.1],[189.5,237.5],[188.5,239.7],[187.4,242],[186.2,244.3],[185,246.5],[183.7,248.7],[182.4,250.9],[181,253.1],[179.5,255.2],[178,257.3],[176.4,259.4],[174.7,261.4],[173.1,263.3],[171.3,265.3],[169.5,267.2],[167.7,269],[165.8,270.8],[163.9,272.5],[161.9,274.2],[159.9,275.8],[157.8,277.4],[155.7,278.9],[153.6,280.4],[151.4,281.7],[149.2,283.1],[147,284.4],[144.8,285.6],[142.5,286.7],[140.3,287.8],[138,288.8],[135.7,289.8],[133.4,290.7],[131,291.5],[128.7,292.3],[126.4,293],[124,293.6],[121.7,294.2],[119.4,294.7],[117,295.2],[114.7,295.6],[112.4,296],[110.1,296.3],[107.8,296.5],[105.5,296.7],[103.3,296.8],[101.1,296.9],[98.8,296.9],[83.1,295.7],[67.8,292],[53.3,285.9],[39.9,277.5],[28.1,267.2],[18,255.1],[10,241.5],[4.2,226.9],[.9,211.5],[0,195.8],[.1,192.9],[2.1,171.4],[7.2,148.8],[15.4,125.3],[26.6,100.8],[41,75.2],[58.4,49.3],[78.4,23.2],[98.9,0]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:s===this.activeHandle?$o.toArray():this.view.effectiveTheme.accentColor.toArray()}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[197.7,0],[197.7,294.7],[0,294.7],[0,0]]]}},rotation:0}],haloSize:1,scaleX:1,angleAlignment:"Display",angle:0}}}),geometry:i.data.geometry})),this._graphicsLayer.graphics.addMany([...this._controlPointGraphics]),this._controlPointManipulations=this._controlPointGraphics.map(i=>new Cl({tool:this,view:n,graphic:i})),this.addHandles([...this._controlPointManipulations.map((i,s)=>i.createDragPipeline(this._getInfo.bind(this,s),(r,o)=>{r.action==="start"&&(this._undoStack.push(s),this._redoStack=[],this._sharedUndoStack.push({tool:this,operation:o}),this._sharedRedoStack.length=0),this.updateGraphics()})),U(()=>this.view.scale,()=>this.active?this.updateGraphics():null)]),this._controlPointManipulations.forEach((i,s)=>{const r=o=>{this.addHandles([o.events.on(["click","grab-changed"],l=>this.updateActiveHandle(s))])};i.forEachManipulator(r)}),this.addHandles([n.on("key-down",i=>{n.activeTool===this&&(i.key!==ze.shift||i.repeat||(this._isModifierActive=!0,i.stopPropagation()),i.key!==ze.toggleOpacity||i.repeat||(e.opacity*=this._isOpacityToggled?2:.5,this._isOpacityToggled=!this._isOpacityToggled,i.stopPropagation()),i.key!==ze.primaryKey||i.repeat||(this._factor=ug,i.stopPropagation()),this._isModifierActive&&(i.key===ze.up&&(this._move(0,this._factor),i.stopPropagation()),i.key===ze.down&&(this._move(0,-this._factor),i.stopPropagation()),i.key===ze.left&&(this._move(-this._factor,0),i.stopPropagation()),i.key===ze.right&&(this._move(this._factor,0),i.stopPropagation())))}),n.on("key-up",i=>{n.activeTool===this&&(i.key===ze.shift&&(this._isModifierActive=!1,i.stopPropagation()),i.key===ze.primaryKey&&(this._factor=cg,i.stopPropagation()))})]))}async _loadProjectionEngine(){const n=this._georeference.controlPoints[0].mapPoint;return Yo(n.spatialReference,this.view.spatialReference)}_getInfo(n){return{editGeometryOperations:this._controlPointEditGeometryOperations[n],constraints:this._hasValidSpatialReference?null:{xmin:0,ymin:0,xmax:this._georeference.width,ymax:this._georeference.height}}}_move(n,e){const t=this._controlPointEditGeometryOperations[this.activeHandle].move(n*this.view.resolution,e*this.view.resolution,0,I.NEW_STEP);this._sharedUndoStack.push({tool:this,operation:t}),this._sharedRedoStack.length=0,this.updateGraphics()}};a([u()],qe.prototype,"_hasValidSpatialReference",null),a([u()],qe.prototype,"activeHandle",void 0),a([u({constructOnly:!0,nonNullable:!0})],qe.prototype,"mediaElement",void 0),a([u({readOnly:!0})],qe.prototype,"type",void 0),a([u({constructOnly:!0})],qe.prototype,"view",void 0),qe=a([x("esri.views.2d.interactive.editingTools.ControlPointsTransformTool")],qe);function Rl(n,e){n.action==="start"?e.cursor="grabbing":e.cursor="grab"}class hg{constructor(){this._lastDragEvent=null,this.next=new Pn,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&this._lastDragEvent!=null){const t={...this._lastDragEvent,action:"update"};e&&this._adjustScaleFactors(t),this.next.execute(t)}this._enabled=e}createDragEventPipelineStep(){return this._lastDragEvent=null,e=>(this._lastDragEvent=e.action!=="end"?{...e}:null,this._enabled&&this._adjustScaleFactors(e),e)}_adjustScaleFactors(e){const t=e.direction[0]!==0&&e.direction[1]!==0?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):e.direction[0]===0?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}}let dg=class{constructor(){this._lastDragEvent=null,this.next=new Pn,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&this._lastDragEvent!=null){const t={...this._lastDragEvent,action:"update"};e&&this._adjustRotateAngle(t),this.next.execute(t)}this._enabled=e}createDragEventPipelineStep(){return this._lastDragEvent=null,e=>(this._lastDragEvent=e.action!=="end"?{...e}:null,this._enabled&&this._adjustRotateAngle(e),e)}_adjustRotateAngle(e){const t=Xo(e.rotateAngle);e.rotateAngle=Fo(5*Math.round(t/5))}};function pg(n,e,t,i=!1){const s=Math.atan2(e.y-t.y,e.x-t.x)-Math.atan2(n.y-t.y,n.x-t.x),r=Math.atan2(Math.sin(s),Math.cos(s));return i?r:Xo(r)}function Vl(n,e){return fg(n,e,!1)}function fg(n,e,t){if(n instanceof gl){if(n.operation instanceof vl)return gg(n.operation,e,t),!0;if(n.operation instanceof xl)return mg(n.operation,e,t),!0;if(n.operation instanceof Oi)return yg(n.operation,e,t),!0}return!1}function gg(n,e,t=!1){const i=t?-1:1,s=ht(i*n.dx,i*n.dy,i*n.dz);he(e.origin,e.origin,s),bi(e)}function mg(n,e,t=!1){const i=t?-n.angle:n.angle;Lr(e.basis1,e.basis1,Dr,i),Lr(e.basis2,e.basis2,Dr,i),bi(e)}function yg(n,e,t=!1){const i=t?1/n.factor1:n.factor1,s=t?1/n.factor2:n.factor2;ft(e.basis1,e.basis1,i),ft(e.basis2,e.basis2,s),ri(e.origin,e.origin,n.origin,n.axis1,i),ri(e.origin,e.origin,n.origin,n.axis2,s),bi(e)}function _g(n,e,t,i){i||(i=En());const s=Be(nn.get(),n[1],-n[0]),r=Be(nn.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),o=Be(nn.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),l=nn.get();e.components.forEach(d=>d.vertices.forEach(({pos:p})=>{Be(l,yt(n,p),yt(s,p)),Xc(r,r,l),jc(o,o,l)}));const c=1e-6,h=Be(nn.get(),o[0]-r[0]<c?t/2:0,o[1]-r[1]<c?t/2:0);return X(r,r,h),Hi(o,o,h),Ir(i.basis1,n,(o[0]-r[0])/2),Ir(i.basis2,s,(o[1]-r[1])/2),Be(i.origin,r[0]*n[0]+r[1]*s[0],r[0]*n[1]+r[1]*s[1]),Hi(i.origin,i.origin,i.basis1),Hi(i.origin,i.origin,i.basis2),bi(i),i}class vg extends $r{constructor(e){super(),this._handles=new jo,this._originCache=g(),this._view=e.view,this._tool=e.tool,this._graphic=e.graphic,this._snapRotation=e.snapRotation,this._manipulator=this._createManipulator(),this._handles.add([this._manipulator.events.on("grab-changed",t=>Rl(t,this._manipulator))]),this.forEachManipulator(t=>this._tool.manipulators.add(t))}destroy(){this._handles.destroy(),this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null,this._snapRotation=null,this._graphic=null,this._handles=null,this._originCache=null}forEachManipulator(e){e(this._manipulator,Mn.ROTATE)}createDragPipeline(e,t){let i=null,s=null;return Ht(this._manipulator,(r,o)=>{o.next(l=>{if(l.action==="start"){r.cursor="grabbing";const c=e();i=c.plane,s=c.editGeometryOperations}return l}).next(wr(this._view)).next(l=>({...l,rotateAngle:pg(l.mapStart,l.mapEnd,{x:i.origin[0],y:i.origin[1]},!0)})).next(this._snapRotation.createDragEventPipelineStep(),this._snapRotation.next).next(l=>{const c=oe(this._originCache,i.origin),h=l.action==="start"?I.NEW_STEP:I.ACCUMULATE_STEPS,d=s.rotate(c,l.rotateAngle,h,ie.REPLACE);return Vl(d,i),t(l,d),l}).next(l=>(l.action==="end"&&(r.cursor="grab"),l))})}_createManipulator(){const e=this._view,t=this._graphic;return new Y({view:e,graphic:t,selectable:!0,cursor:"grab"})}}const es=10,To=1e-6,bg=.3;function Eo(n){const e=$n(n.basis1),t=$n(n.basis2);return bg*Math.min(e,t)}class xg extends $r{constructor(e){super(),this._handles=new jo,this._planeStart=En(),this._displayPlaneStart=En(),this._originCache=g(),this._axisCache=L(),this._renderStartCache=g(),this._renderEndCache=g(),this._resizeOriginCache=g(),this._view=e.view,this._tool=e.tool,this._graphic=e.graphic,this._direction=e.direction,this._preserveAspectRatio=e.preserveAspectRatio,this._manipulator=this._createManipulator(),this._handles.add([this._manipulator.events.on("grab-changed",t=>Rl(t,this._manipulator))]),this.forEachManipulator(t=>this._tool.manipulators.add(t))}destroy(){this._handles.destroy(),this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._graphic=null,this._manipulator=null,this._direction=null,this._handles=null,this._planeStart=null,this._displayPlaneStart=null,this._originCache=null,this._axisCache=null,this._renderStartCache=null,this._renderEndCache=null,this._resizeOriginCache=null,this._preserveAspectRatio=null}forEachManipulator(e){e(this._manipulator,Mn.SCALE)}createDragPipeline(e,t){let i=null,s=null,r=null,o=0,l=null,c=null;const h=this._planeStart,d=this._displayPlaneStart,p=this._direction;return Ht(this._manipulator,(_,f)=>{f.next(m=>{if(m.action==="start"){_.cursor="grabbing";const y=e();i=y.plane,s=y.displayPlane,r=y.editGeometryOperations,o=es*this._view.resolution,Jn(i,h),Jn(s,d);const w=No(r.data.spatialReference);l=w?w.valid[1]-w.valid[0]-3*es*this._view.resolution:null}return m}).next(wr(this._view)).next(m=>{const y=oe(this._renderStartCache,[m.mapStart.x,m.mapStart.y,0]),w=oe(this._renderEndCache,[m.mapEnd.x,m.mapEnd.y,0]),b=oe(this._resizeOriginCache,d.origin);G(b,b,d.basis1,-p[0]),G(b,b,d.basis2,-p[1]),Te(w,w,b),Te(y,y,b);const $=p[0]!==0&&p[1]!==0,M=Eo(d),K=Eo(s)/M,Q=(le,tn)=>{if(le===0)return 1;let Ge=$n(tn),nt=.5*le*Z(tn,w)/Ge;const xt=nt<0?-1:1;$&&(nt+=(Ge-.5*le*Z(tn,y)/Ge)*xt*K);const Ii=Ge<1.5*o?1:To;return Ge=Math.max(Ge-o,To),xt>0&&(nt-=es*this._view.resolution),xt*Math.max(xt*(nt/Ge),Ii)},W=Q(p[0],d.basis1),ge=Q(p[1],d.basis2);return{...m,direction:p,factor1:W,factor2:ge}}).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next(m=>{const y=oe(this._originCache,h.origin);G(y,y,h.basis1,-p[0]),G(y,y,h.basis2,-p[1]);const w=Be(this._axisCache,h.basis1[0],h.basis1[1]);Ys(w,w);const b=r.data.allVertices,$=m.action==="start"?I.NEW_STEP:I.ACCUMULATE_STEPS,M=r.scaleVertices(b,y,w,m.factor1,m.factor2,$,ie.REPLACE);return l&&l<r.data.geometry.extent.width&&c?r.updateVertices(b,c):(Jn(h,i),Vl(M,i),c=M.operation,t(m,M)),m}).next(m=>(m.action==="end"&&(_.cursor="grab"),m))})}_createManipulator(){return new Y({view:this._view,graphic:this._graphic,selectable:!0,cursor:"grab"})}}function wg(n){return(n==null?void 0:n.type)==="graphic"}function $g(n){return n.find(wg)??null}const Tg=80,Eg=10,Sg=30,Pg=[[1,1],[1,-1],[-1,-1],[-1,1],[1,0],[0,-1],[-1,0],[0,1]],So=1,Mg=10;let _e=class extends q{constructor(n){super(n),this._initialControlPoints=null,this._initialGeometry=null,this._graphic=null,this._planeCache=En(),this._displayPlaneCache=En(),this._mainAxisCache=L(),this._rotationHandleCache=g(),this._cornerA=g(),this._cornerB=g(),this._cornerC=g(),this._cornerD=g(),this._avgAB=g(),this._avgBC=g(),this._avgCD=g(),this._avgDA=g(),this._preserveAspectRatio=new hg,this._snapRotation=new dg,this._graphicsLayer=new js({internal:!0,listMode:"hide",visible:!1}),this._sharedUndoStack=[],this._sharedRedoStack=[],this._isOpacityToggled=!1,this._factor=So,this.preserveAspectRatio=null,this.snapRotation=null,this.type="transform"}initialize(){this._initialize()}destroy(){const{map:n}=this.view;this._dragManipulation.destroy(),this._rotateManipulation.destroy(),this._scaleManipulations.forEach(e=>e.destroy()),this._editGeometryOperations.destroy(),n.removeMany([this._graphicsLayer]),this._graphicsLayer.removeAll(),this._graphicsLayer=pe(this._graphicsLayer),this._initialControlPoints=null,this._initialGeometry=null,this._graphic=null,this._preserveAspectRatio=null,this._snapRotation=null,this._planeCache=null,this._displayPlaneCache=null,this._rotationHandleCache=null,this._mainAxisCache=null,this._cornerA=null,this._cornerB=null,this._cornerC=null,this._cornerD=null,this._avgAB=null,this._avgBC=null,this._avgCD=null,this._avgDA=null,this._sharedUndoStack=null,this._sharedRedoStack=null}get _plane(){const n=this._graphic.geometry;if(n==null)return null;const e=this._editGeometryOperations.data,t=e.components[0].edges[0],i=X(this._mainAxisCache,t.leftVertex.pos,t.rightVertex.pos);Ys(i,i);let s=Tg*this.view.resolution;const r=this.view.spatialReference;return Qt(r,n.spatialReference)&&(s*=bn(r)/bn(n.spatialReference)),_g(i,e,s,this._planeCache)}get _displayPlane(){const n=this._plane;if(!n)return null;const e=this._displayPlaneCache;Jn(n,e);const t=Eg*this.view.resolution;return ft(e.basis1,e.basis1,1+t/$n(e.basis1)),ft(e.basis2,e.basis2,1+t/$n(e.basis2)),e}get _backgroundGraphicGeometry(){const n=this._displayPlane;if(!n)return null;const e=this.view.spatialReference;return this._updateDisplayPlaneConrers(n),new Dt({spatialReference:e,rings:[[this._cornerA,this._cornerB,this._cornerC,this._cornerD,this._cornerA]]})}get _rotateGraphicGeometry(){const n=this._plane;if(!n)return null;const e=this._rotationHandleCache;return lt(e,n.basis1),ft(e,e,Sg*this.view.resolution),he(e,e,n.origin),he(e,e,n.basis1),new C({x:e[0],y:e[1],spatialReference:this.view.spatialReference})}get _scaleGraphicGeometries(){const n=this._displayPlane;if(!n)return[];const e=this.view.spatialReference;this._updateDisplayPlaneConrers(n);const{_cornerA:t,_cornerB:i,_cornerC:s,_cornerD:r}=this,o=St(this._avgAB,t,i,.5),l=St(this._avgBC,i,s,.5),c=St(this._avgCD,s,r,.5),h=St(this._avgDA,r,t,.5);return[new C({x:t[0],y:t[1],spatialReference:e}),new C({x:i[0],y:i[1],spatialReference:e}),new C({x:s[0],y:s[1],spatialReference:e}),new C({x:r[0],y:r[1],spatialReference:e}),new C({x:o[0],y:o[1],spatialReference:e}),new C({x:l[0],y:l[1],spatialReference:e}),new C({x:c[0],y:c[1],spatialReference:e}),new C({x:h[0],y:h[1],spatialReference:e})]}onActivate(){this.visible=!0}onDeactivate(){this.visible=!1}onShow(){this._graphicsLayer.visible=!0}onHide(){this._graphicsLayer.visible=!1}canUndo(){return this._editGeometryOperations.canUndo}canRedo(){return this._editGeometryOperations.canRedo}undo(){this._editGeometryOperations.undo(),this.updateGraphics()}redo(){this._editGeometryOperations.redo(),this.updateGraphics()}refresh(){const{view:n,target:e}=this,t="georeference"in e?e.georeference.coords:e.geometry,i=this._editGeometryOperations,s=i.data.components[0].vertices,r=pi.fromGeometry(Wt(t,n.spatialReference),wn.Local).components[0].vertices;s.forEach((o,l)=>{i.setVertexPosition(o,r[l].pos)}),this.updateGraphics()}reset(){const{target:n}=this;if("georeference"in n){const e=n.georeference;e.type==="control-points"&&(e.controlPoints=this._initialControlPoints)}else n.geometry=this._initialGeometry;this.refresh(),this._sharedUndoStack.length=0,this._sharedRedoStack.length=0}updateGraphics(){const n=this._editGeometryOperations.data.geometry;"georeference"in this.target&&(this.target.georeference.coords=n),this._graphic.geometry=n,this._backgroundGraphic.geometry=this._backgroundGraphicGeometry,this._rotateGraphic.geometry=this._rotateGraphicGeometry,this._scaleGraphicGeometries.forEach((e,t)=>{this._scaleGraphics[t].geometry=e})}setSharedUndoStack(n){this._sharedUndoStack=n}setSharedRedoStack(n){this._sharedRedoStack=n}async _initialize(){const{view:n,target:e}=this;if("georeference"in e){const s=e.georeference;this._graphic=new Oe({geometry:s.coords}),this._initialControlPoints=s.type==="control-points"?s.controlPoints:null}else this._graphic=e,this._initialGeometry=e.geometry;n.map.addMany([this._graphicsLayer]),n.focus(),this.visible=!1,this.finishToolCreation(),await this._loadProjectionEngine(),this._editGeometryOperations=xr.fromGeometry(Wt(this._graphic.geometry,n.spatialReference),wn.Local),this._backgroundGraphic=new Oe({symbol:new Kc({color:"transparent",outline:{type:"simple-line",color:n.effectiveTheme.accentColor,width:2}}),geometry:this._backgroundGraphicGeometry}),this._rotateGraphic=new Oe({symbol:new Nt({color:Gr(n.effectiveTheme.accentColor),outline:{type:"simple-line",color:n.effectiveTheme.accentColor,width:1}}),geometry:this._rotateGraphicGeometry}),this._scaleGraphics=this._scaleGraphicGeometries.map(s=>new Oe({symbol:new Nt({size:6,style:"square",color:Gr(n.effectiveTheme.accentColor),outline:{type:"simple-line",color:n.effectiveTheme.accentColor,width:1}}),geometry:s})),this._graphicsLayer.graphics.addMany([this._backgroundGraphic,this._rotateGraphic,...this._scaleGraphics]),this._dragManipulation=new Cl({tool:this,view:n,graphic:this._graphic}),this._rotateManipulation=new vg({tool:this,view:n,graphic:this._rotateGraphic,snapRotation:this._snapRotation}),this._scaleManipulations=this._scaleGraphics.map((s,r)=>new xg({tool:this,view:n,graphic:s,direction:Pg[r],preserveAspectRatio:this._preserveAspectRatio})),this.addHandles([this._dragManipulation.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this)),this._rotateManipulation.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this)),...this._scaleManipulations.map(s=>s.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this))),U(()=>this.view.scale,()=>this.active?this.updateGraphics():null),n.on("click",async s=>{if(n.activeTool!=null&&n.activeTool!==this)return;const r=Qc(s),o=[];n.map.allLayers.forEach(h=>{h.type!=="vector-tile"&&h.type!=="imagery"||o.push(h)});const l=await this.view.hitTest(r,{exclude:o}),c=l.results;if(c.length===0)n.activeTool=null;else{const h=$g(l.results),d="georeference"in e,p=c.map(f=>f.type==="media"?f.element:null).filter(Boolean),_=new Set([...this._graphicsLayer.graphics,d?null:e].filter(Boolean));d&&p.includes(e)||h!=null&&_.has(h.graphic)?n.activeTool==null&&(n.activeTool=this):n.activeTool=null}})]);const t=s=>{this.addHandles(s.events.on("grab-changed",r=>{"georeference"in e&&(r.action==="start"?e.opacity*=.5:r.action==="end"&&(e.opacity*=2))}))};this._dragManipulation.forEachManipulator(t),this._rotateManipulation.forEachManipulator(t),this._scaleManipulations.forEach(s=>s.forEachManipulator(t));const i=new Ed;i.addToggle(Me.preserveAspectRatio,()=>{this.preserveAspectRatio==null&&(this._preserveAspectRatio.enabled=!this._preserveAspectRatio.enabled)}),i.addToggle(Me.rotateIncrements,()=>{this.snapRotation==null&&(this._snapRotation.enabled=!this._snapRotation.enabled)}),i.add(Me.toggleOpacity,()=>{"georeference"in e&&(e.opacity*=this._isOpacityToggled?2:.5,this._isOpacityToggled=!this._isOpacityToggled)}),i.addToggle(Me.factorModifier,s=>this._factor=s.type==="key-down"?Mg:So),i.add(Me.scaleUp,()=>this._scale(this._factor)),i.add(Me.scaleDown,()=>this._scale(-this._factor)),i.add(Me.moveUp,()=>this._move(0,this._factor)),i.add(Me.moveDown,()=>this._move(0,-this._factor)),i.add(Me.moveLeft,()=>this._move(-this._factor,0)),i.add(Me.moveRight,()=>this._move(this._factor,0)),this.addHandles([n.on("key-down",s=>{n.activeTool===this&&i.dispatch(n.inputManager,s)}),n.on("key-up",s=>{n.activeTool===this&&i.dispatch(n.inputManager,s)})])}async _loadProjectionEngine(){const n=this._graphic.geometry;return Yo(n.spatialReference,this.view.spatialReference)}_updateDisplayPlaneConrers(n){const{basis1:e,basis2:t,origin:i}=n,s=this._cornerA;he(s,i,e),he(s,s,t);const r=this._cornerB;he(r,i,e),Te(r,r,t);const o=this._cornerC;Te(o,i,e),Te(o,o,t);const l=this._cornerD;Te(l,i,e),he(l,l,t)}_getInfo(){return{editGeometryOperations:this._editGeometryOperations,plane:this._plane,displayPlane:this._displayPlane}}_updateGraphics(n,e){n.action==="start"&&(this._sharedUndoStack.push({tool:this,operation:e}),this._sharedRedoStack.length=0),this.updateGraphics()}_scale(n){var r;const e=this._editGeometryOperations,t=(r=e.data.geometry.extent)==null?void 0:r.width,i=(t+n*this.view.resolution)/t,s=e.scale(this._plane.origin,Jc,i,i,I.NEW_STEP,ie.REPLACE);this._sharedUndoStack.push({tool:this,operation:s}),this._sharedRedoStack.length=0,this.updateGraphics()}_move(n,e){const t=this._editGeometryOperations.move(n*this.view.resolution,e*this.view.resolution,0,I.NEW_STEP);this._sharedUndoStack.push({tool:this,operation:t}),this._sharedRedoStack.length=0,this.updateGraphics()}};a([u()],_e.prototype,"_plane",null),a([u()],_e.prototype,"_backgroundGraphicGeometry",null),a([u()],_e.prototype,"_rotateGraphicGeometry",null),a([u()],_e.prototype,"_scaleGraphicGeometries",null),a([u()],_e.prototype,"preserveAspectRatio",void 0),a([u()],_e.prototype,"snapRotation",void 0),a([u({constructOnly:!0,nonNullable:!0})],_e.prototype,"target",void 0),a([u({readOnly:!0})],_e.prototype,"type",void 0),a([u({constructOnly:!0})],_e.prototype,"view",void 0),_e=a([x("esri.views.2d.interactive.editingTools.TransformTool")],_e);const Qn={redo:"r",undo:"z"};let it=class extends te{constructor(n){super(n),this._transformTool=null,this._controlPointsTransformTool=null,this._advancedModeTransformTool=null,this._activeTool=null,this._sharedUndoStack=[],this._sharedRedoStack=[],this._originalOpacity=null,this.activeHandle=0}initialize(){const{view:n,mediaElement:e,preserveAspectRatio:t,snapRotation:i,advancedMode:s}=this;this._originalOpacity=e.opacity,this._transformTool=new _e({target:e,view:n,preserveAspectRatio:t,snapRotation:i}),this._controlPointsTransformTool=new qe({mediaElement:e,view:n}),this._advancedModeTransformTool=new qe({mediaElement:s.mediaElement,view:s.view}),this._transformTool.setSharedUndoStack(this._sharedUndoStack),this._transformTool.setSharedRedoStack(this._sharedRedoStack),this._controlPointsTransformTool.setSharedUndoStack(this._sharedUndoStack),this._controlPointsTransformTool.setSharedRedoStack(this._sharedRedoStack),this._advancedModeTransformTool.setSharedUndoStack(this._sharedUndoStack),this._advancedModeTransformTool.setSharedRedoStack(this._sharedRedoStack);const r=e.georeference,o=s.mediaElement.georeference;s.view.tools.addMany([this._advancedModeTransformTool]),"controlPoints"in o&&"controlPoints"in r&&this.addHandles([s.view.on("key-down",l=>{l.key===Qn.undo&&this.canUndo()&&(this.undo(),l.stopPropagation()),l.key===Qn.redo&&this.canRedo()&&(this.redo(),l.stopPropagation())}),s.view.on("focus",async l=>{this._controlPointsTransformTool.removeHighlightActiveHandle(),this._advancedModeTransformTool.highlightActiveHandle()}),U(()=>o.controlPoints,l=>{var c;r.controlPoints=l.map(({sourcePoint:h},d)=>({sourcePoint:h,mapPoint:r.controlPoints[d].mapPoint})),(c=this._activeTool)==null||c.refresh()}),U(()=>this._controlPointsTransformTool.activeHandle,l=>{this._advancedModeTransformTool.updateActiveHandle(l),this.activeHandle=l}),U(()=>this._advancedModeTransformTool.activeHandle,l=>{this._controlPointsTransformTool.updateActiveHandle(l),this.activeHandle=l})]),this.addHandles([n.on("key-down",l=>{l.key===Qn.undo&&this.canUndo()&&(this.undo(),l.stopPropagation()),l.key===Qn.redo&&this.canRedo()&&(this.redo(),l.stopPropagation())}),n.on("focus",async l=>{this._advancedModeTransformTool.removeHighlightActiveHandle(),this._controlPointsTransformTool.highlightActiveHandle()})]),n.tools.addMany([this._transformTool,this._controlPointsTransformTool]),n.activeTool=this._transformTool,this._activeTool=this._transformTool,n.focus()}destroy(){var n,e;(n=this._transformTool)==null||n.destroy(),(e=this._controlPointsTransformTool)==null||e.destroy(),this._transformTool=null,this._controlPointsTransformTool=null,this._advancedModeTransformTool=null,this._activeTool=null,this._sharedUndoStack=null,this._sharedRedoStack=null}canUndo(){return this._sharedUndoStack.length>0}canRedo(){return this._sharedRedoStack.length>0}undo(){var n;if(this._sharedUndoStack.length>0){const{tool:e,operation:t}=this._sharedUndoStack.pop();e!==this._activeTool&&e.refresh(),t.undo(),e.updateGraphics(),this._sharedRedoStack.push({tool:e,operation:t}),this._activeTool!==e&&((n=this._activeTool)==null||n.refresh())}}redo(){var n;if(this._sharedRedoStack.length>0){const{tool:e,operation:t}=this._sharedRedoStack.pop();e!==this._activeTool&&e.refresh(),t.apply(),e.updateGraphics(),this._sharedUndoStack.push({tool:e,operation:t}),this._activeTool!==e&&((n=this._activeTool)==null||n.refresh())}}refresh(){this._activeTool.refresh()}reset(){this._activeTool.reset(),this._advancedModeTransformTool.reset()}async enableAdvancedMode(){this.view.activeTool=this._controlPointsTransformTool,this._activeTool=this._controlPointsTransformTool,this._activeTool.refresh(),await this.advancedMode.view.when(),this.advancedMode.view.activeTool=this._advancedModeTransformTool,this._originalOpacity=this._controlPointsTransformTool.mediaElement.opacity,this._controlPointsTransformTool.mediaElement.opacity=.25*this._originalOpacity}disableAdvancedMode(){this.view.activeTool=this._transformTool,this._activeTool=this._transformTool,this._activeTool.refresh(),this.advancedMode.view.activeTool=null,this._controlPointsTransformTool.mediaElement.opacity=this._originalOpacity}};a([u()],it.prototype,"activeHandle",void 0),a([u({constructOnly:!0})],it.prototype,"advancedMode",void 0),a([u()],it.prototype,"preserveAspectRatio",void 0),a([u()],it.prototype,"snapRotation",void 0),a([u({constructOnly:!0,nonNullable:!0})],it.prototype,"mediaElement",void 0),a([u({constructOnly:!0})],it.prototype,"view",void 0),it=a([x("esri.views.2d.interactive.editingTools.MediaTransformToolsWrapper")],it);export{qe as ControlPointsTransformTool,ln as DrawGraphicTool2D,it as MediaTransformToolsWrapper,_e as TransformTool};
