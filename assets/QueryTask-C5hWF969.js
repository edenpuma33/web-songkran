const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/meshFeatureSet-CBkM6qpl.js","assets/index-CorgkmYx.js","assets/index-CxdEf2vt.css","assets/Mesh-Cdpkv-Ll.js","assets/MeshTransform-Dz9M0eog.js","assets/mat4f64-CSKppSlJ.js","assets/quat-DBd2Nb1m.js","assets/mat3f64-q3fE-ZOt.js","assets/quatf64-aQ5IuZRd.js","assets/MeshVertexAttributes-bH-5vyf6.js","assets/MeshLocalVertexSpace-DAVvI3Z3.js","assets/meshVertexSpaceUtils-Cu1f-oO7.js","assets/earcut-D9gy186-.js","assets/Indices-D7gOIxSf.js","assets/plane-BzYZw24a.js","assets/deduplicate-C42Xb_29.js","assets/projectPointToVector-BSiCSeaS.js","assets/vertexSpaceConversion-BdhAJlfF.js","assets/spatialReferenceEllipsoidUtils-r_S_8DDe.js","assets/computeTranslationToOriginAndRotation-BhJmC_0D.js","assets/vec3-BwzP2Z1Q.js","assets/BufferView-BTSIaNVu.js","assets/vec4-CHTwQPOE.js","assets/External-B2AdFcDo.js","assets/infoFor3D-CxdEiWhp.js","assets/meshFeatureAttributes-MaZGyMCR.js","assets/executeRelationshipQuery-DbNld9f7.js","assets/query-fkZb4bFq.js","assets/pbfQueryUtils-RHZKJNMG.js","assets/pbf-C4M-aU-3.js","assets/OptimizedFeature-D3320lj0.js","assets/OptimizedFeatureSet-Blu9Ckm7.js","assets/queryAttachments-BszGY8OC.js","assets/AttachmentInfo-C4udtiBe.js","assets/executeBinsQuery-DIPCkKc2.js","assets/BinsQuery-qJkUAZxr.js","assets/queryUtils-CwRl2kBy.js","assets/json-BLezgqVO.js","assets/executeTopFeaturesQuery-Df-V_Sh8.js","assets/queryTopFeatures-D-tUG_Nu.js","assets/TopFeaturesQuery-9AVetbFH.js","assets/executeForTopIds-CCvByc37.js","assets/executeForTopExtents-Cm6zBCL_.js","assets/executeForTopCount-DpGx4L-U.js"])))=>i.map(i=>d[i]);
import{A as m,bl as _,y as A,i5 as I,aP as w,cG as G,I as E,b5 as L,a6 as Q,j1 as l,_ as a,iO as x,s as g,a as $,r as c,t as d,x as q}from"./index-CorgkmYx.js";import{a as v,d as N}from"./infoFor3D-CxdEiWhp.js";import{s as M,a as j}from"./executeForIds-BRsfqoki.js";import{x as Z,f as k}from"./query-fkZb4bFq.js";import{a as B}from"./executeQueryJSON-B6U6tpXU.js";import{p as z,r as J}from"./featureConversionUtils-CW0ryXfc.js";async function U(r,e,t){const s=m(r),o=await Z(s,_.from(e),{...t}),i=o.data.extent;return!i||isNaN(i.xmin)||isNaN(i.ymin)||isNaN(i.xmax)||isNaN(i.ymax)?{count:o.data.count,extent:null}:{count:o.data.count,extent:A.fromJSON(i)}}function X(r,e){return e}function y(r,e,t,s){switch(t){case 0:return f(r,e+s,0);case 1:return r.originPosition==="lowerLeft"?f(r,e+s,1):H(r,e+s,1)}}function D(r,e,t,s){return t===2?f(r,e,2):y(r,e,t,s)}function Y(r,e,t,s){return t===2?e===0?0:f(r,e,3):y(r,e,t,s)}function K(r,e,t,s){return t===3?e===0?0:f(r,e,3):D(r,e,t,s)}function f({translate:r,scale:e},t,s){return r[s]+t*e[s]}function H({translate:r,scale:e},t,s){return r[s]-t*e[s]}class W{constructor(e){this._options=e,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this._previousCoordinate=[0,0],this._transform=null,this._applyTransform=X,this._lengths=[],this._currentLengthIndex=0,this._toAddInCurrentPath=0,this._vertexDimension=0,this._mValueOffset=null,this._coordinateBuffer=null,this._coordinateBufferPtr=0,this._attributesConstructor=class{}}createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(e){if(this._options.applyTransform&&(e.transform=null),this._attributesConstructor=class{},this._coordinateBuffer=null,this._lengths.length=0,!e.hasZ)return;const t=I(e.geometryType,this._options.sourceSpatialReference,e.spatialReference);if(t!=null)for(const s of e.features)t(s.geometry)}createSpatialReference(){return{}}addField(e,t){const s=e.fields;w(s),s.push(t);const o=s.map(i=>i.name);this._attributesConstructor=function(){for(const i of o)this[i]=null}}addFeature(e,t){e.features.push(t)}prepareFeatures(e){switch(this._transform=e.transform,this._options.applyTransform&&e.transform&&(this._applyTransform=this._deriveApplyTransform(e)),this._mValueOffset=null,this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&(this._mValueOffset=this._vertexDimension,this._vertexDimension++),e.geometryType){case"esriGeometryPoint":this.addCoordinate=(t,s,o)=>this.addCoordinatePoint(t,s,o),this.createGeometry=t=>this.createPointGeometry(t);break;case"esriGeometryPolygon":this.addCoordinate=(t,s,o)=>this._addCoordinatePolygon(t,s,o),this.createGeometry=t=>this._createPolygonGeometry(t);break;case"esriGeometryPolyline":this.addCoordinate=(t,s,o)=>this._addCoordinatePolyline(t,s,o),this.createGeometry=t=>this._createPolylineGeometry(t);break;case"esriGeometryMultipoint":this.addCoordinate=(t,s,o)=>this._addCoordinateMultipoint(t,s,o),this.createGeometry=t=>this._createMultipointGeometry(t)}}createFeature(){return this._lengths.length=0,this._currentLengthIndex=0,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,{attributes:new this._attributesConstructor}}allocateCoordinates(){}addLength(e,t,s){this._lengths.length===0&&(this._toAddInCurrentPath=t),this._lengths.push(t)}addQueryGeometry(e,t){const{queryGeometry:s,queryGeometryType:o}=t,i=z(s.clone(),s,!1,!1,this._transform),u=J(i,o,!1,!1);e.queryGeometryType=o,e.queryGeometry={...u}}createPointGeometry(e){const t={x:0,y:0,spatialReference:e.spatialReference};return e.hasZ&&(t.z=0),e.hasM&&(t.m=0),t}addCoordinatePoint(e,t,s){const o=this._transform;switch(t=this._applyTransform(o,t,s,0),s){case 0:e.x=t;break;case 1:e.y=t;break;case 2:"z"in e?e.z=t:e.m=t;break;case 3:e.m=t}}_transformPathLikeValue(e,t){let s=0;t<=1&&(s=this._previousCoordinate[t],this._previousCoordinate[t]+=e);const o=this._transform;return this._mValueOffset!==null&&e===0&&t>0&&!(t%this._mValueOffset)?0:this._applyTransform(o,e,t,s)}_addCoordinatePolyline(e,t,s){this._dehydratedAddPointsCoordinate(e.paths,t,s)}_addCoordinatePolygon(e,t,s){this._dehydratedAddPointsCoordinate(e.rings,t,s)}_addCoordinateMultipoint(e,t,s){s===0&&e.points.push([]);const o=this._transformPathLikeValue(t,s);e.points[e.points.length-1].push(o)}_createPolygonGeometry(e){return{rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_createPolylineGeometry(e){return{paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_createMultipointGeometry(e){return{points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_dehydratedAddPointsCoordinate(e,t,s){s===0&&this._toAddInCurrentPath--==0&&(e.push([]),this._toAddInCurrentPath=this._lengths[++this._currentLengthIndex]-1,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0);const o=this._transformPathLikeValue(t,s),i=e[e.length-1];s===0&&(this._coordinateBufferPtr=0,this._coordinateBuffer=new Array(this._vertexDimension),i.push(this._coordinateBuffer)),this._coordinateBuffer[this._coordinateBufferPtr++]=o}_deriveApplyTransform(e){const{hasZ:t,hasM:s}=e;return t&&s?K:t?D:s?Y:y}}async function ee(r,e,t){const s=m(r),o={...t},i=_.from(e),u=!i.quantizationParameters,{data:h}=await k(s,i,new W({sourceSpatialReference:i.sourceSpatialReference,applyTransform:u}),o);return h}let n=class extends G{constructor(r){super(r),this.dynamicDataSource=null,this.fieldsIndex=null,this.gdbVersion=null,this.infoFor3D=null,this.pbfSupported=!1,this.queryAttachmentsSupported=!1,this.sourceSpatialReference=null,this.url=null}get parsedUrl(){return E(this.url)}async execute(r,e){const t=await this.executeJSON(r,e);return this.featureSetFromJSON(r,t,e)}async executeJSON(r,e){var h;const t=this._normalizeQuery(r),s=((h=r.outStatistics)==null?void 0:h[0])!=null,o=L("featurelayer-pbf-statistics"),i=!s||o;let u;if(this.pbfSupported&&i)try{u=await ee(this.url,t,e)}catch(p){if(p.name!=="query:parsing-pbf")throw p;this.pbfSupported=!1}return this.pbfSupported&&i||(u=await B(this.url,t,e)),this._normalizeFields(u.fields),u}async featureSetFromJSON(r,e,t){if(!this._queryIs3DObjectFormat(r)||this.infoFor3D==null||!e.features)return Q.fromJSON(e);const{meshFeatureSetFromJSON:s}=await l(a(()=>import("./meshFeatureSet-CBkM6qpl.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25])),t);return s(r,this.infoFor3D,e)}executeForCount(r,e){return M(this.url,this._normalizeQuery(r),e)}executeForExtent(r,e){return U(this.url,this._normalizeQuery(r),e)}executeForIds(r,e){return j(this.url,this._normalizeQuery(r),e)}async executeRelationshipQuery(r,e){const[{default:t},{executeRelationshipQuery:s}]=await l(Promise.all([a(()=>import("./index-CorgkmYx.js").then(o=>o.rk),__vite__mapDeps([1,2])),a(()=>import("./executeRelationshipQuery-DbNld9f7.js"),__vite__mapDeps([26,1,2,27,28,29,30,31]))]),e);return r=t.from(r),(this.gdbVersion||this.dynamicDataSource)&&((r=r.clone()).gdbVersion=r.gdbVersion||this.gdbVersion,r.dynamicDataSource=r.dynamicDataSource||this.dynamicDataSource),s(this.url,r,e)}async executeRelationshipQueryForCount(r,e){const[{default:t},{executeRelationshipQueryForCount:s}]=await l(Promise.all([a(()=>import("./index-CorgkmYx.js").then(o=>o.rk),__vite__mapDeps([1,2])),a(()=>import("./executeRelationshipQuery-DbNld9f7.js"),__vite__mapDeps([26,1,2,27,28,29,30,31]))]),e);return r=t.from(r),(this.gdbVersion||this.dynamicDataSource)&&((r=r.clone()).gdbVersion=r.gdbVersion||this.gdbVersion,r.dynamicDataSource=r.dynamicDataSource||this.dynamicDataSource),s(this.url,r,e)}async executeAttachmentQuery(r,e){const{executeAttachmentQuery:t,fetchAttachments:s,processAttachmentQueryResult:o}=await l(a(()=>import("./queryAttachments-BszGY8OC.js"),__vite__mapDeps([32,1,2,27,28,29,30,31,33])),e),i=m(this.url);return o(i,await(this.queryAttachmentsSupported?t(i,r,e):s(i,r,e)))}async executeBinsQuery(r,e){const{executeBinsQuery:t}=await l(a(()=>import("./executeBinsQuery-DIPCkKc2.js"),__vite__mapDeps([34,1,2,27,28,29,30,31,35,36,37])),e);return t(this.parsedUrl,r,e)}async executeTopFeaturesQuery(r,e){const{executeTopFeaturesQuery:t}=await l(a(()=>import("./executeTopFeaturesQuery-Df-V_Sh8.js"),__vite__mapDeps([38,1,2,39,27,28,29,30,31,40])),e);return t(this.parsedUrl,r,this.sourceSpatialReference,e)}async executeForTopIds(r,e){const{executeForTopIds:t}=await l(a(()=>import("./executeForTopIds-CCvByc37.js"),__vite__mapDeps([41,1,2,39,27,28,29,30,31,40])),e);return t(this.parsedUrl,r,e)}async executeForTopExtents(r,e){const{executeForTopExtents:t}=await l(a(()=>import("./executeForTopExtents-Cm6zBCL_.js"),__vite__mapDeps([42,1,2,39,27,28,29,30,31,40])),e);return t(this.parsedUrl,r,e)}async executeForTopCount(r,e){const{executeForTopCount:t}=await l(a(()=>import("./executeForTopCount-DpGx4L-U.js"),__vite__mapDeps([43,1,2,39,27,28,29,30,31,40])),e);return t(this.parsedUrl,r,e)}_normalizeQuery(r){let e=_.from(r);e.sourceSpatialReference=e.sourceSpatialReference||this.sourceSpatialReference,(this.gdbVersion||this.dynamicDataSource)&&(e=e===r?e.clone():e,e.gdbVersion=r.gdbVersion||this.gdbVersion,e.dynamicDataSource=r.dynamicDataSource?x.from(r.dynamicDataSource):this.dynamicDataSource);const{infoFor3D:t}=this;if(t!=null&&this._queryIs3DObjectFormat(r)){e=e===r?e.clone():e,e.formatOf3DObjects=null;const s=v(t),o=N(t);for(const i of t.queryFormats){if(i===s){e.formatOf3DObjects=i;break}i!==o||e.formatOf3DObjects||(e.formatOf3DObjects=i)}if(!e.formatOf3DObjects)throw new g("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(e.outSpatialReference&&!$(e.outSpatialReference,this.sourceSpatialReference))throw new g("query:unsupported-out-spatial-reference","3D object feature services do not support projection of geometries");if(e.outFields==null||!e.outFields.includes("*")){e=e===r?e.clone():e,e.outFields==null&&(e.outFields=[]);const{originX:i,originY:u,originZ:h,translationX:p,translationY:S,translationZ:b,scaleX:P,scaleY:F,scaleZ:O,rotationX:R,rotationY:C,rotationZ:T,rotationDeg:V}=t.transformFieldRoles;e.outFields.push(i,u,h,p,S,b,P,F,O,R,C,T,V)}}return e}_normalizeFields(r){if(this.fieldsIndex!=null&&r!=null)for(const e of r){const t=this.fieldsIndex.get(e.name);t&&Object.assign(e,t.toJSON())}}_queryIs3DObjectFormat(r){return this.infoFor3D!=null&&r.returnGeometry===!0&&r.multipatchOption!=="xyFootprint"&&!r.outStatistics}};c([d({type:x})],n.prototype,"dynamicDataSource",void 0),c([d()],n.prototype,"fieldsIndex",void 0),c([d()],n.prototype,"gdbVersion",void 0),c([d()],n.prototype,"infoFor3D",void 0),c([d({readOnly:!0})],n.prototype,"parsedUrl",null),c([d()],n.prototype,"pbfSupported",void 0),c([d()],n.prototype,"queryAttachmentsSupported",void 0),c([d()],n.prototype,"sourceSpatialReference",void 0),c([d({type:String})],n.prototype,"url",void 0),n=c([q("esri.layers.graphics.sources.support.QueryTask")],n);const ae=n;export{ae as j};
