const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/resourceUtils-C3dQOEyf.js","assets/index-CorgkmYx.js","assets/index-CxdEf2vt.css"])))=>i.map(i=>d[i]);
import{ad as _,_ as y,ae as S,af as v,s as E,ag as P}from"./index-CorgkmYx.js";import{getSiblingOfSameTypeI as $,contentToBlob as f}from"./resourceUtils-C3dQOEyf.js";async function T(s,t,a){const r=await w(s,t,a);await I(r,t,a)}async function b(s,t,a,r,o){const c=await w(a,r,o);await s.update({data:t}),await I(c,r,o)}async function w(s,t,a){if(!(t!=null&&t.resources))return;const r=t.portalItem===s.portalItem?new Set(s.paths):new Set;s.paths.length=0,s.portalItem=t.portalItem;const o=new Set(t.resources.toKeep.map(e=>e.resource.path)),c=new Set,m=[];o.forEach(e=>{r.delete(e),s.paths.push(e)});const u=[],h=[],p=[];for(const e of t.resources.toUpdate)if(r.delete(e.resource.path),o.has(e.resource.path)||c.has(e.resource.path)){const{resource:n,content:g,finish:d}=e,i=$(n,_());s.paths.push(i.path),u.push({resource:i,content:await f(g),compress:e.compress}),d&&p.push(()=>d(i))}else{s.paths.push(e.resource.path),h.push({resource:e.resource,content:await f(e.content),compress:e.compress});const n=e.finish;n&&p.push(()=>n(e.resource)),c.add(e.resource.path)}for(const e of t.resources.toAdd)if(s.paths.push(e.resource.path),r.has(e.resource.path))r.delete(e.resource.path);else{u.push({resource:e.resource,content:await f(e.content),compress:e.compress});const n=e.finish;n&&p.push(()=>n(e.resource))}if(u.length||h.length){const{addOrUpdateResources:e}=await y(()=>import("./resourceUtils-C3dQOEyf.js"),__vite__mapDeps([0,1,2]));await e(t.portalItem,u,"add",a),await e(t.portalItem,h,"update",a)}if(p.forEach(e=>e()),m.length===0)return r;const l=await S(m);if(v(a),l.length>0)throw new E("save:resources","Failed to save one or more resources",{errors:l});return r}async function I(s,t,a){if(!s||!t.portalItem)return;const r=[];for(const o of s){const c=t.portalItem.resourceFromPath(o);r.push(c.portalItem.removeResource(c,a))}await P(r)}export{b as n,T as p};
